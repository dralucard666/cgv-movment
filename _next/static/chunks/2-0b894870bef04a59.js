(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2],{27032:function(e,t,n){"use strict";n.d(t,{w:function(){return o}});var r=n(77340);const o={index:{execute:e=>{var t;const n=e.raw.length>0?(e.raw[0]+e.index.length)%e.index.length:e.index.length-1,o=null!==(t=e.index[n])&&void 0!==t?t:0;return(0,r.of)([Object.assign(Object.assign({},e),{raw:o})])},includeThis:!1,defaultParameters:[]},id:{execute:e=>(0,r.of)([Object.assign(Object.assign({},e),{raw:e.index.join(",")})]),includeThis:!1,defaultParameters:[]},log:{execute:e=>(0,r.of)([Object.assign(Object.assign({},e),{raw:e.raw[0]})]),includeThis:!0,defaultParameters:[]},select:{execute:e=>{var t;const n=e.raw.length>0?(e.raw[0]+e.index.length)%e.index.length:e.index.length-1,o=null!==(t=e.index[n])&&void 0!==t?t:0,[i,a,l]=e.raw;return(0,r.of)(a<=o&&(null==l||o<l)?[Object.assign(Object.assign({},e),{raw:i})]:[])},includeThis:!0,defaultParameters:[()=>({type:"raw",value:1}),()=>({type:"raw",value:2})]},randomFloat:{execute:(0,n(16195).QV)(((e,t)=>(0,r.of)([e+(t-e)*Math.random()]))),includeThis:!1,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:1})]}}},10811:function(e,t,n){"use strict";n.d(t,{rd:function(){return r.rd},LP:function(){return r.LP},WV:function(){return r.WV},HG:function(){return r.HG}});n(1815);var r=n(21509);n(16195)},1815:function(e,t,n){"use strict";n.d(t,{J:function(){return f}});var r=n(26173),o=n(77340),i=n(90260),a=n(23741),l=n(27032),s=n(16195),c=n(21509),u=n(36995),p=n.n(u);const f=Object.assign(Object.assign({},l.w),{createOb:{execute:(0,s.bd)((function(e,t,n,l,s){const u=e.seed,p=e.environment,f=new r.Vector3(1,0,0).applyAxisAngle(new r.Vector3(0,1,0),s/180*Math.PI);return(0,i.a)([u,p]).pipe((0,a.w)((([e,r])=>(0,o.of)([new c.rd([{position:t,time:n,direction:f}],l,[],r)]))))})),includeThis:!1,defaultParameters:[()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:0},{type:"raw",value:0},{type:"raw",value:0}]}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},pedestrian:{execute:(0,s.bd)((function(e,t,n,l){const s=e.seed,u=e.environment,p=new r.Vector3(1,0,0).applyAxisAngle(new r.Vector3(0,1,0),l/180*Math.PI);return(0,i.a)([s,u]).pipe((0,a.w)((([e,r])=>(0,o.of)([new c.rd([{position:t,time:n,direction:p}],c.LP.Pedestrian,[],r)]))))})),includeThis:!1,defaultParameters:[()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:0},{type:"raw",value:0},{type:"raw",value:0}]}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},cyclist:{execute:(0,s.bd)((function(e,t,n,l){const s=e.seed,u=e.environment,p=new r.Vector3(1,0,0).applyAxisAngle(new r.Vector3(0,1,0),l/180*Math.PI);return(0,i.a)([s,u]).pipe((0,a.w)((([e,r])=>(0,o.of)([new c.rd([{position:t,time:n,direction:p}],c.LP.Cyclist,[],r)]))))})),includeThis:!1,defaultParameters:[()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:0},{type:"raw",value:0},{type:"raw",value:0}]}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},car:{execute:(0,s.bd)((function(e,t,n,l){const s=e.seed,u=e.environment,p=new r.Vector3(1,0,0).applyAxisAngle(new r.Vector3(0,1,0),l/180*Math.PI);return(0,i.a)([s,u]).pipe((0,a.w)((([e,r])=>(0,o.of)([new c.rd([{position:t,time:n,direction:p}],c.LP.Car,[],r)]))))})),includeThis:!1,defaultParameters:[()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:0},{type:"raw",value:0},{type:"raw",value:0}]}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},createFromPrimitive:{execute:(0,s.bd)((function(e,t,n,l,s){const c=e.seed,u=e.environment,p=new r.Vector3(1,0,0).applyAxisAngle(new r.Vector3(0,1,0),-s/180*Math.PI);return(0,i.a)([c,u]).pipe((0,a.w)((([e,r])=>(0,o.of)([t.createMovementObject(n,p,l)]))))})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},point3:{execute:(0,s.QV)((function(e,t,n){return(0,o.of)([new r.Vector3(e,t,n)])})),includeThis:!1,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},moveRight:{execute:(0,s.QV)((function(e,t){return(0,o.of)([e.moveRight(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:50})]},moveLeft:{execute:(0,s.QV)((function(e,t){return(0,o.of)([e.moveLeft(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:50})]},moveUp:{execute:(0,s.QV)((function(e,t){return(0,o.of)([e.moveUp(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:50})]},moveDown:{execute:(0,s.QV)((function(e,t){return(0,o.of)([e.moveDown(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:50})]},moveUpAvoid:{execute:(0,s.QV)((function(e,t){return(0,o.of)([e.moveUpAvoid(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:50})]},moveDownAvoid:{execute:(0,s.QV)((function(e,t){return(0,o.of)([e.moveDownAvoid(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:50})]},moveRightAvoid:{execute:(0,s.QV)((function(e,t){return(0,o.of)([e.moveRightAvoid(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:50})]},moveLeftAvoid:{execute:(0,s.QV)((function(e,t){return(0,o.of)([e.moveLeftAvoid(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:50})]},moveRotate:{execute:(0,s.QV)((function(e,t,n){return(0,o.of)([e.moveRotate(t,n)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:50})]},moveRotateAvoid:{execute:(0,s.QV)((function(e,t,n){return(0,o.of)([e.moveRotateTurnClock(t,n)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:50})]},standStill:{execute:(0,s.QV)((function(e){return(0,o.of)([e.standStill()])})),includeThis:!0,defaultParameters:[]},distanceToStatic:{execute:(0,s.QV)((function(e){return(0,o.of)([e.staticObjectAhead()])})),includeThis:!0,defaultParameters:[]},sample:{execute:(0,s.bd)((function(e,t){const n=e.seed,l=e.environment;return(0,i.a)([n,l]).pipe((0,a.w)((([e,n])=>{const i=[];for(let o=0;o<t;o++){const t=p()(e+"x"+o)(),a=p()(e+"y"+o)(),l=p()(e+"areax"+o)(),s=p()(e+"areay"+o)();if(l<.3){const e=Math.round(1240*t)-700,o=Math.round(980*a)-480;i.push(new c.WV(new r.Vector3(e,0,o),[],n))}else if(l>=.3&&s>.4){const e=Math.round(900*t)-540,o=Math.round(290*a)-220;i.push(new c.WV(new r.Vector3(e,0,o),[],n))}else if(l>=.3&&s<=.4){const e=Math.round(1170*t)-670,o=Math.round(250*a)+270;i.push(new c.WV(new r.Vector3(e,0,o),[],n))}}return(0,o.of)(i)})))})),includeThis:!1,defaultParameters:[()=>({type:"raw",value:10})]},rectangle:{execute:(0,s.QV)((function(e,t){const n=new r.MeshBasicMaterial({color:8421504}),i=new r.BoxGeometry(t,t,t),a=new r.Mesh(i,n);return a.position.set(...e.toArray()),(0,o.of)([a])})),includeThis:!1,defaultParameters:[()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:1},{type:"raw",value:0},{type:"raw",value:0}]}),()=>({type:"raw",value:100})]},multipleStatic:{execute:(0,s.QV)((function(...e){return(0,o.of)([e.filter((e=>e instanceof r.Mesh))])})),includeThis:!1,defaultParameters:[]}})},21509:function(e,t,n){"use strict";n.d(t,{LP:function(){return r},HG:function(){return i},WV:function(){return a},rd:function(){return l}});var r,o=n(26173);!function(e){e[e.Pedestrian=0]="Pedestrian",e[e.Cyclist=1]="Cyclist",e[e.Car=2]="Car"}(r||(r={}));const i=40;class a{constructor(e,t,n){this.startPosition=e,this.grammarSteps=t,this.totalWorld=n}createMovementObject(e,t,n){return new l([{position:this.startPosition,time:e,direction:t}],n,[...this.grammarSteps],this.totalWorld)}}class l extends a{constructor(e,t,n,r){super(e[0].position,n,r),this.position=e,this.type=t,this.grammarSteps=n,this.totalWorld=r}moveRight(e){const t=this.position[this.position.length-1],n={position:t.position.clone().setX(t.position.x+e),time:t.time+1},r=structuredClone(this.position);return r.push(Object.assign(Object.assign({},n),{direction:new o.Vector3(1,0,0)})),new l(r,this.type,[...this.grammarSteps],this.totalWorld)}moveLeft(e){const t=this.position[this.position.length-1],n={position:t.position.clone().setX(t.position.x-e),time:t.time+1},r=structuredClone(this.position);return r.push(Object.assign(Object.assign({},n),{direction:new o.Vector3(-1,0,0)})),new l(r,this.type,[...this.grammarSteps],this.totalWorld)}moveUp(e){const t=this.position[this.position.length-1],n={position:t.position.clone().setZ(t.position.z-e),time:t.time+1},r=structuredClone(this.position);return r.push(Object.assign(Object.assign({},n),{direction:new o.Vector3(0,0,-1)})),new l(r,this.type,[...this.grammarSteps],this.totalWorld)}moveDown(e){const t=this.position[this.position.length-1],n={position:t.position.clone().setZ(t.position.z+e),time:t.time+1},r=structuredClone(this.position);return r.push(Object.assign(Object.assign({},n),{direction:new o.Vector3(0,0,1)})),new l(r,this.type,[...this.grammarSteps],this.totalWorld)}moveUpAvoid(e){const t=this.position[this.position.length-1],n=new o.Raycaster(t.position,new o.Vector3(0,0,1),void 0,e);if(this.totalWorld){const t=this.totalWorld;return 0==n.intersectObjects([t],!0).length?this.moveUp(e):this.moveRight(e)}return this.moveUp(e)}moveDownAvoid(e){const t=this.position[this.position.length-1],n=new o.Raycaster(t.position,new o.Vector3(0,0,-1),void 0,e);if(this.totalWorld){const t=this.totalWorld;return 0==n.intersectObjects([t],!0).length?this.moveDown(e):this.moveRight(e)}return this.moveDown(e)}moveLeftAvoid(e){const t=this.position[this.position.length-1],n=new o.Raycaster(t.position,new o.Vector3(-1,0,0),void 0,e);if(this.totalWorld){const t=this.totalWorld;return 0==n.intersectObjects([t],!0).length?this.moveLeft(e):this.moveUp(e)}return this.moveLeft(e)}moveRightAvoid(e){const t=this.position[this.position.length-1],n=new o.Raycaster(t.position,new o.Vector3(1,0,0),void 0,e);if(this.totalWorld){const t=this.totalWorld;return 0==n.intersectObjects([t],!0).length?this.moveRight(e):this.moveUp(e)}return this.moveRight(e)}moveRotate(e,t){const n=this.position[this.position.length-1],r=n.direction.clone().applyAxisAngle(new o.Vector3(0,1,0),e/180*Math.PI),i={position:n.position.clone().add(r.multiplyScalar(t)),time:n.time+1},a=structuredClone(this.position);return a.push(Object.assign(Object.assign({},i),{direction:r.normalize()})),new l(a,this.type,[...this.grammarSteps],this.totalWorld)}moveRotateTurnClock(e,t){if(this.totalWorld){const n=this.totalWorld,r=this.position[this.position.length-1].position.clone(),i=this.position[this.position.length-1].direction.clone().normalize(),a=r;for(let l=0;l<12;l++){const r=e+30*l,s=i.clone().applyAxisAngle(new o.Vector3(0,1,0),r/180*Math.PI);if(0==new o.Raycaster(a,s,void 0,t).intersectObjects([n],!0).length)return this.moveRotate(r,t)}return this.moveRight(t)}return this.moveRotate(e,t)}standStill(){const e=this.position[this.position.length-1],t=e.time,n=structuredClone(this.position);return n.push({position:e.position,direction:e.direction,time:t+1}),new l(n,this.type,[...this.grammarSteps],this.totalWorld)}staticObjectAhead(){const e=new o.Vector3(12,-5,0),t=(new o.Vector3(12,5,0),this.position[this.position.length-1].position),n=this.position[this.position.length-1].direction.multiplyScalar(10);new o.Vector3(0,0,0).addVectors(t,n);return new o.Vector3(0,0,0).subVectors(t,e)}}},55050:function(e,t,n){"use strict";n.d(t,{Js:function(){return ee},Yh:function(){return _},vk:function(){return X},WV:function(){return H},P:function(){return P},eT:function(){return D},QM:function(){return Ze},pT:function(){return l},PP:function(){return we},Zj:function(){return ge},i7:function(){return Z},Oz:function(){return me},XA:function(){return ve},dc:function(){return de},ae:function(){return c},gN:function(){return u},Nh:function(){return s},Jy:function(){return Re},Wq:function(){return Ye},jo:function(){return he},FP:function(){return ye}});var r=n(26173);new r.Box3,new r.Vector3,new r.Vector3;const o=new r.Matrix4,i=new r.Vector3,a=new r.Euler;function l(e,t,n=o){return i.crossVectors(e,t),n.makeBasis(e,t,i)}function s(e,t,n,r=o){return r.makeTranslation(e,t,n)}function c(e,t,n,r=o){return r.makeRotationFromEuler(a.set(e,t,n))}function u(e,t,n,r=o){return r.makeScale(e,t,n)}function p(e,t){let n=0;const r=Math.random()*t;for(let o=0;o<e.length;o++)if(n+=e[o],r<=n)return o;return e.length-1}function f(e,t){var n;const r=e.reduce(((e,t)=>e+t),0),o=[];for(let i=0;i<t;i++){const t=p(e,r);o[t]=(null!==(n=o[t])&&void 0!==n?n:0)+1}return o}function d(e,t,n){return n.a.fromBufferAttribute(t,3*e),n.b.fromBufferAttribute(t,3*e+1),n.c.fromBufferAttribute(t,3*e+2),n}function m(e,t){let n=Math.random(),r=Math.random();return n+r>1&&(n=1-n,r=1-r),t.set(0,0,0).addScaledVector(e.a,n).addScaledVector(e.b,r).addScaledVector(e.c,1-(n+r)),t}const h=new r.Triangle;function y(e,t){null!=e.index&&(e=e.toNonIndexed());const n=e.getAttribute("position"),o=f(new Array(n.count/3).fill(null).map(((e,t)=>d(t,n,h).getArea())),t),i=[];for(let a=0;a<o.length;a++){const e=o[a];if(null!=e){d(a,n,h);for(let t=0;t<e;t++)i.push(m(h,new r.Vector3))}}return i}var v=n(90766),g=n(21283);n(61135);new r.Matrix4;function b(e,t){return e[t]}function x(e,t,n){e[t]=n}function w(e){C.setFromRotationMatrix(e),j.set(0,1,0),j.applyQuaternion(C);const t=Math.abs(j.x),n=Math.abs(j.y),r=Math.abs(j.z),o=Math.max(t,n,r);return t===o?j.x<0?"west":"east":n===o?j.y<0?"down":"up":j.z<0?"south":"north"}const j=new r.Vector3,S=new r.Box3,O=new r.Vector3,M=new r.Box3;function P(e,t,n){e.getBoundingBox(S),O.copy(S.min);let r=0;const o=[];for(;b(S.min,t)<b(S.max,t);){const i=e.matrix.clone();i.multiply(s(S.min.x,S.min.y,S.min.z));const a=n(i,r,S.max.x-S.min.x,S.max.y-S.min.y,S.max.z-S.min.z);o.push(a),a.getBoundingBox(M),M.getSize(j),r++,x(S.min,t,b(S.min,t)+b(j,t))}return o}function N(e,t,n){let r=e[t];null==r&&(r=[],e[t]=r),r.push(n)}function A(e,t,n){let r=e.findIndex((e=>j.copy(e).sub(t).lengthSq()<n));return-1===r&&(r=e.length,e.push(t)),r}function E(e,t,n,o,i){if(0===e.points.length)return[];const a=new Set;return e.connectionsList.reduce(((n,l,c)=>null==l?n:[...n,...l.map(((n,u)=>{const p=`${n}/${c}`,f=`${c}/${n}`;if(!a.has(p)&&!a.has(f))return a.add(p),function(e,t,n,o,i,a,l,c){const u=n[o],p=new r.Shape,f=new r.Matrix4,d=e.points[t],m=e.points[u];j.copy(m).sub(d).setY(0).normalize(),f.makeBasis(j,D,(new r.Vector3).crossVectors(j,D)),f.premultiply(s(d.x,d.y,d.z)),k.copy(f).invert(),R(e,p,k,Array.isArray(i)?i[t]:i,d,m,l,o,n,!0);const h=e.connectionsList[u],y=null===h||void 0===h?void 0:h.indexOf(t);return R(e,p,k,Array.isArray(i)?i[u]:i,m,d,l,y,h,!1),new ee(f,p,c)}(e,c,l,u,t,0,o,i)})).filter(g.Dm)]),[])}const k=new r.Matrix4,C=new r.Quaternion,V=new r.Vector3(1,0,0),D=new r.Vector3(0,1,0),z=new r.Vector3(0,0,1);const T=new r.Vector3,L=new r.Vector3,B=new r.Vector3,I=new r.Vector3,q=new r.Vector3,G=new r.Vector3;function R(e,t,n,r,o,i,a,l,s,c){if(L.copy(o).applyMatrix4(n),null!=l&&null!=s&&s.length>1){I.copy(i).sub(o).normalize(),q.copy(e.points[s[(l+s.length-1)%s.length]]).sub(o).normalize(),T.copy(I).add(q).normalize().multiplyScalar(r),2===s.length?(G.copy(q),B.copy(T)):(G.copy(e.points[s[(l+1)%s.length]]).sub(o).normalize(),B.copy(I).add(G).normalize().multiplyScalar(r)),j.crossVectors(I,a);j.dot(q)>=0||T.multiplyScalar(-1);j.dot(G)>=0&&B.multiplyScalar(-1)}else T.copy(i).sub(o).cross(a).normalize().multiplyScalar(r),B.copy(T).multiplyScalar(-1);T.add(o).applyMatrix4(n),B.add(o).applyMatrix4(n),c?t.moveTo(T.x,T.z):t.lineTo(T.x,T.z),t.lineTo(L.x,L.z),t.lineTo(B.x,B.z)}function Q(e,t,n,r){T.copy(t).sub(e),L.copy(n).sub(e);const o=B.crossVectors(T,r).dot(L)<0;T.projectOnPlane(r),L.projectOnPlane(r);const i=T.angleTo(L);return o?i:2*Math.PI-i}function Z(e){return t=>{switch(t){case U.Point:return new r.PointsMaterial({size:3e-8,toneMapped:!1,color:e});case U.Line:return new r.LineBasicMaterial({toneMapped:!1,color:e});case U.Mesh:return new r.MeshPhongMaterial({toneMapped:!1,color:e})}}}const $=new r.Matrix4,W=new r.Vector3,F=new r.Quaternion;function Y(e,t){return e.matrixAutoUpdate=!1,e.matrix=t,e.updateMatrixWorld(!0),e}var U;!function(e){e[e.Point=0]="Point",e[e.Line=1]="Line",e[e.Mesh=2]="Mesh"}(U||(U={}));class H{constructor(){this.geometryCache=null,this.objectCache=null,this.outlineCache=null}getGeometry(){return null===this.geometryCache&&(this.geometryCache=this.computeGeometry()),this.geometryCache}getOutline(){return null==this.outlineCache&&(this.outlineCache=this.computeOutline()),this.outlineCache}getObject(){return null==this.objectCache&&(this.objectCache=this.computeObject3D()),this.objectCache}dispose(){var e;null===(e=this.geometryCache)||void 0===e||e.dispose()}multiplyMatrix(e){return this.changeMatrix(this.matrix.clone().multiply(e))}premultiplyMatrix(e){return this.changeMatrix(this.matrix.clone().premultiply(e))}}class X extends H{changeMaterialGenerator(e){return new X(this.matrix,e)}changeMatrix(e){return new X(e,this.materialGenerator)}multiplyMatrix(e){return new X(this.matrix.clone().multiply(e),this.materialGenerator)}constructor(e,t){super(),this.matrix=e,this.materialGenerator=t}getBoundingBox(e){e.min.set(0,0,0),e.max.set(0,0,0)}getVertecies(){return[new r.Vector3]}extrude(e){return _.fromPoints(this.matrix.clone(),new r.Vector3(0,0,0),new r.Vector3(0,e,0),this.materialGenerator)}components(e){return"points"===e?[this.clone()]:[]}computeObject3D(){return Y(new r.Points((new r.BufferGeometry).setFromPoints([new r.Vector3]),this.materialGenerator(U.Point)),this.matrix)}computeOutline(){const e=new r.Points((new r.BufferGeometry).setFromPoints([new r.Vector3]),new r.PointsMaterial({color:0,size:3e-8,transparent:!0,depthTest:!1}));return e.renderOrder=1e3,Y(e,this.matrix)}clone(){return new X(this.matrix,this.materialGenerator)}computeGeometry(){}expand(e,t,n){throw new Error("Method not implemented.")}getSize(e){return 0===e?1:0}samplePoints(e){return new Array(e).fill(null).map((()=>this.clone()))}}class _ extends H{changeMaterialGenerator(e){return new _(this.matrix,this.length,e)}getStart(){return new r.Vector3(0,0,0).applyMatrix4(this.matrix)}getEnd(){return new r.Vector3(this.length,0,0).applyMatrix4(this.matrix)}changeMatrix(e){return new _(e,this.length,this.materialGenerator)}constructor(e,t,n){super(),this.matrix=e,this.length=t,this.materialGenerator=n}getVertecies(){return[new r.Vector3,new r.Vector3(this.length,0,0)]}static fromPoints(e,t,n,r){e.multiply(s(t.x,t.y,t.z)),W.copy(n).sub(t);const o=W.length();return F.setFromUnitVectors(V,W.divideScalar(o)),$.makeRotationFromQuaternion(F),e.multiply($),new _(e,o,r)}getBoundingBox(e){e.min.set(0,0,0),e.max.set(this.length,0,0)}clone(){return new _(this.matrix,this.length,this.materialGenerator)}extrude(e){return ee.fromLengthAndHeight(this.matrix.clone(),this.length,e,D,this.materialGenerator)}components(e){switch(e){case"faces":return[];case"lines":return[this.clone()];case"points":{const e=new X(this.matrix.clone().multiply($.makeTranslation(this.length,0,0)),this.materialGenerator);return[new X(this.matrix,this.materialGenerator),e]}}}computeObject3D(){return Y(new r.Line((new r.BufferGeometry).setFromPoints([new r.Vector3,new r.Vector3(this.length,0,0)]),this.materialGenerator(U.Line)),this.matrix)}computeOutline(){const e=new r.Line((new r.BufferGeometry).setFromPoints([new r.Vector3,new r.Vector3(this.length,0,0)]),new r.LineBasicMaterial({color:0}));return e.renderOrder=1e3,Y(e,this.matrix)}computeGeometry(){}getSize(e){return 1===e?this.length:0}samplePoints(e){return new Array(e).fill(null).map((()=>new X(this.matrix.clone().multiply($.makeTranslation(Math.random()*this.length,0,0)),this.materialGenerator)))}}const J=new r.Box2,K=(new r.Vector2,new r.Matrix4);class ee extends H{changeMaterialGenerator(e){return new ee(this.matrix,this.shape,e)}changeMatrix(e){return new ee(e,this.shape,this.materialGenerator)}getVertecies(){return this.shape.getPoints().map((({x:e,y:t})=>new r.Vector3(e,0,t)))}constructor(e,t,n){super(),this.matrix=e,this.shape=t,this.materialGenerator=n}static fromLengthAndHeight(e,t,n,o,i){const a=[new r.Vector2(t,0),new r.Vector2(t,n),new r.Vector2(0,n),new r.Vector2(0,0)],l=new r.Shape(a);return F.setFromUnitVectors(z,o),$.makeRotationFromQuaternion(F),e.multiply($),new ee(e,l,i)}getBoundingBox(e){J.setFromPoints(this.shape.getPoints()),e.min.set(J.min.x,0,J.min.y),e.max.set(J.max.x,0,J.max.y)}computeGeometry(){const e=new r.ShapeBufferGeometry(this.shape);return function(e){let t;for(let n=0;n<e.index.count;n+=3)t=e.index.getX(n),e.index.setX(n,e.index.getX(n+2)),e.index.setX(n+2,t)}(e),te(e),e}invert(){const e=this.matrix.clone();e.multiply(c(Math.PI,0,0));const t=this.shape.getPoints(5),n=this.shape.holes,o=new r.Shape(t.map((({x:e,y:t})=>new r.Vector2(e,-t))));return o.holes=n.map((e=>new r.Path(e.getPoints().map((({x:e,y:t})=>new r.Vector2(e,-t)))))),new ee(e,o,this.materialGenerator)}extrude(e){K.copy(this.matrix).invert();const t=this.multiplyMatrix(K.multiply(s(0,e,0))),n=this.shape.getPoints(5);return new se(this.matrix,[...n.map(((t,o)=>{const i=n[(o+1)%n.length];W.set(i.x-t.x,0,i.y-t.y);const a=W.length(),c=s(t.x,0,t.y,new r.Matrix4);c.multiply(l(W.normalize(),D));const u=ee.fromLengthAndHeight(c,a,e,D,this.materialGenerator);return e<0?u.invert():u})),t])}components(e){switch(e){case"points":return this.shape.extractPoints(5).shape.map((e=>new X(this.matrix.clone().multiply(s(e.x,0,e.y)),this.materialGenerator)));case"lines":{const e=this.shape.extractPoints(5).shape;return e.map(((t,n)=>{const o=e[(n+1)%e.length];return _.fromPoints(this.matrix.clone(),new r.Vector3(t.x,0,t.y),new r.Vector3(o.x,0,o.y),this.materialGenerator)}))}case"faces":return[this]}}computeObject3D(){return Y(new r.Mesh(this.getGeometry(),this.materialGenerator(U.Mesh)),this.matrix)}computeOutline(){const e=this.pathToOutline(this.shape.extractPoints(5).shape),t=this.shape.holes.map((e=>this.pathToOutline(e.getPoints(5)))),n=Y(new r.Object3D,this.matrix);return n.renderOrder=1e3,n.add(e,...t),n}pathToOutline(e){if(0===e.length)return new r.Object3D;e.push(e[0]);const t=(new r.BufferGeometry).setFromPoints(e);return te(t),new r.Line(t,new r.MeshBasicMaterial({color:0,transparent:!0}))}expand(e,t,n){throw new Error("not implemented")}getSize(e){if(2===e){const e=r.ShapeUtils.area(this.shape.getPoints(5));return this.shape.holes.reduce(((e,t)=>e-r.ShapeUtils.area(t.getPoints(5))),e)}return 0}samplePoints(e){const t=this.getGeometry();return null==t?[]:y(t,e).map((e=>new X(this.matrix.clone().multiply(s(e.x,e.y,e.z)),this.materialGenerator)))}}function te(e){let t;const n=e.getAttribute("position");for(let r=0;r<n.count;r++)t=n.getY(r),n.setY(r,n.getZ(r)),n.setZ(r,t)}const ne=new r.Box3,re=new r.BoxBufferGeometry(1,1,1),oe=new r.EdgesGeometry(re);class ie extends H{get materialGenerator(){throw new Error("Method not implemented.")}changeMaterialGenerator(e){return this}getVertecies(){throw new Error("Method not implemented.")}changeMatrix(e){return new ie(e,this.object)}constructor(e,t){super(),this.matrix=e,this.object=t,this.computeObject3D()}extrude(e){throw new Error("Method not implemented.")}components(e){throw new Error("Method not implemented.")}computeObject3D(){const e=new r.Object3D;return e.add(this.object),Y(e,this.matrix)}computeGeometry(){}getBoundingBox(e){ae(this.object,e)}computeOutline(){this.getBoundingBox(ne),ne.getCenter(W);const e=new r.LineSegments(oe,new r.LineBasicMaterial({color:0}));return e.matrix.copy(this.matrix).multiply(s(W.x,W.y,W.z)),ne.getSize(W),e.matrix.multiply(u(W.x,W.y,W.z)),e.renderOrder=1e3,e}expand(e,t,n){throw new Error("Method not implemented.")}getSize(e){throw new Error("Method not implemented.")}samplePoints(e){throw new Error("Method not implemented.")}}function ae(e,t){t=null!==t&&void 0!==t?t:new r.Box3,e instanceof r.Mesh?(e.geometry.computeBoundingBox(),t.copy(e.geometry.boundingBox)):t.makeEmpty();for(const n of e.children){if(0===n.children.length&&!(n instanceof r.Mesh))continue;const e=ae(n).applyMatrix4(n.matrix);t.union(e)}return t}class le extends H{changeMaterialGenerator(e){return new le(this.matrix,this.geometry,e)}changeMatrix(e){return new le(e,this.geometry,this.materialGenerator)}constructor(e,t,n){super(),this.matrix=e,this.geometry=t,this.materialGenerator=n,t.computeBoundingBox()}extrude(e){throw new Error("Method not implemented.")}components(e){throw new Error("Method not implemented.")}computeObject3D(){return Y(new r.Mesh(this.getGeometry(),this.materialGenerator(U.Mesh)),this.matrix)}getVertecies(){throw new Error("Method not implemented.")}getBoundingBox(e){e.copy(this.geometry.boundingBox)}computeGeometry(){return this.geometry}computeOutline(){const e=new r.LineSegments(new r.EdgesGeometry(this.geometry),new r.LineBasicMaterial({color:0}));return Y(e,this.matrix),e.renderOrder=1e3,e}expand(e,t,n){throw new Error("Method not implemented.")}getSize(e){throw new Error("Method not implemented.")}samplePoints(e){const t=this.getGeometry();return null==t?[]:y(t,e).map((e=>new X(this.matrix.clone().multiply(s(e.x,e.y,e.z)),this.materialGenerator)))}}class se extends H{changeMaterialGenerator(e){return new se(this.matrix,this.primitives.map((t=>t.changeMaterialGenerator(e))))}get materialGenerator(){return this.primitives[0].materialGenerator}changeMatrix(e){return new se(e,this.primitives)}constructor(e,t){super(),this.matrix=e,this.primitives=t}getVertecies(){return this.primitives.reduce(((e,t)=>e.concat(t.getVertecies().map((e=>e.applyMatrix4(t.matrix))))),[])}extrude(e){return new se(this.matrix,this.primitives.map((t=>t.extrude(e))))}components(e){const t=this.primitives.map((t=>t.components(e))).reduce(((e,t)=>e.concat(t)));return t.map((e=>e.premultiplyMatrix(this.matrix)))}computeObject3D(){const e=Y(new r.Object3D,this.matrix);return this.primitives.forEach((t=>e.add(t.getObject()))),e}getBoundingBox(e){e.makeEmpty(),this.primitives.forEach((t=>{t.getBoundingBox(ne),ne.applyMatrix4(t.matrix),e.union(ne)}))}computeGeometry(){const e=this.primitives.map((e=>{var t;return null===(t=e.getGeometry())||void 0===t?void 0:t.applyMatrix4(e.matrix)})).filter(g.Dm),t=(0,v.qf)(e);return e.forEach((e=>e.dispose())),t}computeOutline(){const e=Y(new r.Object3D,this.matrix);return this.primitives.forEach((t=>e.add(t.getOutline()))),e.renderOrder=1e3,e}getSize(e){return this.primitives.reduce(((t,n)=>n.getSize(e)+t),0)}samplePoints(e){const t=f(this.primitives.map((e=>e.getSize(2))),e),n=[];for(let r=0;r<t.length;r++){const e=t[r];null!=e&&n.push(...this.primitives[r].samplePoints(e))}return n}}var ce=n(7587),ue=n(58882),pe=n.n(ue),fe=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function de(e,t){return(e+180)/360*Math.pow(2,t)}function me(e,t){return(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t)}function he(e,t,n=256){const r=function(e,t){const n=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}(e,t);return 156543.03*Math.cos(r*Math.PI/180)/Math.pow(2,t)*n}function ye(e,t){return Math.pow(2,t)/Math.pow(2,e)}function ve(e,t,n,r=256){return fe(this,void 0,void 0,(function*(){const o=he(t,n,r),i=yield fetch(e),a=yield i.arrayBuffer(),l=new ce.VectorTile(new(pe())(a));return Object.entries(l.layers).reduce(((e,[t,n])=>{const r=o/n.extent;return Object.assign(Object.assign({},e),{[t]:new Array(n.length).fill(null).map(((e,t)=>{const o=n.feature(t),i=o.loadGeometry().map((e=>{const t=new Array(e.length);for(let n=0;n<e.length;n++){const{x:o,y:i}=e[n];t[n]={x:o*r,y:i*r}}return t})).filter((e=>e.length>0));return{properties:o.properties,geometry:i}}))})}),{})}))}function ge(e,t,n,r){return e.road.filter((e=>"street"===e.properties.class)).map((e=>{const t=e.geometry.reduce(((e,t)=>{const o=function(e,t,n){const r=e.slice(0,-1).map(((r,o)=>{let i=e[(o+1)%e.length];switch(t){case"include":break;case"exclude":if(!Se(r.x,r.y,n)||!Se(i.x,i.y,n))return;break;case"clip":{const e=function(e,t,n,r,o,i,a,l){const s=(r-t)/(n-e),c=t-s*e,u=be(s,c,e,t,o,i,a,l),p=be(s,c,n,r,o,i,a,l);if(null==u||null==p)return;return{start:u,end:p}}(r.x,r.y,i.x,i.y,0,0,n,n);if(null==e)return;r=e.start,i=e.end}}return{type:"operation",identifier:"line",children:[r,i].map((({x:e,y:t})=>({type:"operation",identifier:"point2",children:[{type:"raw",value:e},{type:"raw",value:t}]})))}})).filter(g.Dm);if(0===r.length)return;return r}(t,n,r);return null==o?e:e.concat(o)}),[]);return 1===t.length?t[0]:{type:"parallel",children:t}}),[]).filter(g.Dm).map(((e,n)=>({name:`Road${n+1}${t}`,step:e})))}function be(e,t,n,r,o,i,a,l){if(je(n,r,o,i,a,l))return{x:n,y:r};const s=xe(r,i,l),c=function(e,t,n){return(e-n)/t}(s,e,t);if(je(c,s,o,i,a,l))return{x:c,y:s};const u=xe(n,o,a),p=function(e,t,n){return e*t+n}(u,e,t);return je(u,p,o,i,a,l)?{x:u,y:p}:void 0}function xe(e,t,n){return Math.max(Math.min(e,n),t)}function we(e,t,n,r){return e.building.map((e=>{const t=e.geometry.map((e=>function(e,t,n){const r=new Array(e.length-1);for(let o=0;o<e.length-1;o++){const{x:i,y:a}=e[o];if("exclude"===t&&!Se(i,a,n))return;r[o]={type:"operation",identifier:"point2",children:[{type:"raw",value:i},{type:"raw",value:a}]}}return{type:"operation",identifier:"face",children:r}}(e,n,r))).filter(g.Dm);if(0!==t.length)return 1===t.length?t[0]:{type:"parallel",children:t}})).filter(g.Dm).map(((e,n)=>({name:`Building${n+1}${t}`,step:e})))}function je(e,t,n,r,o,i){return n<=e&&r<=t&&e<=o&&t<=i}function Se(e,t,n){return 0<e&&0<t&&e<n&&t<n}var Oe=n(77340),Me=n(18816),Pe=n(80598),Ne=n(82513),Ae=n(27032),Ee=n(68569),ke=n(41771);class Ce extends r.ExtrudeGeometry{constructor(e,t,n){super(new r.Shape([new r.Vector2(0,0),new r.Vector2(e/2,t),new r.Vector2(e,0)]),{depth:n,bevelEnabled:!1})}}const Ve=new r.Box3,De=new r.Vector3;r.Cache.enabled=!0;const ze=new Ee.E,Te=new ke._;Te.setDecoderPath("/cgv/"),ze.setDRACOLoader(Te);const Le=new r.Vector3;const Be=new r.Vector3,Ie=new r.Box3;function qe(e){return Math.PI*e/180}function Ge(e,...t){const n=t.reduce(((t,n)=>[...t,...n.components(e)]),[]);return(0,Oe.of)(n)}const Re=Object.assign(Object.assign({},Ae.w),{translate:{execute:(0,Ne.QV)((function(e,t,n,r){return(0,Oe.of)([e.multiplyMatrix(s(t,n,r))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},scale:{execute:(0,Ne.QV)((function(e,t,n,r){return(0,Oe.of)([e.multiplyMatrix(u(t,n,r))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:1}),()=>({type:"raw",value:1}),()=>({type:"raw",value:1})]},rotate:{execute:(0,Ne.QV)((function(e,t,n,r){return(0,Oe.of)([e.multiplyMatrix(c(qe(t),qe(n),qe(r)))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},extrude:{execute:(0,Ne.QV)((function(e,t){return(0,Oe.of)([e.extrude(t)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:1})]},split:{execute:(0,Ne.QV)((function(e,t,n,...r){if(0===r.length)return(0,Oe.of)([e]);const o=P(e,t,((o,i,a,l,s)=>{const c=Math.floor(i/r.length),u=r[i%r.length];if(!1===n&&0==c||!0===n||c<n){const n="x"===t?Math.min(u,a):a,r="z"===t?Math.min(u,s):s;return ee.fromLengthAndHeight(o,n,r,z,e.materialGenerator)}return ee.fromLengthAndHeight(o,a,s,z,e.materialGenerator)}));return(0,Oe.of)(o)})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:"x"}),()=>({type:"raw",value:!0}),()=>({type:"raw",value:1})]},toPoints:{execute:(0,Ne.QV)(Ge.bind(null,"points")),includeThis:!0,defaultParameters:[]},toLines:{execute:(0,Ne.QV)(Ge.bind(null,"lines")),includeThis:!0,defaultParameters:[]},toFaces:{execute:(0,Ne.QV)(Ge.bind(null,"faces")),includeThis:!0,defaultParameters:[]},sample:{execute:(0,Ne.QV)((function(e,t){return(0,Oe.of)(e.samplePoints(t))})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:10})]},color:{execute:(0,Ne.QV)((function(e,t){return(0,Oe.of)([e.changeMaterialGenerator(Z(t))])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:"#ff0000"})]},size:{execute:(0,Ne.QV)((function(e,t){return e.getBoundingBox(Ie),Ie.getSize(Be),(0,Oe.of)([Be[t]])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:"x"})]},expandGraph:{execute:(0,Ne.QV)((function(e,t,...n){return(0,Oe.of)(E(function(e,t,n){const r=n*n,o=[],i=[];for(const[a,l]of e){const e=A(o,a,r),t=A(o,l,r);N(i,e,t),N(i,t,e)}for(let a=0;a<i.length;a++){const e=i[a],n=e.slice(1).map((n=>({index:n,angle:Q(o[a],o[e[0]],o[n],t)}))).sort(((e,t)=>e.angle-t.angle));i[a]=[e[0],...n.map((({index:e})=>e))]}return{connectionsList:i,points:o}}(n.map((e=>[e.getStart(),e.getEnd()])),D,t),t,0,D,e.materialGenerator))})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:3})]},load:{execute:(0,Ne.QV)((function(e,t){return(0,Me.D)(ze.loadAsync(t)).pipe((0,Pe.U)((t=>[new ie(e.matrix,t.scene)])))})),includeThis:!0,defaultParameters:[]},point3:{execute:(0,Ne.QV)((function(e,t,n,o){const i=Z(new r.Color(16711680));return(0,Oe.of)([new X(s(t,n,o,e.matrix.clone()),i)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},point2:{execute:(0,Ne.QV)((function(e,t,n){const o=Z(new r.Color(16711680));return(0,Oe.of)([new X(s(t,0,n,e.matrix.clone()),o)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0}),()=>({type:"raw",value:0})]},line:{execute:(0,Ne.QV)((function(e,...t){if(t.length<2)return(0,Oe.of)([e]);const[n,o]=t.map((e=>(new r.Vector3).setFromMatrixPosition(e.matrix))),i=Z(new r.Color(16711680));return(0,Oe.of)([_.fromPoints(e.matrix.clone(),n,o,i)])})),includeThis:!0,defaultParameters:[()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:0},{type:"raw",value:0},{type:"raw",value:0}]}),()=>({type:"operation",identifier:"point3",children:[{type:"raw",value:1},{type:"raw",value:0},{type:"raw",value:0}]})]},face:{execute:(0,Ne.QV)((function(e,...t){if(t.length<3)return(0,Oe.of)([e]);const n=t.map((e=>(Le.setFromMatrixPosition(e.matrix),new r.Vector2(Le.x,Le.z))));r.ShapeUtils.isClockWise(n)&&n.reverse();const o=Z(new r.Color(16711680));return(0,Oe.of)([new ee(e.matrix,new r.Shape(n),o)])})),includeThis:!0,defaultParameters:[]},gableRoof:{execute:(0,Ne.QV)((function(e,t,n,r,o){const i=null==t?0:Math.PI*t/180,a=c(0,-i,0);Ve.setFromPoints(e.getVertecies().map((e=>e.applyMatrix4(a)))),Ve.getSize(De);const l=new Ce(null!==n&&void 0!==n?n:De.x,null!==r&&void 0!==r?r:De.y,null!==o&&void 0!==o?o:De.z);return l.translate(Ve.min.x,Ve.min.y,Ve.min.z),l.computeBoundingBox(),l.rotateY(i),(0,Oe.of)([new le(e.matrix,l,e.materialGenerator)])})),includeThis:!0,defaultParameters:[()=>({type:"raw",value:0})]},direction:{execute:(0,Ne.QV)((function(e){return(0,Oe.of)([w(e.matrix)])})),includeThis:!0,defaultParameters:[]}});var Qe=n(16195);function Ze(e,t,n,r){const o=new Map;return e.pipe((0,Qe.TH)()).subscribe({next:e=>{const r=e.index.join(",");if(e.type===Qe.u4.SET){const i=n(e.value);t.add(i),o.set(r,i)}else{const e=o.get(r);null!=e&&(o.delete(r),t.remove(e))}},error:e=>{r(e)}})}var $e=n(91e3);const We=e=>w(e.raw.matrix),Fe={generateMatching:(e,t)=>(0,$e.YI)((e=>`where direction is one of ${e.join(", ")}`),e,t,We,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"direction"},{type:"raw",value:We(e)}]})),(n=>(0,$e.oc)(e,t,n))),generateContaining:(e,t)=>(0,$e.YI)((e=>`where direction is one of ${e.join(", ")}`),e,t,We,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"direction"},{type:"raw",value:We(e)}]})))},Ye=[$e.Ao,$e.TO,$e.au,$e.W9,Fe,$e.z$,$e.Ug]},91e3:function(e,t,n){"use strict";n.d(t,{Ao:function(){return d},O$:function(){return T},Q:function(){return V},YI:function(){return P},EU:function(){return $},o9:function(){return oe},bp:function(){return I},Db:function(){return B},Eo:function(){return re},TY:function(){return O},Ik:function(){return i},_P:function(){return D},MG:function(){return a},zq:function(){return k},Il:function(){return C},gK:function(){return o},z$:function(){return S},au:function(){return j},TO:function(){return h},Ug:function(){return v},W9:function(){return w},$T:function(){return G},oc:function(){return M},im:function(){return K},tc:function(){return Q},lG:function(){return W},gx:function(){return H},qC:function(){return Z}});var r=n(21283);function o(e,t){return"symbol"===e.type?(0,r.nH)(e.identifier,t):"operation"===e.type?e.identifier:"raw"===e.type?e.value.toString():e.type}const i=r.nH;function a(e,t){return"string"===typeof e?i(e,t):o(e,t)}var l=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};const s=e=>e.index[e.index.length-1],c=(e,t)=>s(e)%t;function u(e,t,n,r){return P((e=>`in every set of ${n} select index ${e.join(", ")}`),e,t,(e=>c(e,n)),(e=>((e,t)=>({type:"equal",children:[{type:"modulo",children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:t}]},{type:"raw",value:c(e,t)}]}))(e,n)),r)}function p(e){return e.map(s).filter(((e,t,n)=>n.indexOf(e)===t)).sort(((e,t)=>e-t))}const f=()=>({description:"everything",isSelected:()=>!0,generateStep:void 0}),d={generateContaining:f,generateMatching:f};function m(e,...t){const n=t.filter(r.Dm);let o;for(const r of n)(null==o||e(r,o))&&(o=r);return o}const h={generateMatching:(e,t)=>{const n=p(t),r=n[0]+1,o=n[1]-n[0];return m(((e,t)=>e.keySize<t.keySize),u(e,t,r,(n=>M(e,t,n))),n.length>=2?u(e,t,o,(n=>M(e,t,n))):void 0)},generateContaining:(e,t)=>{const n=p(t),r=n[0]+1,o=n[1]-n[0];return m(((e,t)=>e.selectionSize<t.selectionSize),u(e,t,r),n.length>=2?u(e,t,o):void 0)}},y=e=>e.index.join(","),v={generateMatching:(e,t)=>P((e=>`where index is one of ${e.join(", ")}`),e,t,s,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:s(e)}]})),(n=>M(e,t,n))),generateContaining:(e,t)=>P((e=>`where index is one of ${e.join(", ")}`),e,t,s,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:s(e)}]})))};function g(e,t,n,r){return{description:t(r),isSelected:t=>e(r,s(t)),generateStep:()=>({type:n,children:[{type:"operation",children:[],identifier:"index"},{type:"raw",value:r}]})}}const b=g.bind(null,((e,t)=>t>e),(e=>`where index > ${e}`),"greater"),x=g.bind(null,((e,t)=>t<e),(e=>`where index < ${e}`),"smaller"),w={generateMatching:(e,t)=>{const n=Math.max(...t.map(s))+1,r=e.filter((e=>s(e)<n));if(r.length!==e.length&&M(e,t,r))return x(n)},generateContaining:(e,t)=>{const n=Math.max(...t.map(s))+1;return x(n)}},j={generateMatching:(e,t)=>{const n=Math.min(...t.map(s))-1,r=e.filter((e=>s(e)>n));if(r.length!==e.length&&M(e,t,r))return b(n)},generateContaining:(e,t)=>{const n=Math.min(...t.map(s))-1;return b(n)}},S={generateMatching:(e,t)=>P((e=>"exactly and only my selection"),e,t,y,(e=>({type:"equal",children:[{type:"operation",children:[],identifier:"id"},{type:"raw",value:e.index.join(",")}]})),(n=>M(e,t,n))),generateContaining:()=>{}};function O(e,t,n,o){return l(this,void 0,void 0,(function*(){if(t.length===e.length)return;const i=n.map((n=>n.generateMatching(e,t))).filter(r.Dm);if(0===i.length)throw new Error("no pattern found (missing the allPatternType?)");return function(e){for(const t of e)if(null!=t.generateStep)return!1;return!0}(i)?void 0:o(i)}))}function M(e,t,n){if(n.length!==t.length)return!1;for(const r of t)if(!n.includes(r))return!1;return!0}function P(e,t,n,r,o,i){const a=new Map;for(const c of n){const e=r(c);a.has(e)||a.set(e,c)}const l=Array.from(a.keys()),s=t.filter((e=>l.includes(r(e))));if(s.length!==t.length&&0!==a.size&&(null==i||i(s)))return{description:e(l),isSelected:e=>a.has(r(e)),generateStep:()=>Array.from(a.values()).map((e=>o(e))).reduce(((e,t)=>({type:"or",children:[e,t]}))),keySize:a.size,selectionSize:s.length}}var N=n(65201),A=n(82513),E=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function k(e){return"string"===typeof e?e:e.path.join(",")}function C(e){return"string"===typeof e?[e]:e.path}function V(e,t,n){return"string"===typeof e?"string"===typeof t&&e===t:k(e)===(null!==n&&void 0!==n?n:k(t))}function D(e,t,n,o,i){return t.map((t=>{var r;const a=k(t),l=null!==(r=e[a])&&void 0!==r?r:[],s=l.filter((e=>null!=n.find((t=>o(t,e)&&(null==i||i(e))))));if(!(0===s.length&&l.length>0))return{steps:t,values:s,generatePatternCondition:void 0}})).filter(r.Dm)}function z(e,t){if("string"===typeof e){const n=[];for(const{step:r}of t)F(r,e,(e=>n.push(e)));return n}if(e.path.length>1){const n=(0,r.D1)(t,e.path);return null==n?[]:[(0,r.SO)(n,e.path.length-2)]}return[e.path[0]]}function T(e,t,n,o,i){var a;return E(this,void 0,void 0,(function*(){const s=k(n.steps),c=null!==(a=t[s])&&void 0!==a?a:[];if(0===c.length)return e;const u=yield function(e,t,n,o){return l(this,void 0,void 0,(function*(){if(t.length===e.length)return;const i=n.map((n=>n.generateContaining(e,t))).filter(r.Dm);if(0===i.length)throw new Error("no pattern found (missing the allPatternType?)");return o(i)}))}(c.map((({after:e})=>e)),n.values.map((({after:e})=>e)),o,i);return(0,N.vV)(e.map((e=>e===n?Object.assign(Object.assign({},n),{generatePatternCondition:u.generateStep,values:c.filter((({after:e})=>u.isSelected(e)))}):e)))}))}function L(e,t,n,o,i){var a;const l=k(n),s=t.findIndex((e=>V(e.steps,n,l))),c=null!==(a=e[l])&&void 0!==a?a:[];if(-1===s){if("remove"===i)return;return void t.push({steps:n,values:null==o?c:o})}const u=t[s];if(u.generatePatternCondition=void 0,null!=o){for(const e of o){const t=u.values.findIndex((t=>(0,r.Up)(t.after.index,e.after.index)===r.J.Equal));-1!==t||"toggle"!==i&&"add"!==i||u.values.push(e),-1===t||"toggle"!==i&&"remove"!==i||u.values.splice(t,1)}0===u.values.length&&t.splice(s,1)}else"toggle"===i||"remove"===i?t.splice(s,1):u.values=c}function B(e,t,n,r){return(0,N.ZP)("replace"===r?[]:t,(t=>{for(const{steps:o,values:i}of n)L(e,t,o,i,"replace"===r?"add":r)}))}function I(e,t,n,o,i){return(0,N.ZP)({hovered:n,valueMap:e,selectionsList:t},(e=>{for(const{value:a,steps:l}of o){const{valueMap:o,selectionsList:s,hovered:c}=e,u=l.path.join(","),p=t.findIndex((e=>k(e.steps)===u)),f=s[p];let d=o[u];if(!i){if(null==d)return;const t=d.findIndex((e=>(0,r.Up)(e.after.index,a.after.index)===r.J.Equal));if(d.splice(t,1),null!=f){const e=f.values.findIndex((e=>(0,r.Up)(e.after.index,a.after.index)===r.J.Equal));f.values.splice(e,1),0===f.values.length&&s.splice(p,1)}if((null===n||void 0===n?void 0:n.steps)===l&&null!=c){const t=c.values.findIndex((e=>(0,r.Up)(e.after.index,a.after.index)===r.J.Equal));c.values.splice(t,1),0===c.values.length&&(e.hovered=void 0)}}null==d&&(d=[],o[u]=d),null!=f&&d.length===f.values.length&&f.values.push(a),d.push(a)}}))}var q=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function G(e,t,n,o,i,a,l){return q(this,void 0,void 0,(function*(){const s=yield(0,N.ZP)({grammar:l,selectionsList:[]},(({grammar:s,selectionsList:c})=>q(this,void 0,void 0,(function*(){var u,p;const f="parallel"===i?"parallel":"sequential";for(const{values:d,steps:m,generatePatternCondition:h}of t){const t="after"===i?[C(m)]:U(m,l);for(const l of t){const t=l.join(","),m=null!==(u=e[t])&&void 0!==u?u:[];if(m.length>0&&0===d.length)return;const y=(0,A.D1)(s,l);if(null==y)continue;const v=a(l),g="parallel"===f?{type:"null"}:{type:"this"},b="parallel"===i?"before":i,x=null!==h&&void 0!==h?h:null===(p=yield(0,A.TY)(m.map((e=>e[b])),d.map((e=>e[b])),n,o))||void 0===p?void 0:p.generateStep,w=null==x?v:{type:"if",children:[x(),v,g]},j=(0,A.SO)(y,l.length-1),S=l.length>1?(0,A.SO)(y,l.length-2):void 0;if((null===S||void 0===S?void 0:S.type)===f){let e=l[l.length-1];"before"!==i&&(e+=1),S.children.splice(e,0,w),(0,r.bp)(S,...l.slice(0,-1))}else(0,A.pt)(l,y,l.length-1,{type:f,children:"before"===i?[w,j]:[j,w]});const O=v;c.push({steps:O,values:[]})}}}))));return Object.assign(Object.assign({},s),{hovered:void 0,dependencyMap:(0,r.aR)(s.grammar)})}))}var R=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function Q(e,t,n){const o=new Set,i=new Set;for(const{name:a,step:l}of e){const e=(0,r.BZ)(a);i.has(e)||null!=n&&!n.includes(e)||(o.add(a),i.add(e)),(0,r.VB)(l,(e=>{"symbol"===e.type&&e.identifier!==a&&o.add(e.identifier)}))}return{grammar:(0,N.vV)(e.filter((e=>o.has(e.name)))),selectionsList:t.filter((e=>o.has(C(e.steps)[0])))}}function Z(e,t,n,o,i,a){return R(this,void 0,void 0,(function*(){null==(0,r.KD)(i,a)&&(a=(0,N.ZP)(a,(e=>{e.push({name:i,step:{type:"this",path:[i]}})})));const l=yield G(e,t,n,o,"after",(()=>({type:"symbol",identifier:i})),a);return Object.assign(Object.assign({},l),{selectionsList:[{steps:i,values:[]}]})}))}function $(e,t,n,o,i=new Set){const a=(0,r.BW)(t,n),l=(0,r.BW)(t,o),s=e.find((e=>e.name===a));if(null==s)throw new Error(`unknown noun "${a}"`);const c=[],u=(0,N.ZP)(s.step,(t=>((0,r.VB)(t,(t=>{if("symbol"===t.type){const n=(0,r.BZ)(t.identifier);if(n==o)return;const a=(0,r.nH)(t.identifier,n),l=(0,r.BW)(a,o);t.identifier=l,null!=e.find((e=>e.name===l))||i.has(a)||c.push({localNounName:a,descriptionName:n})}})),(0,A.x$)(t,l))));i.add(t);const p={name:l,step:u};return(0,N.vV)(c.reduce(((t,{descriptionName:n,localNounName:r})=>t.concat($(e,r,n,o,i))),[p]))}function W(e,t,n,o,i,a){return R(this,void 0,void 0,(function*(){const l=yield(0,N.ZP)({grammar:a,selectionsList:[]},(({grammar:l,selectionsList:s})=>R(this,void 0,void 0,(function*(){for(const c of t){if("string"!==typeof c.steps)continue;const t=c.steps,u=(0,r.KD)(t,a),p=(0,r.KD)(t,l);if(null!=(0,r.KD)(i,l)||null==u||null==p)continue;const f=(0,A.x$)((0,N.vV)(a[u].step,!1),i);l.splice(p,0,{name:i,step:f});const d=z(t,l);if(d.length>0){const t=D(e,d,c.values,((e,t)=>{const n=(0,r.Up)(e.before.index,t.before.index);return n===r.J.Predecessor||n===r.J.Equal}),void 0);yield X(e,t,n,o,(()=>({type:"symbol",identifier:i})),l)}s.push({steps:i,values:[]})}})))),s=Q(l.grammar,l.selectionsList);return Object.assign(Object.assign({hovered:void 0},s),{dependencyMap:(0,r.aR)(s.grammar)})}))}function F(e,t,n){(0,r.VB)(e,(e=>{"symbol"===e.type&&e.identifier===t&&n(e)}))}var Y=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function U(e,t){if("string"===typeof e){const n=[];for(const{step:r}of t)F(r,e,(e=>n.push(e.path)));return n}return[e.path]}function H(e,t,n,o,i,a){return Y(this,void 0,void 0,(function*(){const l=yield(0,N.Uy)({grammar:a,selectionsList:[]},(({grammar:r,selectionsList:a})=>X(e,t,n,o,i,r,a)));return Object.assign(Object.assign({},l),{dependencyMap:(0,r.aR)(l.grammar),hovered:void 0})}))}function X(e,t,n,o,i,a,l){var s;return Y(this,void 0,void 0,(function*(){for(const{values:c,steps:u,generatePatternCondition:p}of t)for(const t of U(u,a)){const u=t.join(","),f=null!==(s=e[u])&&void 0!==s?s:[],d=(0,r.D1)(a,t);null!=d&&(yield _(f.map((({before:e})=>e)),c.map((({before:e})=>e)),n,o,i,t,d,l,p))}}))}function _(e,t,n,o,i,a,l,s,c){var u,p;return Y(this,void 0,void 0,(function*(){if(e.length>0&&0===t.length)return;const f=(0,r.SO)(l,a.length-1),d=null!==(u=i(f,a,l))&&void 0!==u?u:f,m=(0,N.Js)(f),h=null!==c&&void 0!==c?c:null===(p=yield O(e,t,n,o))||void 0===p?void 0:p.generateStep,y=null==h?d:{type:"if",children:[h(),d,m]};(0,r.pt)(a,l,a.length-1,y);const v=d;null===s||void 0===s||s.push({steps:(0,N.vV)(v),values:[]})}))}var J=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function K(e,t,n,o,i,a){return J(this,void 0,void 0,(function*(){const l=(e,t,n)=>function(e,t,n){if(Array.isArray(e)||"string"==typeof t)return{type:"this"};const r=e.children[t];switch(e.type){case"operation":{const r=n[e.identifier];if(null==r)break;const o=r.defaultParameters[t];return null==o?{type:"null"}:o()}case"sequential":return{type:"this"};case"parallel":case"random":return{type:"this"===r.type?"null":"this"};case"switch":case"if":if(0===t)break;return{type:"this"===r.type?"null":"this"}}}(n[n.length-2],t[t.length-1],i),s=Q(yield(0,N.ZP)(a,(i=>J(this,void 0,void 0,(function*(){yield X(e,t,n,o,l,i);for(const e of i)e.step=ee(e.step);return(0,r.l3)(i)})))),[]);return Object.assign(Object.assign({},s),{dependencyMap:(0,r.aR)(s.grammar),hovered:void 0})}))}function ee(e){if(null==e.children)return e;for(let t=e.children.length-1;t>=0;t--)te(e,t)||(e.children[t]=ee(e.children[t]));return function(e){if("if"===e.type&&"this"===e.children[1].type&&"this"===e.children[2].type)return{type:"this"};if(("parallel"===e.type||"sequential"===e.type)&&1===e.children.length)return e.children[0];return e}(e)}function te(e,t){const n=e.children[t];if(null==n)return!1;switch(e.type){case"sequential":if("this"!==n.type||1===e.children.length)return!1;break;case"parallel":if("null"!==n.type||1===e.children.length)return!1;break;case"random":if("null"!==n.type)return!1;e.probabilities.splice(t,1);break;case"switch":if(0===t)return!1;if("null"!==n.type)return!1;e.cases.splice(t-1,1);break;default:return!1}return e.children.splice(t,1),!0}const ne=[{type:"add"},{type:"and"},{type:"divide"},{type:"equal"},{type:"getVariable"},{type:"greater"},{type:"greaterEqual"},{type:"if"},{type:"invert"},{type:"modulo"},{type:"multiply"},{type:"not"},{type:"or"},{type:"parallel"},{type:"random"},{type:"raw"},{type:"return"},{type:"sequential"},{type:"setVariable"},{type:"smaller"},{type:"smallerEqual"},{type:"subtract"},{type:"switch"},{type:"this"},{type:"unequal"},{type:"null"}];function re(e){return[...Object.keys(e).map((e=>({type:"operation",identifier:e}))),...ne]}function oe(e,t){switch(e.type){case"add":case"multiply":case"subtract":case"divide":case"modulo":case"equal":case"unequal":case"greater":case"greaterEqual":case"smaller":case"smallerEqual":return{type:e.type,children:[{type:"raw",value:2},{type:"raw",value:1}]};case"and":case"or":return{type:e.type,children:[{type:"raw",value:!0},{type:"raw",value:!1}]};case"if":return{type:e.type,children:[{type:"raw",value:!0},{type:"this"},{type:"this"}]};case"parallel":case"sequential":case"random":return{type:e.type,children:[],probabilities:[]};case"switch":return{type:e.type,cases:[],children:[{type:"raw",value:0}]};case"operation":{const n=t[e.identifier];if(null==n)throw new Error(`unknown operation "${e.identifier}"`);return{type:e.type,children:n.defaultParameters.map((e=>e())),identifier:e.identifier}}case"raw":return{type:e.type,value:1};case"getVariable":return{type:e.type,identifier:"x"};case"setVariable":return{type:e.type,identifier:"x",children:[{type:"raw",value:1}]};case"not":return{type:e.type,children:[{type:"raw",value:!0}]};case"invert":return{type:e.type,children:[{type:"raw",value:1}]};case"return":case"this":case"null":return{type:e.type}}}},82513:function(e,t,n){"use strict";n.d(t,{J:function(){return o.J},Ao:function(){return te.Ao},by:function(){return o.by},O$:function(){return te.O$},Q:function(){return te.Q},aR:function(){return o.aR},h$:function(){return K},EU:function(){return te.EU},o9:function(){return te.o9},Qx:function(){return p},br:function(){return O.br},bp:function(){return te.bp},Db:function(){return te.Db},Q3:function(){return o.Q3},Eo:function(){return te.Eo},SO:function(){return o.SO},BZ:function(){return o.BZ},AJ:function(){return o.AJ},Up:function(){return o.Up},Bc:function(){return o.Bc},TY:function(){return te.TY},Ik:function(){return te.Ik},_P:function(){return te._P},MG:function(){return te.MG},zq:function(){return te.zq},Il:function(){return te.Il},gK:function(){return te.gK},z_:function(){return o.z_},BW:function(){return o.BW},IX:function(){return o.IX},hp:function(){return o.hp},z$:function(){return te.z$},au:function(){return te.au},TO:function(){return te.TO},Ug:function(){return te.Ug},W9:function(){return te.W9},$T:function(){return te.$T},Ii:function(){return O.Ii},Lr:function(){return o.Lr},hs:function(){return o.hs},nH:function(){return o.nH},Ej:function(){return o.Ej},lv:function(){return b},Qc:function(){return c},dk:function(){return u},Sg:function(){return o.Sg},im:function(){return te.im},tc:function(){return te.tc},lG:function(){return te.lG},gx:function(){return te.gx},qC:function(){return f},Wv:function(){return S},g3:function(){return d},y0:function(){return j},pt:function(){return o.pt},Sy:function(){return te.qC},wU:function(){return o.wU},QV:function(){return O.QV},Iz:function(){return U},l3:function(){return o.l3},x$:function(){return o.bp},Tn:function(){return O.Tn},D1:function(){return o.D1}});var r=n(67606),o=n(21283),i=n(50985);const a=n.n(i)().compile({returnSymbol:/return/,nullSymbol:/null/,thisSymbol:/this/,ifSymbol:/if/,thenSymbol:/then/,elseSymbol:/else/,switchSymbol:/switch/,caseSymbol:/case/,arrow:/->/,longArrow:/-->/,openBracket:/\(/,closedBracket:/\)/,openCurlyBracket:/{/,closedCurlyBracket:/}/,point:/\./,comma:/,/,colon:/:/,smallerEqual:/<=/,greaterEqual:/>=/,smaller:/</,greater:/>/,doubleEqual:/==/,equal:/=/,unequal:/!=/,and:/&&/,or:/\|\|/,not:/!/,parallel:/\|/,int:/0[Xx][\da-fA-F]+|0[bB][01]+/,number:/-?\d+(?:\.\d+)?/,string:/"[^"]*"/,boolean:/true|false/,plus:/\+/,minus:/-/,multiply:/\*/,percent:/%/,divide:/\//,identifier:/[a-zA-Z_$@']+\w*/,ws:{match:/\s+/,lineBreaks:!0}});var l={Lexer:a,ParserRules:[{name:"GrammarDefinition",symbols:["ws","RuleDefinition","ws"],postprocess:([,e])=>[e]},{name:"GrammarDefinition$ebnf$1",symbols:["RuleDefinitions"]},{name:"GrammarDefinition$ebnf$1",symbols:["GrammarDefinition$ebnf$1","RuleDefinitions"],postprocess:e=>e[0].concat([e[1]])},{name:"GrammarDefinition",symbols:["ws","GrammarDefinition$ebnf$1","RuleDefinition","ws"],postprocess:([,e,t])=>{if(null!=e.find((({name:e})=>e===t.name)))throw new Error(`rule "${identifier}" is already defined`);return[...e,t]}},{name:"GrammarDefinition",symbols:["ws"],postprocess:()=>[]},{name:"RuleDefinitions",symbols:["RuleDefinition",a.has("ws")?{type:"ws"}:ws],postprocess:([e])=>e},{name:"RuleDefinition",symbols:[a.has("identifier")?{type:"identifier"}:identifier,"ws",a.has("longArrow")?{type:"longArrow"}:longArrow,"ws","Steps"],postprocess:([{value:e},,,,t])=>({name:e,step:t})},{name:"Steps",symbols:["ParallelSteps"],postprocess:([e])=>e},{name:"ParallelSteps$ebnf$1",symbols:["ParallelStep"]},{name:"ParallelSteps$ebnf$1",symbols:["ParallelSteps$ebnf$1","ParallelStep"],postprocess:e=>e[0].concat([e[1]])},{name:"ParallelSteps",symbols:["ParallelSteps$ebnf$1","SequentialSteps"],postprocess:([e,t])=>({type:"parallel",children:[...e,t]})},{name:"ParallelSteps",symbols:["SequentialSteps"],postprocess:([e])=>e},{name:"ParallelStep",symbols:["SequentialSteps","ws",a.has("parallel")?{type:"parallel"}:parallel,"ws"],postprocess:([e])=>e},{name:"SequentialSteps$ebnf$1",symbols:["SequentialStep"]},{name:"SequentialSteps$ebnf$1",symbols:["SequentialSteps$ebnf$1","SequentialStep"],postprocess:e=>e[0].concat([e[1]])},{name:"SequentialSteps",symbols:["SequentialSteps$ebnf$1","OrOperation"],postprocess:([e,t])=>({type:"sequential",children:[...e,t]})},{name:"SequentialSteps",symbols:["OrOperation"],postprocess:([e])=>e},{name:"SequentialStep",symbols:["OrOperation","ws",a.has("arrow")?{type:"arrow"}:arrow,"ws"],postprocess:([e])=>e},{name:"OrOperation",symbols:["OrOperation","ws",a.has("or")?{type:"or"}:or,"ws","AndOperation"],postprocess:([e,,,,t])=>({type:"or",children:[e,t]})},{name:"OrOperation",symbols:["AndOperation"],postprocess:([e])=>e},{name:"AndOperation",symbols:["AndOperation","ws",a.has("and")?{type:"and"}:and,"ws","NegateOperation"],postprocess:([e,,,,t])=>({type:"and",children:[e,t]})},{name:"AndOperation",symbols:["NegateOperation"],postprocess:([e])=>e},{name:"NegateOperation",symbols:[a.has("not")?{type:"not"}:not,"ws","NegateOperation"],postprocess:([,,e])=>({type:"not",children:[e]})},{name:"NegateOperation",symbols:["ComparisonOperation"],postprocess:([e])=>e},{name:"ComparisonOperation",symbols:["EquityOperation"],postprocess:([e])=>e},{name:"EquityOperation",symbols:["EqualOperation"],postprocess:([e])=>e},{name:"EquityOperation",symbols:["UnequalOperation"],postprocess:([e])=>e},{name:"EquityOperation",symbols:["RelationalOperation"],postprocess:([e])=>e},{name:"EqualOperation",symbols:["EquityOperation","ws",a.has("doubleEqual")?{type:"doubleEqual"}:doubleEqual,"ws","RelationalOperation"],postprocess:([e,,,,t])=>({type:"equal",children:[e,t]})},{name:"UnequalOperation",symbols:["EquityOperation","ws",a.has("unequal")?{type:"unequal"}:unequal,"ws","RelationalOperation"],postprocess:([e,,,,t])=>({type:"unequal",children:[e,t]})},{name:"RelationalOperation",symbols:["SmallerOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["SmallerEqualOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["GreaterOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["GreaterEqualOperation"],postprocess:([e])=>e},{name:"RelationalOperation",symbols:["ArithmeticOperation"],postprocess:([e])=>e},{name:"SmallerOperation",symbols:["RelationalOperation","ws",a.has("smaller")?{type:"smaller"}:smaller,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"smaller",children:[e,t]})},{name:"SmallerEqualOperation",symbols:["RelationalOperation","ws",a.has("smallerEqual")?{type:"smallerEqual"}:smallerEqual,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"smallerEqual",children:[e,t]})},{name:"GreaterOperation",symbols:["RelationalOperation","ws",a.has("greater")?{type:"greater"}:greater,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"greater",children:[e,t]})},{name:"GreaterEqualOperation",symbols:["RelationalOperation","ws",a.has("greaterEqual")?{type:"greaterEqual"}:greaterEqual,"ws","ArithmeticOperation"],postprocess:([e,,,,t])=>({type:"greaterEqual",children:[e,t]})},{name:"ArithmeticOperation",symbols:["LineOperation"],postprocess:([e])=>e},{name:"LineOperation",symbols:["AddOperation"],postprocess:([e])=>e},{name:"LineOperation",symbols:["SubtractOperation"],postprocess:([e])=>e},{name:"LineOperation",symbols:["PointOperation"],postprocess:([e])=>e},{name:"AddOperation",symbols:["LineOperation","ws",a.has("plus")?{type:"plus"}:plus,"ws","PointOperation"],postprocess:([e,,,,t])=>({type:"add",children:[e,t]})},{name:"SubtractOperation",symbols:["LineOperation","ws",a.has("minus")?{type:"minus"}:minus,"ws","PointOperation"],postprocess:([e,,,,t])=>({type:"subtract",children:[e,t]})},{name:"PointOperation",symbols:["MultiplyOperation"],postprocess:([e])=>e},{name:"PointOperation",symbols:["DivideOperation"],postprocess:([e])=>e},{name:"PointOperation",symbols:["ModuloOperation"],postprocess:([e])=>e},{name:"PointOperation",symbols:["InvertOperation"],postprocess:([e])=>e},{name:"DivideOperation",symbols:["PointOperation","ws",a.has("divide")?{type:"divide"}:divide,"ws","InvertOperation"],postprocess:([e,,,,t])=>({type:"divide",children:[e,t]})},{name:"MultiplyOperation",symbols:["PointOperation","ws",a.has("multiply")?{type:"multiply"}:multiply,"ws","InvertOperation"],postprocess:([e,,,,t])=>({type:"multiply",children:[e,t]})},{name:"ModuloOperation",symbols:["PointOperation","ws",a.has("percent")?{type:"percent"}:percent,"ws","InvertOperation"],postprocess:([e,,,,t])=>({type:"modulo",children:[e,t]})},{name:"InvertOperation",symbols:[a.has("minus")?{type:"minus"}:minus,"ws","InvertOperation"],postprocess:([,,e])=>({type:"invert",children:[e]})},{name:"InvertOperation",symbols:["Step"],postprocess:([e])=>e},{name:"Step",symbols:["Operation"],postprocess:([e])=>e},{name:"Step",symbols:["Symbol"],postprocess:([e])=>e},{name:"Step",symbols:[a.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol],postprocess:()=>({type:"this"})},{name:"Step",symbols:["GetVariable"],postprocess:([e])=>e},{name:"Step",symbols:["SetVariable"],postprocess:([e])=>e},{name:"Step",symbols:["Constant"],postprocess:([e])=>({type:"raw",value:e})},{name:"Step",symbols:["Conditional"],postprocess:([e])=>e},{name:"Step",symbols:[a.has("returnSymbol")?{type:"returnSymbol"}:returnSymbol],postprocess:()=>({type:"return"})},{name:"Step",symbols:[a.has("nullSymbol")?{type:"nullSymbol"}:nullSymbol],postprocess:()=>({type:"null"})},{name:"Step",symbols:[a.has("openBracket")?{type:"openBracket"}:openBracket,"ws","Steps","ws",a.has("closedBracket")?{type:"closedBracket"}:closedBracket],postprocess:([,,e])=>e},{name:"Step",symbols:["Random"],postprocess:([e])=>e},{name:"Random$ebnf$1",symbols:[]},{name:"Random$ebnf$1",symbols:["Random$ebnf$1","RandomStep"],postprocess:e=>e[0].concat([e[1]])},{name:"Random",symbols:[a.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"Random$ebnf$1","ws",a.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,e])=>({type:"random",probabilities:e.map((({probability:e})=>e)),children:e.map((({steps:e})=>e))})},{name:"RandomStep",symbols:["ws",a.has("number")?{type:"number"}:number,a.has("percent")?{type:"percent"}:percent,"ws",a.has("colon")?{type:"colon"}:colon,"ws","Steps"],postprocess:([,{value:e},,,,,t])=>({probability:Number.parseFloat(e)/100,steps:t})},{name:"Operation",symbols:[a.has("identifier")?{type:"identifier"}:identifier,a.has("openBracket")?{type:"openBracket"}:openBracket,"EmptyParameters","ws",a.has("closedBracket")?{type:"closedBracket"}:closedBracket],postprocess:([{value:e},,t])=>({type:"operation",children:t,identifier:e})},{name:"EmptyParameters",symbols:["ws","Parameters"],postprocess:([,e])=>e},{name:"EmptyParameters",symbols:[],postprocess:()=>[]},{name:"Parameters$ebnf$1",symbols:[]},{name:"Parameters$ebnf$1",symbols:["Parameters$ebnf$1","Parameter"],postprocess:e=>e[0].concat([e[1]])},{name:"Parameters",symbols:["Parameters$ebnf$1","Steps"],postprocess:([e,t])=>[...e,t]},{name:"Parameter",symbols:["Steps","ws",a.has("comma")?{type:"comma"}:comma,"ws"],postprocess:([e])=>e},{name:"Symbol",symbols:[a.has("identifier")?{type:"identifier"}:identifier],postprocess:([{value:e}])=>({type:"symbol",identifier:e})},{name:"ws",symbols:[a.has("ws")?{type:"ws"}:ws]},{name:"ws",symbols:[]},{name:"Constant",symbols:[a.has("boolean")?{type:"boolean"}:boolean],postprocess:([{value:e}])=>"true"===e},{name:"Constant",symbols:[a.has("string")?{type:"string"}:string],postprocess:([{value:e}])=>e.slice(1,-1)},{name:"Constant",symbols:[a.has("number")?{type:"number"}:number],postprocess:([{value:e}])=>Number.parseFloat(e)},{name:"Constant",symbols:[a.has("int")?{type:"int"}:int],postprocess:([{value:e}])=>Number.parseInt(e)},{name:"GetVariable",symbols:[a.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol,a.has("point")?{type:"point"}:point,a.has("identifier")?{type:"identifier"}:identifier],postprocess:([,,{value:e}])=>({type:"getVariable",identifier:e})},{name:"SetVariable",symbols:[a.has("thisSymbol")?{type:"thisSymbol"}:thisSymbol,a.has("point")?{type:"point"}:point,a.has("identifier")?{type:"identifier"}:identifier,"ws",a.has("equal")?{type:"equal"}:equal,"ws","Step"],postprocess:([,,{value:e},,,,t])=>({type:"setVariable",identifier:e,children:[t]})},{name:"Conditional",symbols:["IfThenElse"],postprocess:([e])=>e},{name:"Conditional",symbols:["Switch"],postprocess:([e])=>e},{name:"IfThenElse",symbols:[a.has("ifSymbol")?{type:"ifSymbol"}:ifSymbol,a.has("ws")?{type:"ws"}:ws,"Steps",a.has("ws")?{type:"ws"}:ws,"Then","ws","Else"],postprocess:([,,e,,t,,n])=>({type:"if",children:[e,t,n]})},{name:"Then",symbols:[a.has("thenSymbol")?{type:"thenSymbol"}:thenSymbol,"ws",a.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"ws","Steps","ws",a.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,,,e])=>e},{name:"Else",symbols:[a.has("elseSymbol")?{type:"elseSymbol"}:elseSymbol,"ws",a.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"ws","Steps","ws",a.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,,,e])=>e},{name:"Switch$ebnf$1",symbols:[]},{name:"Switch$ebnf$1",symbols:["Switch$ebnf$1","SwitchCases"],postprocess:e=>e[0].concat([e[1]])},{name:"Switch",symbols:[a.has("switchSymbol")?{type:"switchSymbol"}:switchSymbol,a.has("ws")?{type:"ws"}:ws,"Steps","ws",a.has("openCurlyBracket")?{type:"openCurlyBracket"}:openCurlyBracket,"Switch$ebnf$1","ws",a.has("closedCurlyBracket")?{type:"closedCurlyBracket"}:closedCurlyBracket],postprocess:([,,e,,,t])=>({type:"switch",cases:t.map((({caseValues:e})=>e)),children:[e,...t.map((({steps:e})=>e))]})},{name:"SwitchCases$ebnf$1",symbols:["SwitchCase"]},{name:"SwitchCases$ebnf$1",symbols:["SwitchCases$ebnf$1","SwitchCase"],postprocess:e=>e[0].concat([e[1]])},{name:"SwitchCases",symbols:["ws","SwitchCases$ebnf$1","Steps"],postprocess:([,e,t])=>({caseValues:e,steps:t})},{name:"SwitchCase",symbols:[a.has("caseSymbol")?{type:"caseSymbol"}:caseSymbol,a.has("ws")?{type:"ws"}:ws,"Constant",a.has("colon")?{type:"colon"}:colon,"ws"],postprocess:([,,e])=>e}],ParserStart:"GrammarDefinition"};const s=r.Grammar.fromCompiled(l);function c(e){const t=new r.Parser(s);if(t.feed(e),0===t.results.length)throw new Error("unexpected end of input");return t.results[0]}function u(e,t){const n=c(e);return(0,o.z_)(n,t)}function p(e,t,n,r){const i={fromStep:(e,n,r)=>function(e,t,n,r,i){if(null!=e&&"string"!=typeof t&&(0,o.rL)(e,t))return n.join(n.fromText("(",t),n.getWhitespace(i+1,t),r(i+1,t),n.getWhitespace(i,t),n.fromText(")",t));return r(i,t)}(n,r,i,t,e),fromText:e,getWhitespace:r,join:n};return i}function f(e,t){return t.join(...e.map((({name:e,step:n},r)=>{const o=t.fromStep(0,void 0,e),i=t.fromText(" --\x3e",e),a=t.getWhitespace(1,n),l=t.fromStep(1,void 0,n);return 0===r?t.join(o,i,a,l):t.join(t.getWhitespace(0,e),o,i,a,l)})))}function d(e,t,n=0){switch(e.type){case"operation":return function(e,t,n){const r=t.getWhitespace(n,e),o=t.getWhitespace(n+1,e);return t.join(t.fromText(`${e.identifier}(`,e),...v(e.children.map((r=>t.join(o,t.fromStep(n+1,e,r)))),t.fromText(",",e)),r,t.fromText(")",e))}(e,t,n);case"parallel":return function(e,t,n){const r=t.getWhitespace(n,e);return t.join(...v(e.children.map((r=>t.fromStep(n,e,r))),t.join(t.fromText(" |",e),r)))}(e,t,n);case"raw":return function(e,t,n){return t.fromText(y(e.value),e)}(e,t);case"sequential":return function(e,t,n){const r=t.getWhitespace(n,e);return t.join(...v(e.children.map((r=>t.fromStep(n,e,r))),t.join(t.fromText(" ->",e),r)))}(e,t,n);case"symbol":return function(e,t,n){return t.fromText(e.identifier,e)}(e,t);case"this":return function(e,t,n){return t.fromText("this",e)}(e,t);case"invert":case"not":return function(e,t,n){switch(e.type){case"invert":return t.join(t.fromText("-",e),t.fromStep(n,e,e.children[0]));case"not":return t.join(t.fromText("!",e),t.fromStep(n,e,e.children[0]))}}(e,t,n);case"add":case"and":case"divide":case"equal":case"greater":case"greaterEqual":case"modulo":case"multiply":case"or":case"smaller":case"smallerEqual":case"subtract":case"unequal":return function(e,t,n){return t.join(t.fromStep(n,e,e.children[0]),t.fromText(` ${h[e.type]} `,e),t.fromStep(n,e,e.children[1]))}(e,t,n);case"if":return function(e,t,n){const[r,o,i]=e.children,a=t.getWhitespace(n+1,r),l=t.getWhitespace(n,r),s=t.getWhitespace(n+1,o,i),c=t.getWhitespace(n,o,i);return t.join(t.fromText("if",e),a,t.fromStep(n+1,e,r),l,t.fromText("then {",e),s,t.fromStep(n+1,e,o),c,t.fromText("} else {",e),s,t.fromStep(n+1,e,i),c,t.fromText("}",e))}(e,t,n);case"switch":return function(e,t,n){const r=t.getWhitespace(n,e),o=t.getWhitespace(n+1,e);return t.join(t.fromText("switch",e),t.getWhitespace(n+1,e.children[0]),t.fromStep(n+1,e,e.children[0]),r,t.fromText("{",e),...e.cases.map(((r,i)=>[...r.reduce(((n,r)=>[...n,o,t.fromText(`case ${y(r)}:`,e)]),[]),t.getWhitespace(n+2,e.children[i+1]),t.fromStep(n+2,e,e.children[i+1])])).reduce(((e,t)=>e.concat(t)),[]),r,t.fromText("}",e))}(e,t,n);case"getVariable":return function(e,t,n){return t.fromText(`this.${e.identifier}`,e)}(e,t);case"setVariable":return function(e,t,n){return t.join(t.fromText(`this.${e.identifier} =`,e),t.getWhitespace(n+1,e.children[0]),t.fromStep(n+1,e,e.children[0]))}(e,t,n);case"return":return function(e,t,n){return t.fromText("return",e)}(e,t);case"random":return function(e,t,n){if(e.children.length!=e.probabilities.length)throw new Error("random step must have the same amount of childrens as the amount of probabilities");const r=t.getWhitespace(n,e),o=t.getWhitespace(n+1,e);return t.join(t.fromText("{",e),...e.children.map(((r,i)=>[o,t.fromText(`${m(100*e.probabilities[i],2)}%:`,e),o,t.fromStep(n+1,e,r)])).reduce(((e,t)=>e.concat(t)),[]),r,t.fromText("}",e))}(e,t,n);case"null":return function(e,t,n){return t.fromText("null",e)}(e,t)}}function m(e,t){const n=Math.pow(10,t);return(Math.round(e*n)/n).toString()}const h={add:"+",and:"&&",divide:"/",equal:"==",greater:">",greaterEqual:">=",modulo:"%",multiply:"*",or:"||",smaller:"<",smallerEqual:"<=",subtract:"-",unequal:"!="};function y(e){switch(typeof e){case"string":return`"${e}"`;case"number":return""+Math.round(100*e)/100;case"boolean":return e.toString();default:throw new Error(`constant "${e}" of unexpected type`)}}function v(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e[r]),r<e.length-1&&n.push(t);return n}function g(e,...t){return"string"===typeof t[0]?"\n":" "}function b(e,...t){for(const n of t){if("string"===typeof n)return"\n\n";if(x(n)>2)return`\n${"\t".repeat(e)}`}return" "}function x(e){var t,n;return null!==(n=null===(t=e.children)||void 0===t?void 0:t.reduce(((e,t)=>e+x(t)+1),0))&&void 0!==n?n:0}function w(e=(()=>{}),t=g){const n=p((e=>e),((t,r)=>{var o;return null!==(o=e(r))&&void 0!==o?o:"string"===typeof r?r:d(r,n,t)}),((...e)=>e.join("")),t);return n}function j(e,t=(()=>{}),n=g){return f(e,w(t,n))}function S(e,t=0,n=(()=>{}),r=g){return w(n,r).fromStep(t,void 0,e)}var O=n(16195),M=n(96102);class P{constructor(){this.matrix=[]}set(e,t,n){if(t>e){const n=t;t=e,e=n}let r=this.matrix[t];null==r&&(r=[],this.matrix[t]=r),r[e]=n}get(e,t){if(t>e){const n=t;t=e,e=n}return this.matrix[t][e]}}function N(e,t,n,r=0,o=e[0].horizontal.length,i=new Array(e.length).fill(void 0).map(((e,t)=>t)),a=1){if(0===i.length)throw new Error("unable to nest group with a height 0 zero (yList.length == 0)");if(1===i.length)return V(n.nestVerticalGroups(e,t,n,r,o,i,a),n.filterValue);let l,s,c;const u=new P;for(const p of i)for(const f of i){if(f<=p)continue;const i=n.rowSimilarity(e,t,n,a,r,o,p,f);u.set(p,f,i),(null==c||i<c)&&(l=p,s=f,c=i)}return c<n.minRowSimilarity?[C(A(e,t,n,u,l,s,c>=0,r,o,i,a))]:V(n.nestVerticalGroups(e,t,n,r,o,i,a),n.filterValue)}function A(e,t,n,r,o,i,a,l,s,c,u){const p=[o],f=[i],d=new Set(c);d.delete(o),d.delete(i);let m=e[o].probability,h=e[i].probability;for(;d.size>0;){const{similarity:t,y:n}=E(p,d,r),{similarity:o,y:i}=E(f,d,r);t>=o?(p.push(n),d.delete(n),m+=e[n].probability):(f.push(i),d.delete(i),h+=e[i].probability)}p.sort(),f.sort();const{child:y,parent:v}=k(m,u),{child:g,parent:b}=k(h,u);return{compatible:a,vertical:[{group:N(e,t,n,l,s,p,y),probability:v},{group:N(e,t,n,l,s,f,g),probability:b}]}}function E(e,t,n){let r,o;for(const i of t){let t=0;for(const r of e)t+=n.get(i,r);t/=e.length,(null==r||t>r)&&(r=t,o=i)}return{similarity:r,y:o}}function k(e,t){return t*e<=1?{parent:e*t,child:1/e}:{parent:1,child:t}}function C(e,t=1){return{vertical:e.vertical.reduce(((n,{group:r,probability:o})=>{const i=o*t;return Array.isArray(r)&&1===r.length&&r[0].compatible===e.compatible?n.concat(C(r[0],i).vertical):n.concat({group:r,probability:i})}),[]),compatible:e.compatible}}function V(e,t,n=1){return e.reduce(((e,r)=>{if(1===r.vertical.length){const{group:o,probability:i}=r.vertical[0];if(Array.isArray(o)){const r=V(o,t,i*n);return[...e,...r]}if(!t(o))return e}return[...e,{vertical:r.vertical.map((({group:e,probability:t})=>({group:e,probability:t*n}))),compatible:r.compatible}]}),[])}function D(e,t,n){switch(e.type){case"random":return function(e,t,n){return e.children.map(((r,o)=>D(r,t,e.probabilities[o]*n))).reduce(((e,t)=>T(e,t,!0)))}(e,t,n);case"if":return function(e,t,n){return T(L(D(e.children[1],t,n/2),(n=>({horizontal:[{type:"filterStart",children:[D(e.children[0],t,1)],values:[!0],options:2},...n.horizontal,{type:"filterEnd"}],probability:n.probability}))),L(D(e.children[2],t,n/2),(n=>({horizontal:[{type:"filterStart",children:[D(e.children[0],t,1)],values:[!1],options:2},...n.horizontal,{type:"filterEnd"}],probability:n.probability}))),!0)}(e,t,n);case"sequential":return function(e,t,n){const{seperationMatrix:r,vertical:o}=e.children.map((e=>D(e,t,1))).reduce(((e,t)=>function(e,t){const n=[],r=[];for(let o=0;o<e.vertical.length;o++)for(let i=0;i<t.vertical.length;i++){const a=o*t.vertical.length+i;n[a]={horizontal:[...e.vertical[o].horizontal,...t.vertical[i].horizontal],probability:e.vertical[o].probability*t.vertical[i].probability};for(let n=0;n<e.vertical.length;n++)for(let l=0;l<t.vertical.length;l++){const s=n*t.vertical.length+l;let c=r[a],u=r[s];null==c&&(c=[],r[a]=c),null==u&&(u=[],r[s]=u);const p=e.seperationMatrix[o][n]&&t.seperationMatrix[i][l];c[s]=p,u[a]=p}}return{vertical:n,seperationMatrix:r}}(e,t)));return{seperationMatrix:r,vertical:o.map((({horizontal:e,probability:t})=>({horizontal:e,probability:t*n})))}}(e,t,n);case"parallel":return function(e,t,n){return e.children.map((e=>D(e,t,n))).reduce(((e,t)=>T(e,t,!1)))}(e,t,n);case"switch":return function(e,t,n){const r=n/(e.children.length-1),o=D(e.children[0],t,1);return e.children.slice(1).map(((n,i)=>L(D(n,t,r),(t=>({horizontal:[{type:"filterStart",children:[o],values:e.cases[i],options:e.children.length-1},...t.horizontal,{type:"filterEnd"}],probability:t.probability}))))).reduce(((e,t)=>T(e,t,!0)))}(e,t,n);case"symbol":return function(e,t,n){return L(D(t(e.identifier),t,n),(t=>({horizontal:[{type:"nounStart",identifier:e.identifier},...t.horizontal,{type:"nounEnd"}],probability:t.probability})))}(e,t,n);default:return{seperationMatrix:[[!0]],vertical:[{probability:n,horizontal:[z(e,t)]}]}}}function z(e,t){return null!=e.children?Object.assign(Object.assign({},e),{children:e.children.map((e=>D(e,t,1)))}):e}function T(e,t,n){const r=e.seperationMatrix.map((e=>e.concat(new Array(t.vertical.length).fill(n)))),o=t.seperationMatrix.map((t=>new Array(e.vertical.length).fill(n).concat(t)));return{vertical:e.vertical.concat(t.vertical),seperationMatrix:r.concat(o)}}function L(e,t){return{seperationMatrix:e.seperationMatrix,vertical:e.vertical.map(t)}}function B(e,t,n,r,o){const i=[];for(const a of o){let o=i.find((o=>t(e[o[0]].horizontal[r],e[a].horizontal[r])>=n));null==o&&(o=[],i.push(o)),o.push(a)}return i}function I(e,t){if(0===t.length)return{type:"this"};const n=t[0].value;switch(n.type){case"filterStart":case"filterEnd":case"nounStart":case"nounEnd":throw new Error(`unable to combine "${n.type}" here (should be done earlier)`);case"this":case"null":case"raw":case"getVariable":return n;default:return Object.assign(Object.assign({},n),{children:null==n.children?void 0:q(t.map((({value:e})=>e.children)),t.map((({probability:e})=>e)),e.createNoun)})}}function q(e,t,n){const r=Math.max(...e.map((e=>e.length)));return new Array(r).fill(void 0).map(((r,i)=>Y(e.map(((e,n)=>{const r=e[i],o=t[n];if(null!=r)return function(e,t){return{seperationMatrix:e.seperationMatrix,vertical:e.vertical.map((e=>({horizontal:e.horizontal,probability:e.probability*t})))}}(r,o)})).filter(o.Dm).reduce(((e,t)=>T(e,t,!0))),n)))}function G(e,t){const{maxSimilarity:n,similarity:r}=R(e,t);return r/n}function R(e,t){if(e.type!==t.type)return{similarity:0,maxSimilarity:1};switch(e.type){case"filterStart":if(typeof e.values[0]!==typeof t.values[0])return{similarity:0,maxSimilarity:1};break;case"setVariable":case"operation":if(e.identifier!==t.identifier)return{similarity:0,maxSimilarity:1};break;case"getVariable":case"nounStart":return{similarity:e.identifier===t.identifier?1:0,maxSimilarity:1};case"raw":return{similarity:e.value===t.value?1:0,maxSimilarity:1};case"filterEnd":case"nounEnd":return{similarity:1,maxSimilarity:1}}if(null==e.children)return{similarity:1,maxSimilarity:1};const{maxSimilarity:n,similarity:r}=function(e,t){let n=0,r=0;for(let o=0;o<Math.max(e.length,t.length);o++){const i=e[o],a=t[o];if(null==i||null==a){r++;continue}const{maxSimilarity:l,similarity:s}=Q(i,a);n+=s,r+=l}return{similarity:n,maxSimilarity:r}}(e.children,t.children);return{maxSimilarity:n+1,similarity:r+1}}function Q(e,t){return 1===e.vertical.length&&1===e.vertical[0].horizontal.length&&1===t.vertical.length&&1===t.vertical[0].horizontal.length?R(e.vertical[0].horizontal[0],t.vertical[0].horizontal[0]):{similarity:1,maxSimilarity:2}}function Z(e,t,n,r,i,a,l,s){let c=0,u=0;for(let p=i;p<a;p++){const t=e[l].horizontal[p],r=e[s].horizontal[p];if(!("filterEnd"===t.type&&"filterEnd"===r.type||"nounEnd"===t.type&&"nounEnd"===r.type||"this"===t.type&&"this"===r.type)&&(++u,!(G(t,r)<n.minValueSimilarity)&&(c++,"filterStart"===t.type&&"filterStart"===r.type&&!(0,o.wU)(t.values,r.values)))){let t=1,n=1;for(;t>0&&n>0&&p<a;){p++;const r=e[l].horizontal[p],o=e[s].horizontal[p];"filterStart"===r.type?t++:"filterEnd"===r.type&&t--,"filterStart"===o.type?n++:"filterEnd"===o.type&&n--}}}return 0===u?c=1:c/=u,t[l][s]?(e[l].probability+e[s].probability)*r>1+o.Ib&&(c=-1.5):c=-3,c}function $(e){if(!Array.isArray(e))return e;const t=e.map((e=>{const t=[],n=new Set(e.vertical);let r,i;for(;n.size>0;){const[a]=n;let l;if(e.compatible&&null!=r&&null!=i&&null!=(l=W(n,i))){n.delete(l),r.children.push($(l.group)),r.probabilities.push(l.probability),i+=l.probability;continue}n.delete(a);const s=$(a.group);e.compatible?(0,o.Gc)(a.probability,1)?(t.push(s),r=void 0,i=void 0):(r={type:"random",children:[s],probabilities:[a.probability]},i=a.probability,t.push(r)):(t.push((0,o.Gc)(a.probability,1)?s:{type:"random",children:[s],probabilities:[a.probability]}),r=void 0,i=void 0)}return 1===t.length?t[0]:{type:"parallel",children:t}}));return 0===t.length?{type:"this"}:1===t.length?t[0]:{type:"sequential",children:t}}function W(e,t){if((0,o.Gc)(t,1))return;const n=1-t+o.Ib;let r,i;for(const o of e)o.probability>n||(null==i||o.probability>i)&&(i=o.probability,r=o);return r}const F=(e,t,n,r,i,a,l)=>{var s,c;let u,p;const f=new Array(a.length).fill(!1),d=new Array(a.length).fill(0);for(let o=r;o<i;o++){for(let t=0;t<a.length;t++){const n=a[t],r=e[n].horizontal[o];"filterStart"!==r.type&&"nounStart"!==r.type||(u=o,d[t]=1,p=r,f[t]=!0)}if(null!=u)break}if(null==u||null==p)return function(e,t,n,r,o,i,a,l,s,c){if(l-a<=0)throw new Error("unable to nest vertical groups with with <= 0");let u=B(e,r,o,a,s),p=a;for(let m=a+1;m<l;m++){const t=B(e,r,o,m,s);t.length<u.length&&(u=t,p=m)}const f=[];p-a>0&&f.push(...N(e,t,i,a,p,s,c));const d={compatible:!0,vertical:[]};f.push(d);for(const m of u){const t=m.reduce(((t,n)=>t+e[n].probability),0),r=t*c;d.vertical.push({group:n(i,m.map((n=>({value:e[n].horizontal[p],probability:e[n].probability/t})))),probability:r})}return l-(p+1)>0&&f.push(...N(e,t,i,p+1,l,s,c)),f}(e,t,I,G,n.minValueSimilarity,n,r,i,a,l);const m=a.reduce(((t,n)=>t+e[n].probability),0),h=m*l,y=1/m,v=e.map((e=>({horizontal:[...e.horizontal],probability:e.probability}))),g=[];u-r>0&&g.push(...N(e,t,n,r,u,a,l));let b,x=u+1,w=!1;for(;!w&&x<i;){w=!0;for(let t=0;t<a.length;t++){const n=a[t],r=e[n].horizontal[x];"filterStart"===r.type||"nounStart"===r.type?d[t]++:"filterEnd"!==r.type&&"nounEnd"!==r.type||d[t]--,0===d[t]?f[t]&&(f[t]=!1,v[n].horizontal[x]={type:"this"}):w=!1}x++}if("filterStart"===p.type){const r=[],i=[],p=[];let f=!0;for(let t=0;t<a.length;t++){const n=a[t],l=e[n].horizontal[u];if("filterStart"!==l.type){i.push(t);continue}p[t]=L(l.children[0],(({horizontal:t})=>({horizontal:t,probability:e[n].probability*y}))),1===l.values.length&&"boolean"===typeof l.values[0]||(f=!1);let s=r.find((({values:e})=>(0,o.wU)(e,l.values)));null==s&&(s={values:l.values,yList:[]},r.push(s)),s.yList.push(n)}for(const t of a){"filterStart"===e[t].horizontal[u].type&&(v[t].probability*=r.length)}for(const o of i){const i=a[o];let s,c;for(const e of r){let r=0;for(const o of e.yList)r+=Z(v,t,n,l,u+1,x,i,o);r/=e.yList.length,(null==s||r>s)&&(s=r,c=e)}c.yList.push(i),p[o]={vertical:[{horizontal:[{type:"raw",value:c.values[0]}],probability:e[i].probability*y}],seperationMatrix:[[!0]]}}const d=Y(p.reduce(((e,t)=>T(e,t,!0))),n.createNoun);if(f){const e=null===(s=r.find((({values:e})=>!0===e[0])))||void 0===s?void 0:s.yList,o=null===(c=r.find((({values:e})=>!1===e[0])))||void 0===c?void 0:c.yList;b={type:"if",children:[d,null==e?{type:"null"}:$(N(v,t,n,u+1,x,e,y)),null==o?{type:"null"}:$(N(v,t,n,u+1,x,o,y))]}}else b={type:"switch",cases:r.map((({values:e})=>e)),children:[d,...r.map((({yList:e})=>$(N(v,t,n,u+1,x,e,y))))]}}else{const e=n.createNoun(p.identifier);e.step=$(N(v,t,n,u+1,x,a,y)),b={type:"symbol",identifier:e.name}}return g.push({compatible:!0,vertical:[{group:b,probability:h}]}),i-x>0&&g.push(...N(e,t,n,x,i,a,l)),g};function Y({seperationMatrix:e,vertical:t},n,r=1){return $(N(function(e,t,n){const r=e[0],o=[...r.horizontal],i=[{horizontal:[...r.horizontal],probability:r.probability}];for(let a=1;a<e.length;a++){const r=e[a],l=[...r.horizontal],s=(0,M.Bm)(o,l,{comparator:n});let c=0;for(const e of s){const n=e.value.length;if(e.added){o.splice(c,0,...e.value);for(const e of i)e.horizontal.splice(c,0,...new Array(n).fill(void 0).map((()=>t())))}else e.removed&&l.splice(c,0,...new Array(n).fill(void 0).map((()=>t())));c+=n}i.push({horizontal:l,probability:r.probability})}return i}(t,(()=>({type:"this"})),((e,t)=>G(e,t)>=.1)),e,{createNoun:n,nestVerticalGroups:F,filterValue:e=>"this"!=e.type,minRowSimilarity:.1,minValueSimilarity:.1,rowSimilarity:Z},void 0,void 0,void 0,r))}function U(...e){const t=[],n={name:e[0][0].name,step:{type:"this"}};return t.push(n),n.step=function(e,t,n){const r=1/e.length;return Y(e.map(((e,t)=>D(e,n[t],r))).reduce(((e,t)=>T(e,t,!0))),t)}(e.map((e=>e[0].step)),(e=>{const n={name:H(e,t),step:{type:"this"}};return t.push(n),n}),e.map((e=>t=>{const n=e.find((({name:e})=>t===e));if(null==n)throw new Error(`unknown noun "${t}"`);return n.step}))),t}function H(e,t){for(const{name:n}of t)if(n===e)return H(`${e}'`,t);return e}var X=n(8867),_=n(77340),J=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{s(r.next(e))}catch(t){i(t)}}function l(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))};function K(e,t,n,r){return J(this,void 0,void 0,(function*(){const o=yield function(e,t,n,r){return J(this,void 0,void 0,(function*(){const o=new Map;return yield(0,X.n)((0,_.of)(e).pipe((0,O.Tn)(),(0,O.Ii)(t,n,Object.assign(Object.assign({},r),{listeners:{onRandom:(e,t,n)=>{let r=o.get(e);null==r&&(r=[],o.set(e,r)),r.push([t.index.join(","),n])}}})))),o}))}(e,t,n,r);return function(e,t){return e.map((({name:e,step:n})=>({name:e,step:ee(n,t)})))}(t,o)}))}function ee(e,t){if("random"===e.type){const n=t.get(e);if(null==n)return{type:"null"};const r=new Map;for(const[e,t]of n){let n=r.get(t);null==n&&(n=[],r.set(t,n)),n.push(e)}const o=Array.from(r.keys()).map((t=>e.children[t]));return 1===o.length?o[0]:{type:"switch",children:[{type:"operation",children:[],identifier:"id"},...o],cases:Array.from(r.values())}}return null==e.children?e:Object.assign(Object.assign({},e),{children:e.children.map((e=>ee(e,t)))})}var te=n(91e3)},16195:function(e,t,n){"use strict";n.d(t,{u4:function(){return r},Ht:function(){return E},br:function(){return M},JY:function(){return k},Ii:function(){return T},QV:function(){return C},bd:function(){return V},Tn:function(){return G},TH:function(){return N}});var r,o=n(18170),i=n(80598),a=n(3184),l=n(25900),s=n(21026),c=n(16621),u=n(36431),p=n(66427),f=n(4534),d=n(71556),m=n(77340),h=n(77506),y=n(85314),v=n(55954),g=n(21283),b=n(62598),x=n(54340),w=n(32384),j=n(41952),S=n(96562),O=n(8167);function M(e){return t=>{const n=new a.t(1);return t.pipe((0,u.b)((()=>n.next())),(0,x.f)(n.pipe((0,w.b)(e))),(0,j.x)((()=>n.complete())))}}function P(e,t,n,o,i,a,l){const s=null==i?e:i(e),c=A(n,o.index),u=t[c];return null!=t[c]&&function(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)if(e[r]!=t[r])return!1;return!0}(u,o.index)&&(l(s,c),t.splice(c,1)),o.type===r.SET&&(a(s,o.value,c),t.splice(c,0,o.index)),s}function N(){return e=>e.pipe((0,d.z)((e=>e.invalid.value?S.C:(0,l.T)((0,m.of)({index:e.index,type:r.SET,value:e}),e.invalid.observable.pipe((0,v.q)(1),(0,O.h)({index:e.index,type:r.UNSET}))))))}function A(e,t){if(0===t.length)return 0;if(!Array.isArray(e))return 0;const n=t[0];let r=0;for(let o=0;o<n;o++)r+=k(e[o]);return r+A(e[n],t.slice(1))}function E(e,t,n=t.index){if(0===n.length)return t.type===r.SET?t.value:void 0;const o=n[0],i=Array.isArray(e)?e:[],a=E(i[o],t,n.slice(1)),l=[],s=Math.max(i.length,o+1);let c=0,u=0;for(let r=0;r<s;r++){const e=r===o?a:i[r];l[r]=e,void 0!==e&&(c+=k(e),u=r+1)}return 0!==c?(l.splice(u),Object.assign(l,{size:c})):void 0}function k(e){return null==e?0:(Array.isArray(e),1)}function C(e){return t=>e(...t.raw).pipe((0,i.U)((e=>1===e.length?[Object.assign(Object.assign({},t),{raw:e[0]})]:e.map(((e,n)=>Object.assign(Object.assign({},t),{raw:e,index:[...t.index,n]}))))))}function V(e){return t=>e(t.variables,...t.raw).pipe((0,i.U)((e=>1===e.length?[Object.assign(Object.assign({},t),{raw:e[0]})]:e.map(((e,n)=>Object.assign(Object.assign({},t),{raw:e,index:[...t.index,n]}))))))}function D(e){for(const t of e)if(t.value)return!0;return!1}function z(...e){return{observable:(0,l.T)(...e.map((({observable:e})=>e))).pipe((0,s.d)({refCount:!0,bufferSize:1})),value:D(e)}}function T(e,t,n){var r;if(0===e.length)return e=>e;const o=e[0].name,i={},a=Object.assign(Object.assign({grammar:e,compiledGrammar:i,operations:t},n),{maxSymbolDepth:null!==(r=n.maxSymbolDepth)&&void 0!==r?r:100});for(const{name:l,step:s}of e)i[l]=B(s,a);return i[o]}!function(e){e[e.SET=0]="SET",e[e.UNSET=1]="UNSET"}(r||(r={}));const L=(0,c.h)((({invalid:e})=>!e.value));function B(e,t,n){try{const{delay:r,listeners:a}=t,c=[L];if(null!=(null===a||void 0===a?void 0:a.onAfterStep)){const t=a.onAfterStep.bind(null,e);c.push((0,u.b)(t))}null!=n&&null!=r&&c.push((0,p.g)(r)),null!=n&&c.push(n);const f=function(e,t,n){switch(e.type){case"operation":return function(e,t,n){e.identifier;const r=e.children,o=t.operations[e.identifier];if(null==o)throw new Error(`unknown operation "${e.identifier}"`);const i=r.map((e=>B(e,t)));o.includeThis&&i.unshift((e=>e));return e=>e.pipe(Z(...i),(0,d.z)((e=>o.execute(e).pipe((0,d.z)((e=>(0,l.T)(...e.map((e=>(0,m.of)(e).pipe(n))))))))))}(e,t,n);case"parallel":return function(e,t,n){return r=>{const o=r.pipe((0,s.d)({refCount:!0}));return(0,l.T)(...e.children.map(((e,r)=>o.pipe((0,i.U)((e=>Object.assign(Object.assign({},e),{index:[...e.index,r]}))),B(e,t,n)))))}}(e,t,n);case"raw":return function(e,t){return n=>n.pipe((0,i.U)((t=>Object.assign(Object.assign({},t),{raw:e.value}))),t)}(e,n);case"sequential":return function(e,t,n){return Q(0,e.children,t,n)}(e,t,n);case"symbol":return function(e,t,n){if(null==(0,g.KD)(e.identifier,t.grammar))throw new Error(`unknown symbol "${e.identifier}"`);return r=>{const o=r.pipe((0,s.d)({refCount:!0,bufferSize:1}));return o.pipe((0,v.q)(1),(0,d.z)((()=>o.pipe((0,i.U)((n=>{var r;const o=null!==(r=n.symbolDepth[e.identifier])&&void 0!==r?r:0;if(o>=t.maxSymbolDepth)throw new Error(`maximum symbol depth (${t.maxSymbolDepth}) reached for symbol "${e.identifier}"`);return Object.assign(Object.assign({},n),{symbolDepth:Object.assign(Object.assign({},n.symbolDepth),{[e.identifier]:o+1})})})),t.compiledGrammar[e.identifier],n))))}}(e,t,n);case"this":return n;case"invert":case"not":return function(e,t,n){const r=B(e.children[0],t);return t=>t.pipe(r,(0,i.U)((t=>Object.assign(Object.assign({},t),{raw:I[e.type](t.raw)}))),n)}(e,t,n);case"add":case"and":case"divide":case"equal":case"greater":case"greaterEqual":case"modulo":case"multiply":case"or":case"smaller":case"smallerEqual":case"subtract":case"unequal":return function(e,t,n){const r=e.children.map((e=>B(e,t)));return t=>t.pipe(Z(...r),(0,i.U)((t=>Object.assign(Object.assign({},t),{raw:q[e.type](t.raw[0],t.raw[1])}))),n)}(e,t,n);case"if":return function(e,t,n){const r=B(e.children[0],t),[o,a]=e.children.slice(1).map((e=>B(e,t,n)));return e=>e.pipe(Z((e=>e),r),(0,h.v)((({raw:[,e]})=>e)),(0,d.z)((e=>e.pipe((0,i.U)((e=>Object.assign(Object.assign({},e),{raw:e.raw[0]}))),e.key?o:a))))}(e,t,n);case"switch":return function(e,t,n){const r=B(e.children[0],t),o=e.children.slice(1).map((e=>B(e,t,n)));return t=>t.pipe(Z((e=>e),r),(0,h.v)((({raw:[,e]})=>e)),(0,d.z)((t=>{const n=e.cases.findIndex((e=>e.includes(t.key)));return-1===n?y.E:t.pipe((0,i.U)((e=>Object.assign(Object.assign({},e),{raw:e.raw[0]}))),o[n])})))}(e,t,n);case"getVariable":return function(e,t){return(0,d.z)((n=>{var r;return(null!==(r=n.variables[e.identifier])&&void 0!==r?r:(0,m.of)(void 0)).pipe(G(n.invalid,n.index,n.variables),t)}))}(e,n);case"setVariable":return function(e,t,n){const r=B(e.children[0],t);return t=>{const o=t.pipe((0,s.d)({refCount:!0})),a=o.pipe(r);return o.pipe((0,i.U)((t=>Object.assign(Object.assign({},t),{variables:Object.assign(Object.assign({},t.variables),{[e.identifier]:a})}))),n)}}(e,t,n);case"return":return e=>e;case"random":return function(e,t,n){var r;const i=e.children.map((e=>B(e,t,n)));let a;if(null!=(null===(r=t.listeners)||void 0===r?void 0:r.onRandom)){const n=t.listeners.onRandom;a=(0,d.z)((t=>t.pipe((0,u.b)({next:r=>n(e,r,t.key)}),i[t.key])))}else a=(0,d.z)((e=>e.pipe(i[e.key])));return n=>n.pipe((0,h.v)((n=>{const r=(0,o.v3)(n.index.join(","),t.seed)/R;let i=0;for(let t=0;t<e.probabilities.length;t++)if(i+=e.probabilities[t],r<=i)return t;return e.probabilities.length-1})),a)}(e,t,n);case"null":return()=>y.E}}(e,t,(e=>e.pipe(...c)));if(null!=(null===a||void 0===a?void 0:a.onBeforeStep)){const t=a.onBeforeStep.bind(null,e);return e=>e.pipe((0,u.b)(t),f)}return f}catch(r){return()=>(0,f._)((()=>r))}}const I={invert:e=>-e,not:e=>!e};const q={add:(e,t)=>e+t,and:(e,t)=>e&&t,divide:(e,t)=>e/t,equal:(e,t)=>e==t,greater:(e,t)=>e>t,greaterEqual:(e,t)=>e>=t,modulo:(e,t)=>e%t,multiply:(e,t)=>e*t,or:(e,t)=>e||t,smaller:(e,t)=>e<t,smallerEqual:(e,t)=>e<=t,subtract:(e,t)=>e-t,unequal:(e,t)=>e!=t};function G(e,t,n){return r=>{let o;return r.pipe((0,i.U)((r=>(null!=o&&o.invalidate(),o=function(){const e=new a.t(1),t={invalidate:()=>{t.value=!0,e.next()},complete:()=>e.complete(),observable:e,value:!1};return t}(),{raw:r,index:null!==t&&void 0!==t?t:[],invalid:null==e?o:z(o,e),variables:null!==n&&void 0!==n?n:{},symbolDepth:{}}))),(0,u.b)({complete:()=>null===o||void 0===o?void 0:o.complete()}))}}const R=Math.pow(2,32);function Q(e,t,n,r){return e>=t.length?r:B(t[e],n,Q(e+1,t,n,r))}function Z(...e){return t=>{const n=t.pipe((0,s.d)({refCount:!0})),r=[e=>e,...e];return(0,l.T)(...r.map(((e,t)=>n.pipe(e,(0,i.U)((e=>Object.assign(Object.assign({},e),{index:[...e.index,t]}))))))).pipe((0,h.v)((e=>e.index.slice(0,-1).join(","))),(0,d.z)((t=>t.pipe(function(){return e=()=>[],t=e=>[...e],n=(e,t,n)=>e.splice(n,0,t),r=(e,t)=>e.splice(t,1),o=>o.pipe(N(),M(0),(0,b.R)((([e,o,i],a)=>{for(const l of a)e=P(e,o,i,l,t,n,r),i=E(i,l);return[e,o,i]}),[e(),[],void 0]),(0,i.U)((([e])=>e)));var e,t,n,r}(),(0,c.h)((t=>t.length===e.length+1)),(0,i.U)((e=>{const[t,...n]=e;return{variables:t.variables,index:t.index.slice(0,-1),invalid:z(...e.map((({invalid:e})=>e))),raw:n.map((({raw:e})=>e)),symbolDepth:t.symbolDepth}}))))))}}},21283:function(e,t,n){"use strict";n.d(t,{Ib:function(){return r},J:function(){return z},Gc:function(){return o},by:function(){return B},aR:function(){return v},Q3:function(){return V},Dm:function(){return I},SO:function(){return f},BZ:function(){return E},AJ:function(){return D},Up:function(){return T},Bc:function(){return b},KD:function(){return q},DQ:function(){return R},z_:function(){return N},BW:function(){return w},IX:function(){return M},hp:function(){return C},Lr:function(){return x},hs:function(){return A},nH:function(){return j},Ej:function(){return k},Sg:function(){return d},rL:function(){return l},pt:function(){return p},NJ:function(){return G},wU:function(){return L},l3:function(){return y},bp:function(){return h},D1:function(){return u},VB:function(){return Q}});const r=.001;function o(e,t){return Math.abs(e-t)<r}const i=["if","switch","random","operation"],a=[["parallel"],["sequential"],["or"],["and"],["not"],["equal","unequal"],["smaller","smallerEqual","greater","greaterEqual"],["add","subtract"],["multiply","divide","modulo"],["invert"],["getVariable","setVariable","if","switch","random","symbol","operation","this","raw","return","null"]].reduce(((e,t,n)=>(t.forEach((t=>e[t]=n)),e)),{});function l(e,t){return!i.includes(e.type)&&(n=t,a[e.type]>a[n.type]);var n}var s=n(65201),c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};function u(e,[t,...n]){let r=R(t,e);if(null==r)return;const o=[e,r];for(const i of n){if(null==r.children)return;r=r.children[i],o.push(r)}return o}function p(e,t,n,r){if(0===n){const n=e[0];return void G(n,t[0],h(r,n))}const o=t[n],i=e[n];o.children[i]=h(r,...e.slice(0,n+1))}function f(e,t){if(t<0)throw new Error(`can't retrieve step at path index ${t}`);return e[t+1]}function d(e){return e.map((({name:e,step:t})=>({name:e,step:m(t)})))}function m(e){var{path:t,children:n}=e,r=c(e,["path","children"]);return null==n?r:Object.assign(Object.assign({},r),{children:n.map((e=>m(e)))})}function h(e,...t){if(null==e)throw new Error("can't make undefined hierarchical");const n=e;if(Object.isFrozen(n))return(0,s.ZP)(n,(e=>h(e,...t)));if(null==n.path)n.path=t;else{n.path.length=t.length;for(let e=0;e<t.length;e++)n.path[e]=t[e]}if(null!=e.children)for(let r=0;r<e.children.length;r++)e.children[r]=h(e.children[r],...t,r);return n}function y(e){if(null==e)throw new Error("can't make undefined hierarchical");if(Object.isFrozen(e))return(0,s.ZP)(e,(e=>y(e)));for(const t of e)t.step=h(t.step,t.name);return e}function v(e){const t=new Map;for(const r of e)Q(r.step,(e=>{if("symbol"!==e.type)return;let n=t.get(r.name);null==n&&(n=[],t.set(r.name,n)),n.push(e.identifier)}));const n={};for(const[r]of t)n[r]=Array.from(new Set(g(r,t)));return n}function g(e,t,n=new Set){n.add(e);const r=t.get(e);return null==r?[]:r.filter((e=>!n.has(e))).reduce(((e,r)=>e.concat(g(r,t,n))),r)}function b(e,t,n){const r=e.filter((e=>x(n,e.name)));if(null==t)return(0,s.vV)(r);const o=new Set(r.reduce(((e,r)=>{const o=t[r.name];return null==o?e:e.concat(o.filter((e=>!x(n,e))))}),[]));return(0,s.vV)(r.concat(e.filter((e=>o.has(e.name)))))}function x(e,t){return t.endsWith(`@${e}`)}function w(e,t){if(null==t)throw new Error("unable to globalize noun with undefined description name");return e.includes("@")?e:`${e}@${t}`}function j(e,t){return t=null!==t&&void 0!==t?t:E(e),e.endsWith(`@${t}`)?e.slice(0,-t.length-1):e}function S(e,t,n,...r){return(0,s.ZP)(t,(t=>(O(t,n,e),h(t,...r))))}function O(e,t,n){if("symbol"!==e.type){if(null!=e.children)for(const r of e.children)O(r,t,n)}else e.identifier=n(e.identifier,t)}const M=S.bind(null,w);S.bind(null,j);function P(e,t,n){return(0,s.vV)(t.map((t=>{const r=e(t.name,n);return{name:r,step:S(e,t.step,n,r)}})))}const N=P.bind(null,w),A=P.bind(null,j);function E(e){const t=e.split("@");if(2!==t.length)throw new Error(`"${e}" expected to have exactly one "@"`);return t[1]}function k(e,t){const n="string"===typeof t?t:"symbol"===t.type?t.identifier:void 0;if(null!=n)return j(n,e)}function C(e,t){const n="string"===typeof t?t:"symbol"===t.type?t.identifier:void 0;if(null!=n)return w(n,e)}function V(e,t,n){return(0,s.vV)(e.filter((e=>!x(n,e.name))).concat(t))}function D(e,t,n){var r;return[e,...null!==(r=n[e])&&void 0!==r?r:[]].map((e=>{const n=t.find((({name:t})=>t===e));if(null==n)throw new Error(`unknown noun "${e}"`);return n}))}var z;function T(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)if(e[r]!=t[r])return z.None;return e.length<t.length?z.Successor:e.length===t.length?z.Equal:z.Predecessor}function L(e,t){if(null==e||null==t)return!1;if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function B(e,t){if(t.type!=e)throw new Error(`expected step "${t}" to have type "${e}"`);return t}function I(e){return null!=e}function q(e,t){const n=t.findIndex((({name:t})=>t===e));return-1===n?void 0:n}function G(e,t,n){const r=q(e,t);null!=r&&(t[r].step=n)}function R(e,t){const n=q(e,t);return null==n?void 0:t[n].step}function Q(e,t){if(t(e),null!=e.children)for(const n of e.children)Q(n,t)}!function(e){e[e.Predecessor=0]="Predecessor",e[e.Successor=1]="Successor",e[e.Equal=2]="Equal",e[e.None=3]="None"}(z||(z={}))},40812:function(e,t,n){"use strict";n.d(t,{i:function(){return x}});var r=n(34051),o=n.n(r),i=n(82513),a=n(55050),l=n(65201),s=n(26173),c=n(14671),u=n(38597),p=n(16082);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,o)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){d(i,r,o,a,l,"next",e)}function l(e){d(i,r,o,a,l,"throw",e)}a(void 0)}))}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){h(e,t,n[t])}))}return e}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||b(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){if(e){if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function x(e,t){return(0,c.Z)((0,u.XR)((0,u.$e)({type:"gui",valueMap:{},selectionsList:[],hovered:void 0,grammar:[],dependencyMap:{},descriptions:[],selectedDescriptions:[],interpretationDelay:0,requested:void 0,shift:!1,showTui:!1,showTe:!1,graphVisualization:!1,domain:"movement"},j.bind(null,e,t))))}var w=new a.vk(new s.Matrix4,(0,a.i7)(new s.Color(16711680)));function j(e,t,n,r){var a=function(e,t,o){"gui"==r().type&&n({requested:{type:e,data:o,fulfill:function(e){var o=r().requested;t&&t(e);var i=r();"gui"===i.type&&i.requested===o&&n({requested:void 0})}}})},s=function(e){return function(t){return new Promise((function(n){return a("select-condition",n,{patterns:t,title:e})}))}};return{import:function(e){try{var t=(0,i.l3)((0,i.Qc)(e)),o=new Set,a=!0,l=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var p=c.value.name,f=(0,i.BZ)(p);o.add(f)}}catch(d){l=!0,s=d}finally{try{a||null==u.return||u.return()}finally{if(l)throw s}}n({descriptions:Array.from(o).map((function(e){return{name:e,seed:0,domain:r().domain}})),grammar:t,selectedDescriptions:[],selectionsList:[],valueMap:{},dependencyMap:(0,i.aR)(t),hovered:void 0,requested:void 0,type:"gui"})}catch(m){console.error(m)}},download:function(){var e=r(),t="gui"===e.type?(0,i.Sg)(e.grammar):e.grammar,n=(0,i.y0)(t,void 0,i.lv),o=document.createElement("a");o.href=window.URL.createObjectURL(new Blob([n],{type:"text/plain"})),o.download="descriptions.cgv",o.click()},setShowTui:function(e){n({showTui:e})},setShowTe:function(e){n({showTe:e})},selectDescription:function(e,t){var o=r();if("gui"===o.type){var a,l,s=null===(a=o.grammar.find((function(t){return(0,i.Lr)(e,t.name)})))||void 0===a?void 0:a.name;if(!t){if(1===o.selectedDescriptions.length&&o.selectedDescriptions[0]===e)return;var c=Object.entries(o.valueMap);return void n({selectedDescriptions:[e],selectionsList:null==s?[]:[{steps:s,values:c.filter((function(e){return v(e,1)[0]==s})).reduce((function(e,t){var n=v(t,2)[1];return null!=n?e.concat(n):e}),[])}]})}if(!o.selectedDescriptions.includes(e))return void n({selectedDescriptions:g(o.selectedDescriptions).concat([e]),selectionsList:null==s?o.selectionsList:g(o.selectionsList).concat([{steps:s,values:[]}])});n({selectedDescriptions:o.selectedDescriptions.filter((function(t){return e!==t})),selectionsList:o.selectionsList.filter((function(t){var n=t.steps;return!(0,i.Lr)(e,(0,i.Il)(n)[0])})),hovered:null!=(null===(l=o.hovered)||void 0===l?void 0:l.steps)&&(0,i.Lr)(e,(0,i.Il)(o.hovered.steps)[0])?void 0:o.hovered})}else 1===o.selectedDescriptions.length&&o.selectedDescriptions[0]===e||n({selectedDescriptions:[e],text:(0,i.y0)((0,i.Bc)(o.grammar,void 0,e),i.Ej.bind(null,e),i.lv)})},clearValueMap:function(e){var t=r();"gui"===t.type&&n({valueMap:Object.entries(t.valueMap).filter((function(t){return!v(t,1)[0].includes("@"+e)})).reduce((function(e,t){var n=v(t,2);return y({},e,h({},n[0],n[1]))}),{})})},pasteNoun:function(){var e=m(o().mark((function e(a,l,c){var u,p,f,d,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("gui"===(u=r()).type&&null!=u.selectedDescriptions){e.next=3;break}return e.abrupt("return");case 3:return p=(0,i.BZ)(c),f=(0,i.nH)(c,p),d=(0,i.EU)(u.grammar,f,p,a),m=(0,i.zq)(l),e.t0=n,e.next=10,(0,i.gx)(u.valueMap,u.selectionsList.filter((function(e){return(0,i.Q)(e.steps,l,m)})),t,s("On what should this noun be copied to?"),(function(){return{type:"symbol",identifier:(0,i.BW)(f,a)}}),u.grammar.concat(d));case 10:e.t1=e.sent,(0,e.t0)(e.t1);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),addDescriptions:function(e){var t=r(),o=t.descriptions,a=t.grammar,s=t.dependencyMap,c=r().domain,u=!0,p=!1,f=void 0;try{for(var d,m=function(e,t){var n=t.value;if(-1!==o.findIndex((function(e){return e.name===n.name})))return"continue";var r,s=(0,i.BW)("Start",n.name);-1===a.findIndex((function(e){return e.name===s}))&&(a=(0,l.vV)((0,i.l3)([{name:s,step:null!==(r=n.step)&&void 0!==r?r:{type:"this"}}]).concat(a)));o=[{name:n.name,seed:0,domain:c}].concat(o)},h=e[Symbol.iterator]();!(u=(d=h.next()).done);u=!0)m(0,d)}catch(y){p=!0,f=y}finally{try{u||null==h.return||h.return()}finally{if(p)throw f}}s=(0,i.aR)(a),n({descriptions:o,grammar:a,dependencyMap:s})},deleteDescription:function(e){var t="ID"+e,o=r(),a=o.descriptions,l=o.selectedDescriptions,s=o.grammar,c=o.selectionsList,u=a.filter((function(n){return n.name!=e&&n.name!==t})),f=p.L.getState().treePath.filter((function(t){return!(t.data.key.replace("Start@","").split("_")[0]===e)}));p.L.getState().setTreePath(f),n(y({descriptions:u,selectedDescriptions:l.filter((function(n){return n!==e&&n!==t}))},(0,i.tc)(s,null!==c&&void 0!==c?c:[],u.map((function(e){return e.name})))))},deleteAllDescription:function(){var e=r(),t=e.grammar,o=e.selectionsList;n(y({descriptions:[],selectedDescriptions:[]},(0,i.tc)(t,null!==o&&void 0!==o?o:[],[])))},concretizeDescription:function(){var t=m(o().mark((function t(a,s){var c,u,p,f,d,m,h;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("gui"===(u=r()).type){t.next=4;break}return t.abrupt("return");case 4:if(null!=(p=null===(c=u.grammar.find((function(e){return(0,i.Lr)(a,e.name)})))||void 0===c?void 0:c.name)){t.next=7;break}return t.abrupt("return");case 7:return f=(0,i.AJ)(p,u.grammar,u.dependencyMap),t.next=10,(0,i.h$)(w,f,e,{seed:s});case 10:d=t.sent,m=(0,i.l3)((0,l.vV)(g(d).concat(g(u.grammar.filter((function(e){return!f.includes(e)})))))),n(y({},(0,i.tc)(m,null!==(h=u.selectionsList)&&void 0!==h?h:[],u.descriptions.map((function(e){return e.name}))),{dependencyMap:(0,i.aR)(m)}));case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),setSeed:function(e,t){n({descriptions:r().descriptions.map((function(n){return n.name===e?{name:n.name,seed:t,domain:n.domain}:n}))})},setText:function(e){var t=r();if("tui"==t.type&&1==t.selectedDescriptions.length)try{var o=(0,i.dk)(e,t.selectedDescriptions[0]);n({text:e,correct:!0,grammar:(0,i.Q3)(t.grammar,o,t.selectedDescriptions[0])})}catch(a){n({text:e,correct:!1,error:a.message})}},setGraphVisualization:function(e){"gui"===r().type&&n({graphVisualization:e})},setType:function(e){var t=r();if(t.type!==e){var o=(0,i.l3)(t.grammar);"tui"===t.type&&t.correct?n({type:"gui",grammar:o,dependencyMap:(0,i.aR)(o),valueMap:{},selectionsList:[],hovered:void 0,requested:void 0,shift:!1}):1==t.selectedDescriptions.length&&n({type:"tui",grammar:t.grammar,text:null==t.selectedDescriptions?"":(0,i.y0)((0,i.Bc)(t.grammar,void 0,t.selectedDescriptions[0]),i.Ej.bind(null,t.selectedDescriptions[0]),i.lv),correct:!0})}},onStartHover:function(e,t){var o,a=r();"gui"==a.type&&(t=null!==(o=null!==t&&void 0!==t?t:a.valueMap[(0,i.zq)(e)])&&void 0!==o?o:[],n({hovered:{steps:e,values:t}}))},toggleDomain:function(){var e=r();"movement"===e.domain?n(y({},e,{domain:"static"})):n(y({},e,{domain:"movement"}))},onEndHover:function(e){var t,o=r();"gui"==o.type&&(null===(t=o.hovered)||void 0===t?void 0:t.steps)==e&&n(y({},o,{hovered:void 0}))},editIndices:function(e,t){var o=r();"gui"==o.type&&n((0,i.bp)(o.valueMap,o.selectionsList,o.hovered,e,t))},autoSelectPattern:function(){var e=m(o().mark((function e(a){var l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("gui"==(l=r()).type){e.next=3;break}return e.abrupt("return");case 3:return e.t0=n,e.next=6,(0,i.O$)(l.selectionsList,l.valueMap,a,t,s("What should be selected?"));case 6:e.t1=e.sent,e.t2={selectionsList:e.t1},(0,e.t0)(e.t2);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),select:function(e,t,o){var a=r();"gui"==a.type&&(o=null!==o&&void 0!==o?o:a.shift?"add":"replace",n({selectionsList:(0,i.Db)(a.valueMap,a.selectionsList,[{steps:e,values:null==t?void 0:[t]}],o)}))},selectResult:function(e,t){var o=r();"gui"==o.type&&n({selectionsList:(0,i.Db)(o.valueMap,o.selectionsList,[{steps:e,values:[t]}],o.shift?"toggle":"replace")})},selectChildren:function(e,t,o){var a=r();"gui"==a.type&&n({selectionsList:(0,i.Db)(a.valueMap,(0,i.Db)(a.valueMap,a.selectionsList,[{steps:e,values:t}],"remove"),(0,i._P)(a.valueMap,[o],t,(function(e,t){var n=(0,i.Up)(t.before.index,e.before.index);return n===i.J.Successor||n===i.J.Equal}),void 0),"add")})},selectRelated:function(e,t){var o=r();"gui"==o.type&&n({selectionsList:(0,i.Db)(o.valueMap,(0,i.Db)(o.valueMap,o.selectionsList,[e],"remove"),[t],"add")})},unselectAll:function(){"gui"==r().type&&n({selectionsList:[]})},escape:function(){var e=r();"gui"==e.type&&(null==e.requested?n({selectionsList:[]}):n({requested:void 0}))},request:a,cancelRequest:function(){"gui"==r().type&&n({requested:void 0})},insert:function(){var e=m(o().mark((function e(a,l,c){var u,p,f,d,m=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=m.length>3&&void 0!==m[3]&&m[3],"gui"==(p=r()).type){e.next=4;break}return e.abrupt("return");case 4:return f=p.grammar,null!=c&&(f=p.selectedDescriptions.reduce((function(e,t){var n=c(t);return null==n?e:e.concat(n)}),f)),e.next=8,(0,i.$T)(p.valueMap,p.selectionsList,t,s("On what should this transformation be applied?"),a,l,f);case 8:d=e.sent,u&&(d=y({descriptions:p.descriptions.map((function(e){return p.selectedDescriptions.includes(e.name)?{name:e.name,seed:Math.random()*Number.MAX_SAFE_INTEGER,domain:e.domain}:e}))},d)),n(d);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),removeStep:m(o().mark((function a(){var l;return o().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if("gui"==(l=r()).type){o.next=3;break}return o.abrupt("return");case 3:return o.t0=n,o.next=6,(0,i.im)(l.valueMap,l.selectionsList,t,s("From what should this transformation be removed?"),e,l.grammar);case 6:o.t1=o.sent,(0,o.t0)(o.t1);case 8:case"end":return o.stop()}}),a)}))),renameNoun:function(){var e=m(o().mark((function e(a){var l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("gui"==(l=r()).type){e.next=3;break}return e.abrupt("return");case 3:return e.t0=n,e.next=6,(0,i.lG)(l.valueMap,l.selectionsList,t,s("What should be renamed?"),a,l.grammar);case 6:e.t1=e.sent,(0,e.t0)(e.t1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setName:function(){var e=m(o().mark((function e(a){var l,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("gui"==(l=r()).type&&1===l.selectedDescriptions.length){e.next=3;break}return e.abrupt("return");case 3:return e.t0=n,e.next=7,(0,i.Sy)(l.valueMap,l.selectionsList,t,s("What should be named?"),null!==(c=(0,i.hp)(l.selectedDescriptions[0],a))&&void 0!==c?c:a,l.grammar);case 7:e.t1=e.sent,(0,e.t0)(e.t1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),replace:function(){var e=m(o().mark((function e(a,l,c){var u,p,f,d,m,h=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=h.length>3&&void 0!==h[3]&&h[3],p=null!=l?(0,i.zq)(l):void 0,"gui"==(f=r()).type){e.next=5;break}return e.abrupt("return");case 5:return d=f.grammar,null!=c&&(d=f.selectedDescriptions.reduce((function(e,t){var n=c(t);return null==n?e:e.concat(n)}),d)),e.next=9,(0,i.gx)(f.valueMap,null==l?f.selectionsList:f.selectionsList.filter((function(e){return(0,i.Q)(e.steps,l,p)})),t,s("For what should the new transformation replace the current?"),a,d);case 9:m=e.sent,u&&(m=y({descriptions:f.descriptions.map((function(e){return f.selectedDescriptions.includes(e.name)?{name:e.name,seed:Math.random()*Number.MAX_SAFE_INTEGER,domain:e.domain}:e}))},m)),n(m);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),setShift:function(e){"gui"==r().type&&n({shift:e})},setInterpretationDelay:function(e){n({interpretationDelay:e})}}}},20554:function(e,t,n){"use strict";n.d(t,{D:function(){return i}});var r=n(14671),o=n(38597),i=(0,r.Z)((0,o.XR)((function(e,t){return{treePath:[],columnNumber:20,setColumnNumber:function(t){return e((function(e){return{columnNumber:t}}))},addColumnNumber:function(t){return e((function(e){return{columnNumber:e.columnNumber+t}}))},rowNumber:18,rowData:[],addRowNumber:function(t){return e((function(e){return{rowNumber:e.rowNumber+t}}))},setRowNumber:function(t){return e((function(e){return{rowNumber:t}}))},columnWidth:.6,setColumnWidth:function(t){return e((function(e){return{columnWidth:t}}))},modalOpen:!1,setModalOpen:function(t){return e((function(e){return{modalOpen:t}}))},modalData:null,setModalData:function(t){return e((function(e){return{modalData:t}}))},allRowsClosedToggle:!1,setAllRowsClosedToggle:function(){return e((function(e){return{allRowsClosedToggle:!e.allRowsClosedToggle}}))}}})))},46385:function(e,t,n){"use strict";var r;n.d(t,{g:function(){return r},i:function(){return o}}),function(e){e[e.Bookstore=0]="Bookstore",e[e.Students=1]="Students",e[e.Eth=2]="Eth",e[e.Hotel=3]="Hotel",e[e.Zara=4]="Zara"}(r||(r={}));var o=[{image:"./models/bookstore.glb",width:1424,height:1088,scale:[260,280,310],position:[-20,0,-20],rotation:[0,0,0],name:"BookStore Empty",staticObjects:["bookstore"],dataSize:0,enumName:r.Bookstore}]},16082:function(e,t,n){"use strict";n.d(t,{L:function(){return y}});var r=n(10811),o=n(26173),i=n(14671),a=n(46385);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e,t,n){return c=s()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&f(o,n.prototype),o},c.apply(null,arguments)}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}function f(e,t){return f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},f(e,t)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||h(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){if(e){if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}var y=(0,i.Z)((function(e,t){return{treePath:[],setTreePath:function(t){var n=function(e){var t=[],n=[],r=function(e,t){var o=0,i=e.operation?p({},e.framePosition,{operation:e.operation,path:e.path}):null,a=m(t);i&&a.push(i);var l=!0,s=!1,c=void 0;try{for(var u,f=Object.entries(e.children)[Symbol.iterator]();!(l=(u=f.next()).done);l=!0){var h=d(u.value,2),y=(h[0],h[1]);if(y.children&&0!==Object.keys(y.children).length)0==o&&Object.keys(y.children).length>0?(r(y,a),o+=1):r(y,i?[i]:[]);else{var v=p({},y.framePosition,{operation:y.operation,path:y.path});0==o?(o+=1,a.push(v),n.push(a)):i?n.push([i,v]):n.push([v])}}}catch(g){s=!0,c=g}finally{try{l||null==f.return||f.return()}finally{if(s)throw c}}},o=!0,i=!1,a=void 0;try{for(var l,s=e[Symbol.iterator]();!(o=(l=s.next()).done);o=!0){var c=l.value;if("moveData"===c.type){var u;r(c.data,[]);var f=n.map((function(e){return e.map((function(e){return{data:e,type:"moveData"}}))}));(u=t).push.apply(u,m(f)),n.splice(0,n.length)}else"nameSample"===c.type?t.push([{type:"other",key:c.data.key,primitive:c.data.primitive}]):t.push([{type:"other",key:c.data.key}])}}catch(h){i=!0,a=h}finally{try{o||null==s.return||s.return()}finally{if(i)throw a}}return t}(t.sort((function(e,t){return e.data.key.localeCompare(t.data.key)}))),i=function(e){var t=e.map((function(e){return e.map((function(e){return e.data}))})),n=[],i=!0,a=!1,l=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var p=s.value;if(p.length>0){var f={id:"neuesItem",size:0,type:r.LP.Pedestrian,framePos:[],startT:0,endT:0,direction:[0,0,0]},d=!0,h=!1,y=void 0;try{for(var g,b=p[Symbol.iterator]();!(d=(g=b.next()).done);d=!0){var x=g.value;if(f.id=x.name,0==f.framePos.length){var w,j,S,O,M;f.type=x.type,f.startT=(null!==(w=x.time)&&void 0!==w?w:0)*r.HG,f.endT=(null!==(j=p[p.length-1].time)&&void 0!==j?j:1)*r.HG,f.direction=null!==(S=x.direction)&&void 0!==S?S:[0,0,0],f.framePos.push({position:null!==(O=x.position)&&void 0!==O?O:[0,0,0],time:x.time*r.HG,direction:null!==(M=x.direction)&&void 0!==M?M:[0,0,0]})}else{var P,N,A=f.framePos[f.framePos.length-1],E=null!==(N=x.position)&&void 0!==N?N:[0,0,0],k=v(A.position?c(o.Vector3,m(A.position)):new o.Vector3(0,0,0),c(o.Vector3,m(E)),x.direction?c(o.Vector3,m(x.direction)):new o.Vector3(0,0,0),A.time,x.time*r.HG);(P=f.framePos).push.apply(P,m(k))}}}catch(C){h=!0,y=C}finally{try{d||null==b.return||b.return()}finally{if(h)throw y}}n.push(f)}}}catch(C){a=!0,l=C}finally{try{i||null==u.return||u.return()}finally{if(a)throw l}}return n}(n.filter((function(e){return"moveData"===e[0].type})));return e((function(e){return{treePath:t,rowData:n,data:i}}))},time:-1,minTime:1e6,maxTime:0,data:null,rowData:[],world:a.i[0],setWorld:function(t){return e((function(e){return{world:t}}))},setData:function(t){return e((function(e){return{data:t}}))},incrementTime:function(t){return e((function(e){return{time:e.time+t}}))},setTime:function(t){return e((function(e){return{time:t}}))},action:function(){return t().time},playActive:!1,setPlayActive:function(t){return e((function(e){return{playActive:t}}))},setMaxTime:function(t){return e((function(e){return{maxTime:t}}))},setMinTime:function(t){return e((function(e){return{minTime:t,time:t}}))},getPlayActive:function(){return t().playActive},resetState:function(){e((function(e){return{time:0,maxTime:0,minTime:1e6,data:null}}))},loadingState:!1,setLoadingState:function(t){return e((function(e){return{loadingState:t}}))},controls:void 0}}));function v(e,t,n,r,o){for(var i=[],a=e,l=t.sub(a),s=r,c=o-r,u=1;u<c+1;u++){var p=l.clone().multiplyScalar(u/c);i.push({time:s+u,position:a.clone().add(p).toArray(),direction:n.clone().toArray()})}return i}},70122:function(e,t,n){"use strict";n.d(t,{K:function(){return l},n:function(){return s}});var r=n(85893),o=n(73506);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=[{title:"721 9th Ave, New York, NY 10019",lat:40.7628862,lon:-73.9894495},{title:"Feuerbachstra\xdfe 25, 60325 Frankfurt am Main",lat:50.1157581,lon:8.6629498}];function s(e){var t=e.className,n=a(e,["className"]);return(0,r.jsxs)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}({},n,{className:"".concat(t," bg-light border rounded shadow"),children:[(0,r.jsx)("div",{className:"py-2 px-3 border-bottom border-2",children:"Adresses"}),l.map((function(e){var t=e.title,n=e.lat,i=e.lon;return(0,r.jsx)("div",{style:{fontSize:"x-small"},className:"pointer border-top py-2 px-3",onClick:function(){return o.D1.getState().setLatLon(n,i)},children:t},t)}))]}))}},3921:function(e,t,n){"use strict";n.d(t,{t:function(){return i}});var r=n(55050);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=JSON.parse('[{"position":[-73.991293,0.2,40.7603894],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7603894,-73.991293,152.png"},{"position":[-73.9911163,0.2,40.7605103],"rotationOffset":-115,"url":"/cgv/panoramas/ny/panorama-@40.7605103,-73.9911163,-115.png"},{"position":[-73.9917221,0.2,40.7605683],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7605683,-73.9917221,152.png"},{"position":[-73.9921399,0.2,40.7607437],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7607437,-73.9921399,151.png"},{"position":[-73.9909371,0.2,40.7607584],"rotationOffset":-117,"url":"/cgv/panoramas/ny/panorama-@40.7607584,-73.9909371,-117.png"},{"position":[-73.9924488,0.2,40.7608757],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7608757,-73.9924488,151.png"},{"position":[-73.9928593,0.2,40.7610493],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7610493,-73.9928593,151,152.png"},{"position":[-73.9913927,0.2,40.7612502],"rotationOffset":-35,"url":"/cgv/panoramas/ny/panorama-@40.7612502,-73.9913927,-35,-31.png"},{"position":[-73.9933606,0.2,40.7612609],"rotationOffset":147,"url":"/cgv/panoramas/ny/panorama-@40.7612609,-73.9933606,147.png"},{"position":[-73.9938411,0.2,40.7614897],"rotationOffset":154,"url":"/cgv/panoramas/ny/panorama-@40.7614897,-73.9938411,154.png"},{"position":[-73.9920941,0.2,40.7615683],"rotationOffset":-26,"url":"/cgv/panoramas/ny/panorama-@40.7615683,-73.9920941,-26.png"},{"position":[-73.9925237,0.2,40.7617265],"rotationOffset":-26,"url":"/cgv/panoramas/ny/panorama-@40.7617265,-73.9925237,-26,-30.png"},{"position":[-73.9929245,0.2,40.7619153],"rotationOffset":-23,"url":"/cgv/panoramas/ny/panorama-@40.7619153,-73.9929245,-23.png"},{"position":[-73.9937505,0.2,40.7619205],"rotationOffset":79,"url":"/cgv/panoramas/ny/panorama-@40.7619205,-73.9937505,79,58.png"},{"position":[-73.9933428,0.2,40.7620772],"rotationOffset":-25,"url":"/cgv/panoramas/ny/panorama-@40.7620772,-73.9933428,-25,-28.png"},{"position":[-73.9894495,0.2,40.7628862],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7628862,-73.9894495,153.png"},{"position":[-73.989556,0.2,40.7629306],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7629306,-73.989556,152.png"},{"position":[-73.98966,0.2,40.7629745],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7629745,-73.98966,152.png"},{"position":[-73.9897629,0.2,40.7630177],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7630177,-73.9897629,152.png"},{"position":[-73.9898661,0.2,40.7630604],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7630604,-73.9898661,152.png"},{"position":[-73.9899691,0.2,40.7631037],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7631037,-73.9899691,152.png"},{"position":[-73.9900702,0.2,40.7631467],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7631467,-73.9900702,151.png"},{"position":[-73.9901697,0.2,40.7631887],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7631887,-73.9901697,152.png"},{"position":[-73.9902683,0.2,40.7632302],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7632302,-73.9902683,152.png"},{"position":[-73.9903677,0.2,40.7632717],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7632717,-73.9903677,152.png"},{"position":[-73.9905082,0.2,40.7633307],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7633307,-73.9905082,151.png"},{"position":[-73.9906086,0.2,40.763374],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.763374,-73.9906086,151.png"},{"position":[-73.9907119,0.2,40.7634208],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7634208,-73.9907119,151.png"},{"position":[-73.9908192,0.2,40.7634687],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7634687,-73.9908192,151.png"},{"position":[-73.9909259,0.2,40.7635125],"rotationOffset":151,"url":"/cgv/panoramas/ny/panorama-@40.7635125,-73.9909259,151.png"},{"position":[-73.9910314,0.2,40.7635554],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7635554,-73.9910314,152.png"},{"position":[-73.9911354,0.2,40.7635973],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7635973,-73.9911354,152.png"},{"position":[-73.9912372,0.2,40.7636388],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7636388,-73.9912372,152.png"},{"position":[-73.9913394,0.2,40.7636803],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7636803,-73.9913394,152.png"},{"position":[-73.9914375,0.2,40.7637211],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7637211,-73.9914375,152.png"},{"position":[-73.9915457,0.2,40.763767],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.763767,-73.9915457,152.png"},{"position":[-73.9916401,0.2,40.7638439],"rotationOffset":143,"url":"/cgv/panoramas/ny/panorama-@40.7638439,-73.9916401,143.png"},{"position":[-73.9917486,0.2,40.7638941],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7638941,-73.9917486,153.png"},{"position":[-73.9918524,0.2,40.7639381],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7639381,-73.9918524,153.png"},{"position":[-73.9919505,0.2,40.7639785],"rotationOffset":152,"url":"/cgv/panoramas/ny/panorama-@40.7639785,-73.9919505,152.png"},{"position":[-73.9920937,0.2,40.7640343],"rotationOffset":149,"url":"/cgv/panoramas/ny/panorama-@40.7640343,-73.9920937,149.png"},{"position":[-73.9922023,0.2,40.7640409],"rotationOffset":153,"url":"/cgv/panoramas/ny/panorama-@40.7640409,-73.9922023,153.png"},{"position":[8.6623931,0.2,50.1146702],"rotationOffset":-182,"url":"/cgv/panoramas/fm/panorama-@50.1146702,8.6623931,-182.png"},{"position":[8.6625474,0.2,50.1146801],"rotationOffset":-154,"url":"/cgv/panoramas/fm/panorama-@50.1146801,8.6625474,-154.png"},{"position":[8.6622397,0.2,50.1146802],"rotationOffset":-184,"url":"/cgv/panoramas/fm/panorama-@50.1146802,8.6622397,-184.png"},{"position":[8.6621095,0.2,50.1146872],"rotationOffset":-185,"url":"/cgv/panoramas/fm/panorama-@50.1146872,8.6621095,-185.png"},{"position":[8.6619715,0.2,50.1146951],"rotationOffset":-188,"url":"/cgv/panoramas/fm/panorama-@50.1146951,8.6619715,-188.png"},{"position":[8.6618412,0.2,50.1147036],"rotationOffset":174,"url":"/cgv/panoramas/fm/panorama-@50.1147036,8.6618412,174.png"},{"position":[8.6626901,0.2,50.1148191],"rotationOffset":-94,"url":"/cgv/panoramas/fm/panorama-@50.1148191,8.6626901,-94.png"},{"position":[8.6616697,0.2,50.114846],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.114846,8.6616697,-97.png"},{"position":[8.662711,0.2,50.1149033],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.1149033,8.662711,-97.png"},{"position":[8.6616896,0.2,50.1149293],"rotationOffset":-101,"url":"/cgv/panoramas/fm/panorama-@50.1149293,8.6616896,-101.png"},{"position":[8.6627286,0.2,50.1149732],"rotationOffset":-101,"url":"/cgv/panoramas/fm/panorama-@50.1149732,8.6627286,-101.png"},{"position":[8.6617209,0.2,50.1150402],"rotationOffset":-104,"url":"/cgv/panoramas/fm/panorama-@50.1150402,8.6617209,-104.png"},{"position":[8.6627538,0.2,50.1150518],"rotationOffset":-102,"url":"/cgv/panoramas/fm/panorama-@50.1150518,8.6627538,-102.png"},{"position":[8.6617453,0.2,50.1151227],"rotationOffset":-102,"url":"/cgv/panoramas/fm/panorama-@50.1151227,8.6617453,-102.png"},{"position":[8.6627812,0.2,50.1151545],"rotationOffset":-98,"url":"/cgv/panoramas/fm/panorama-@50.1151545,8.6627812,-98.png"},{"position":[8.6617704,0.2,50.1152061],"rotationOffset":-105,"url":"/cgv/panoramas/fm/panorama-@50.1152061,8.6617704,-105.png"},{"position":[8.6628064,0.2,50.1152442],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1152442,8.6628064,-100.png"},{"position":[8.6617932,0.2,50.1152884],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1152884,8.6617932,-100.png"},{"position":[8.6618155,0.2,50.115368],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.115368,8.6618155,-97.png"},{"position":[8.662853,0.2,50.1154101],"rotationOffset":-99,"url":"/cgv/panoramas/fm/panorama-@50.1154101,8.662853,-99.png"},{"position":[8.661839,0.2,50.1154461],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.1154461,8.661839,-97.png"},{"position":[8.6628751,0.2,50.1154918],"rotationOffset":-99,"url":"/cgv/panoramas/fm/panorama-@50.1154918,8.6628751,-99.png"},{"position":[8.6618617,0.2,50.1155217],"rotationOffset":-101,"url":"/cgv/panoramas/fm/panorama-@50.1155217,8.6618617,-101.png"},{"position":[8.6628988,0.2,50.1155784],"rotationOffset":-98,"url":"/cgv/panoramas/fm/panorama-@50.1155784,8.6628988,-98.png"},{"position":[8.6618911,0.2,50.1156269],"rotationOffset":-99,"url":"/cgv/panoramas/fm/panorama-@50.1156269,8.6618911,-99.png"},{"position":[8.6629243,0.2,50.115672],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.115672,8.6629243,-100.png"},{"position":[8.6619182,0.2,50.1157194],"rotationOffset":-98,"url":"/cgv/panoramas/fm/panorama-@50.1157194,8.6619182,-98.png"},{"position":[8.6629498,0.2,50.1157581],"rotationOffset":257,"url":"/cgv/panoramas/fm/panorama-@50.1157581,8.6629498,257.png"},{"position":[8.6628525,0.2,50.1158494],"rotationOffset":-11,"url":"/cgv/panoramas/fm/panorama-@50.1158494,8.6628525,-11.png"},{"position":[8.6626738,0.2,50.1158712],"rotationOffset":-4,"url":"/cgv/panoramas/fm/panorama-@50.1158712,8.6626738,-4.png"},{"position":[8.6625303,0.2,50.1158865],"rotationOffset":-6,"url":"/cgv/panoramas/fm/panorama-@50.1158865,8.6625303,-6.png"},{"position":[8.662406,0.2,50.1159013],"rotationOffset":-8,"url":"/cgv/panoramas/fm/panorama-@50.1159013,8.662406,-8.png"},{"position":[8.6619545,0.2,50.1159062],"rotationOffset":-65,"url":"/cgv/panoramas/fm/panorama-@50.1159062,8.6619545,-65.png"},{"position":[8.6622687,0.2,50.1159175],"rotationOffset":-6,"url":"/cgv/panoramas/fm/panorama-@50.1159175,8.6622687,-6.png"},{"position":[8.6621347,0.2,50.1159323],"rotationOffset":-8,"url":"/cgv/panoramas/fm/panorama-@50.1159323,8.6621347,-8.png"},{"position":[8.6630039,0.2,50.1160285],"rotationOffset":-96,"url":"/cgv/panoramas/fm/panorama-@50.1160285,8.6630039,-96,-97.png"},{"position":[8.6631204,0.2,50.1163257],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1163257,8.6631204,-100,-98.png"},{"position":[8.6632372,0.2,50.1167265],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1167265,8.6632372,-100,-100.png"},{"position":[8.6586113,0.2,50.1169004],"rotationOffset":73,"url":"/cgv/panoramas/fm/panorama-@50.1169004,8.6586113,73,70.png"},{"position":[8.6633554,0.2,50.1171317],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1171317,8.6633554,-100,-101.png"},{"position":[8.6588044,0.2,50.1172581],"rotationOffset":71,"url":"/cgv/panoramas/fm/panorama-@50.1172581,8.6588044,71,71.png"},{"position":[8.663442,0.2,50.1174098],"rotationOffset":-100,"url":"/cgv/panoramas/fm/panorama-@50.1174098,8.663442,-100,-101.png"},{"position":[8.6590014,0.2,50.1176176],"rotationOffset":74,"url":"/cgv/panoramas/fm/panorama-@50.1176176,8.6590014,74,72.png"},{"position":[8.6600027,0.2,50.1176976],"rotationOffset":-186,"url":"/cgv/panoramas/fm/panorama-@50.1176976,8.6600027,-186,-189.png"},{"position":[8.6593229,0.2,50.1177469],"rotationOffset":-186,"url":"/cgv/panoramas/fm/panorama-@50.1177469,8.6593229,-186,-189.png"},{"position":[8.660359,0.2,50.1177635],"rotationOffset":261,"url":"/cgv/panoramas/fm/panorama-@50.1177635,8.660359,261,260.png"},{"position":[8.6604327,0.2,50.1180577],"rotationOffset":263,"url":"/cgv/panoramas/fm/panorama-@50.1180577,8.6604327,263,261.png"},{"position":[8.6605192,0.2,50.1184347],"rotationOffset":-97,"url":"/cgv/panoramas/fm/panorama-@50.1184347,8.6605192,-97,-96.png"}]').map((function(e){var t=(0,r.dc)(e.position[0],0),n=(0,r.Oz)(e.position[2],0),i=(0,r.jo)(0,0);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}({},e,{position:[t,e.position[1]/i,n]})}))},22899:function(e,t,n){"use strict";n.d(t,{o6:function(){return en},Sw:function(){return tn},cO:function(){return nn},Ol:function(){return Jt},kk:function(){return Qt},AE:function(){return Rt},zf:function(){return Gt},vx:function(){return ne}});var r=n(34051),o=n.n(r),i=n(85893),a=n(53359),l=n(7088),s=n(80896),c=n(6493),u=n(26135),p=n(55050),f=n(67294),d=n(1655),m=n(21010),h=n(3921),y=n(712),v=n(65449),g=n(73506);function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var S=(0,v.animated)(y.c);function O(){var e=g.D1.getState();return{position:(0,g.bt)(e),rotation:(0,g.H5)(e)}}function M(e){var t=e.children,n=w(e,["children"]),r=j((0,v.useSpring)(O),1)[0],o=r.position,a=r.rotation,l=(0,f.useRef)();return(0,f.useEffect)((function(){var e=g.D1.subscribe((function(e){return(0,g.H5)(e)}),(function(e){return a.start(e)})),t=g.D1.subscribe((function(e){return(0,g.bt)(e)}),(function(e){return o.start(e)})),n=g.D1.subscribe((function(e){return(0,g.bv)(e)}),(function(e){null!=l.current&&(l.current.fov=e,l.current.updateProjectionMatrix())}),{fireImmediately:!0});return function(){e(),t(),n()}}),[a,o]),(0,i.jsx)(S,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}({},n,{ref:l,far:1e3,near:1e-9,position:o,"rotation-order":"YXZ",children:t,rotation:a,makeDefault:!0}))}var P=n(76008),N=n(88057);function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(){var e=(0,N.w)((function(e){return e.gl.domElement}));return(0,P.T2)({onWheel:function(e){var t=e.first,n=E(e.xy,2)[1],r=E(e.previous,2)[1];e.event.preventDefault(),t||g.D1.getState().pinch(1+.002*(n-r))},onDrag:function(t){var n=t.first,r=E(t.xy,2),o=r[0],i=r[1],a=E(t.previous,2),l=a[0],s=a[1],c=t.buttons;t.event.preventDefault(),n||2!==c||g.D1.getState().drag((o-l)/e.clientHeight,(i-s)/e.clientHeight)},onPinch:function(t){var n=E(t.da,1)[0],r=t.event,o=t.origin,i=t.memo;if(r.preventDefault(),null==i)return[n,o];var a=E(i,2),l=a[0],s=a[1];if(null!=l&&g.D1.getState().pinch(n/l),null!=o&&null!=s){var c=E(o,2),u=c[0],p=c[1],f=E(s,2),d=f[0],m=f[1];g.D1.getState().drag((u-d)/e.clientHeight,(p-m)/e.clientHeight)}return[n,o]},onPointerDown:function(t){var n=t.buttons;t.event.preventDefault(),2==n&&"requestPointerLock"in e&&e.requestPointerLock()},onPointerUp:function(e){e.event.preventDefault(),"exitPointerLock"in document&&document.exitPointerLock()}},{domTarget:e,eventOptions:{passive:!1}}),function(){var e=(0,f.useRef)({forward:!1,backward:!1,left:!1,right:!1,up:!1,down:!1});(0,f.useEffect)((function(){var t=function(t){switch(t.key){case"e":e.current.up=!0;break;case"q":e.current.down=!0;break;case"w":case"ArrowUp":e.current.forward=!0;break;case"d":case"ArrowRight":e.current.right=!0;break;case"s":case"ArrowDown":e.current.backward=!0;break;case"a":case"ArrowLeft":e.current.left=!0}},n=function(t){switch(t.key){case"e":e.current.up=!1;break;case"q":e.current.down=!1;break;case"w":case"ArrowUp":e.current.forward=!1;break;case"d":case"ArrowRight":e.current.right=!1;break;case"s":case"ArrowDown":e.current.backward=!1;break;case"a":case"ArrowLeft":e.current.left=!1}};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[]),(0,N.x)((function(t,n){var r=g.D1.getState();if("fly"==r.viewType){var o=n*C,i=0,a=0,l=0;e.current.left&&(i-=o),e.current.right&&(i+=o),e.current.forward&&(l-=o),e.current.backward&&(l+=o),e.current.up&&(a+=o),e.current.down&&(a-=o),0==i&&0==a&&0==l||r.moveFlyCamera([i,a,l])}}))}(),(0,f.useEffect)((function(){var e=function(e){return e.preventDefault()};return window.addEventListener("contextmenu",e),function(){return window.removeEventListener("contextmenu",e)}}),[]),null}var C=1e-6;function V(){return(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-box-arrow-left",viewBox:"0 0 16 16",children:[(0,i.jsx)("path",{fillRule:"evenodd",d:"M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"}),(0,i.jsx)("path",{fillRule:"evenodd",d:"M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"})]})}function D(){return(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-check2-all",viewBox:"0 0 16 16",children:[(0,i.jsx)("path",{d:"M12.354 4.354a.5.5 0 0 0-.708-.708L5 10.293 1.854 7.146a.5.5 0 1 0-.708.708l3.5 3.5a.5.5 0 0 0 .708 0l7-7zm-4.208 7-.896-.897.707-.707.543.543 6.646-6.647a.5.5 0 0 1 .708.708l-7 7a.5.5 0 0 1-.708 0z"}),(0,i.jsx)("path",{d:"m5.354 7.146.896.897-.707.707-.897-.896a.5.5 0 1 1 .708-.708z"})]})}var z=n(1530),T=n(29426),L=n(48827),B=n(70122),I=n(26173),q=n(82513),G=n(77340),R=n(66974);var Q=n(98667);var Z=n(47741),$=n(73133);function W(e){var t=e.value,n=e.getSubstep,r=e.className,o=e.defaultValue,a=n(t),l="raw"===a.children[0].type?a.children[0].value:void 0,s="raw"===a.children[1].type?a.children[1].value:void 0,c="raw"===a.children[2].type?a.children[2].value:void 0,u=(0,m.EB)(),p=function(e,r){return u.getState().replace((function(t){var o=n(t);"operation"===o.type&&(o.children[e]={type:"raw",value:r})}),t)};return(0,i.jsxs)("div",{className:r,children:[(0,i.jsx)(Q.A,{value:null!==l&&void 0!==l?l:o,type:"number",className:"flex-grow-1 me-2 flex-basis-0 form-control form-control-sm",onBlur:function(e){return p(0,e.target.valueAsNumber)}}),(0,i.jsx)(Q.A,{value:null!==s&&void 0!==s?s:o,type:"number",className:"flex-grow-1 me-2 flex-basis-0 form-control form-control-sm",onBlur:function(e){return p(1,e.target.valueAsNumber)}}),(0,i.jsx)(Q.A,{value:null!==c&&void 0!==c?c:o,type:"number",className:"flex-grow-1 flex-basis-0 form-control form-control-sm",onBlur:function(e){return p(2,e.target.valueAsNumber)}})]})}function F(e){var t=e.value,n=e.getSubstep,r=e.className,o=e.defaultValue,a=n(t),l="raw"===a.children[0].type?a.children[0].value:void 0,s="raw"===a.children[1].type?a.children[1].value:void 0,c=(0,m.EB)(),u=function(e,r){return c.getState().replace((function(t){var o=n(t);"operation"===o.type&&(o.children[e]={type:"raw",value:r})}),t)};return(0,i.jsxs)("div",{className:r,children:[(0,i.jsx)(Q.A,{value:null!==l&&void 0!==l?l:o,type:"number",className:"flex-grow-1 me-2 flex-basis-0 form-control form-control-sm",onBlur:function(e){return u(0,e.target.valueAsNumber)}}),(0,i.jsx)(Q.A,{value:null!==s&&void 0!==s?s:o,type:"number",className:"flex-grow-1 flex-basis-0 form-control form-control-sm",onBlur:function(e){return u(1,e.target.valueAsNumber)}})]})}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var H=n(11864);function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_.apply(this,arguments)}function J(e){var t=_({},e);return(0,i.jsxs)("select",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){X(e,t,n[t])}))}return e}({},t,{children:[(0,i.jsx)("option",{value:"x",children:"X"}),(0,i.jsx)("option",{value:"y",children:"Y"}),(0,i.jsx)("option",{value:"z",children:"Z"})]}))}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return K(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var te=function(){return null},ne={color:function(e){var t=e.value,n="raw"===t.children[0].type?t.children[0].value:void 0,r=(0,m.EB)();return(0,i.jsx)("input",{value:null!==n&&void 0!==n?n:16711680,type:"color",className:"mx-3 mb-3 w-auto form-control form-control-sm",onChange:function(e){return r.getState().replace((function(t){t.children[0]={type:"raw",value:e.target.value}}),t)}})},point3:function(e){return W({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},point2:function(e){return F({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},line:function(e){var t=e.value;return"operation"!==t.children[0].type||"operation"!==t.children[1].type?null:(0,i.jsxs)(i.Fragment,{children:["point3"===t.children[0].identifier?(0,i.jsx)(W,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return(0,q.by)("operation",e.children[0])},value:t}):(0,i.jsx)(F,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return(0,q.by)("operation",e.children[0])},value:t}),"point3"===t.children[1].identifier?(0,i.jsx)(W,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return(0,q.by)("operation",e.children[1])},value:t}):(0,i.jsx)(F,{className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return(0,q.by)("operation",e.children[1])},value:t})]})},face:function(e){var t=e.value,n=(0,m.EB)();return(0,i.jsxs)("div",{className:"d-flex flex-column mx-3",children:[t.children.map((function(e,r){return(0,i.jsxs)("div",{className:"d-flex flex-row align-items-center mb-3",children:["operation"===e.type&&(0,i.jsx)(F,{className:"d-flex flex-row",defaultValue:0,getSubstep:function(e){return(0,q.by)("operation",e.children[r])},value:t}),(0,i.jsx)(Z.Z,{placement:"left",overlay:"Delete Point",children:(0,i.jsx)("div",{onClick:function(){return n.getState().replace((function(e){e.children.splice(r,1)}),t)},className:"ms-2 d-flex align-items-center btn-sm btn btn-outline-danger",children:(0,i.jsx)($.p,{})})})]},r)})),(0,i.jsx)("div",{className:"btn btn-outline-success mb-3",onClick:function(){return function(e,t){var n=U((0,g.bt)(g.D1.getState()),3),r=n[0],o=n[2],i=(0,p.FP)(0,18),a=(0,p.jo)(Math.round(o*i),18),l=r*i%1*a,s=o*i%1*a;e.getState().replace((function(e){e.children.push({type:"operation",identifier:"point2",children:[{type:"raw",value:l},{type:"raw",value:s}]})}),t)}(n,t)},children:"Add Point"})]})},extrude:function(e){var t=e.value,n="raw"===t.children[0].type?t.children[0].value:void 0,r=(0,m.EB)();return(0,i.jsx)(Q.A,{value:null!==n&&void 0!==n?n:16711680,type:"number",className:"mx-3 mb-3 w-auto form-control form-control-sm",onBlur:function(e){return r.getState().replace((function(t){t.children[0]={type:"raw",value:e.target.valueAsNumber}}),t)}})},rotate:function(e){return W({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},translate:function(e){return W({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},scale:function(e){return W({className:"mb-3 d-flex flex-row mx-3",defaultValue:0,getSubstep:function(e){return e},value:e.value})},size:function(e){var t=e.value,n="raw"===t.children[0].type?t.children[0].value:void 0,r=(0,m.EB)();return(0,i.jsx)(J,{onChange:function(e){return r.getState().replace((function(t){t.children[0]={type:"raw",value:e.currentTarget.value}}),t)},value:null!==n&&void 0!==n?n:"x",className:"form-select mx-3 mb-3 w-auto form-select-sm"})},toFaces:te,toLines:te,toPoints:te,split:function(e){var t,n=e.value,r=ee(n.children,2),o=r[0],a=r[1],l="raw"===o.type?o.value:void 0,s="raw"===a.type?a.value:void 0,c=(0,m.EB)(),u=(0,f.useCallback)((function(e){c.getState().replace((function(t){t.children[1]={type:"raw",value:e}}),n)}),[c,n]);return(0,i.jsxs)("div",{className:"d-flex flex-column mx-3",children:[(0,i.jsx)(H.w,{value:"Axis",className:"mb-3 ",children:(0,i.jsx)(J,{value:l,onChange:function(e){return c.getState().replace((function(t){t.children[0]={type:"raw",value:e.currentTarget.value}}),n)},className:"flex-grow-1 w-auto form-select form-select-sm"})}),(0,i.jsx)(H.v,{value:"Repeat",className:"mb-3",children:(0,i.jsx)("input",{className:"min-w-0 form-check-input",type:"checkbox",checked:!1!==s,onChange:function(e){return u(!!e.target.checked)}})}),!1!==s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(H.v,{value:"Infinite",className:"mb-3",children:(0,i.jsx)("input",{className:"min-w-0 form-check-input",type:"checkbox",checked:!0===s,onChange:function(e){return u(!!e.target.checked||1)}})}),"number"===typeof s&&(0,i.jsx)(H.w,{value:"Repitions",className:"mb-3",children:(0,i.jsx)(Q.A,{className:"min-w-0 form-control form-control-sm",type:"number",value:s,onBlur:function(e){return u(isNaN(e.target.valueAsNumber)?1:e.target.valueAsNumber)}})})]}),n.children.slice(2).map((function(e,r){return(0,i.jsxs)(H.w,{value:"Size",className:"mb-3",children:[(0,i.jsx)(Q.A,{className:"min-w-0 form-control form-control-sm",type:"number",value:null!==(t="raw"===e.type?e.value:void 0)&&void 0!==t?t:1,onBlur:function(e){return c.getState().replace((function(t){t.children[r+2]={type:"raw",value:e.target.valueAsNumber}}),n)}}),(0,i.jsx)(Z.Z,{placement:"left",overlay:"Delete",children:(0,i.jsx)("div",{onClick:function(){return c.getState().replace((function(e){e.children.splice(r+2,1)}),n)},className:"d-flex align-items-center btn-sm ms-2 btn btn-outline-danger",children:(0,i.jsx)($.p,{})})})]},r)})),(0,i.jsx)("div",{className:"btn btn-outline-success mb-3",onClick:function(){return c.getState().replace((function(e){e.children.push({type:"raw",value:1})}),n)},children:"Add"})]})},gableRoof:function(e){var t,n=e.value,r="raw"===(null===(t=n.children[0])||void 0===t?void 0:t.type)?n.children[0].value:void 0,o=(0,m.EB)();return(0,i.jsx)(H.w,{className:"mx-3 mb-3",value:"rotation",children:(0,i.jsx)(Q.A,{value:null!==r&&void 0!==r?r:0,type:"number",className:"mx-3 mb-3 form-control form-control-sm",onBlur:function(e){return o.getState().replace((function(t){t.children[0]={type:"raw",value:e.target.valueAsNumber}}),n)}})})}};function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ie(e,t,n){return ie="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ae(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},ie(e,t,n||e)}function ae(e){return ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ae(e)}function le(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}function se(e,t){return!t||"object"!==ue(t)&&"function"!==typeof t?re(e):t}function ce(e,t){return ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ce(e,t)}var ue=function(e){return e&&"undefined"!==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ae(e);if(t){var o=ae(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return se(this,n)}}var fe=function(e){le(n,e);var t=pe(n);function n(e,r,o){var i,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];oe(this,n),(i=t.call(this)).isTransformControls=!0,i.visible=!1,i.raycaster=new I.Raycaster,i.tempVector=new I.Vector3,i.tempVector2=new I.Vector3,i.tempQuaternion=new I.Quaternion,i.unit={X:new I.Vector3(1,0,0),Y:new I.Vector3(0,1,0),Z:new I.Vector3(0,0,1)},i.pointStart=new I.Vector3,i.pointEnd=new I.Vector3,i.offset=new I.Vector3,i.rotationAxis=new I.Vector3,i.startNorm=new I.Vector3,i.endNorm=new I.Vector3,i.rotationAngle=0,i.cameraPosition=new I.Vector3,i.cameraQuaternion=new I.Quaternion,i.cameraScale=new I.Vector3,i.parentPosition=new I.Vector3,i.parentQuaternion=new I.Quaternion,i.parentQuaternionInv=new I.Quaternion,i.parentScale=new I.Vector3,i.worldPositionStart=new I.Vector3,i.worldQuaternionStart=new I.Quaternion,i.worldScaleStart=new I.Vector3,i.worldPosition=new I.Vector3,i.worldQuaternion=new I.Quaternion,i.worldQuaternionInv=new I.Quaternion,i.worldScale=new I.Vector3,i.eye=new I.Vector3,i.positionStart=new I.Vector3,i.quaternionStart=new I.Quaternion,i.scaleStart=new I.Vector3,i.enabled=!0,i.axis=null,i.mode="translate",i.translationSnap=null,i.rotationSnap=null,i.scaleSnap=null,i.space="world",i.size=1,i.dragging=!1,i.showX=!0,i.showY=!0,i.showZ=!0,i.changeEvent={type:"change"},i.mouseDownEvent={type:"mouseDown",mode:i.mode},i.mouseUpEvent={type:"mouseUp",mode:i.mode},i.objectChangeEvent={type:"objectChange"},i.intersectObjectWithRay=function(e,t,n){for(var r=t.intersectObject(e,!0),o=0;o<r.length;o++)if(r[o].object.visible||n)return r[o];return!1},i.attach=function(e){return i.object=e,i.visible=!0,re(i)},i.detach=function(){return i.object=void 0,i.visible=!1,i.axis=null,re(i)},i.reset=function(){return i.enabled?(i.dragging&&void 0!==i.object&&(i.object.position.copy(i.positionStart),i.object.quaternion.copy(i.quaternionStart),i.object.scale.copy(i.scaleStart),i.dispatchEvent(i.changeEvent),i.dispatchEvent(i.objectChangeEvent),i.pointStart.copy(i.pointEnd)),re(i)):re(i)},i.updateMatrixWorld=function(){void 0!==i.object&&(i.object.updateMatrixWorld(),null===i.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):i.object.parent.matrixWorld.decompose(i.parentPosition,i.parentQuaternion,i.parentScale),i.object.matrixWorld.decompose(i.worldPosition,i.worldQuaternion,i.worldScale),i.parentQuaternionInv.copy(i.parentQuaternion).invert(),i.worldQuaternionInv.copy(i.worldQuaternion).invert()),i.camera.updateMatrixWorld(),i.camera.matrixWorld.decompose(i.cameraPosition,i.cameraQuaternion,i.cameraScale),i.eye.copy(i.cameraPosition).sub(i.worldPosition).normalize(),ie((re(i),ae(n.prototype)),"updateMatrixWorld",i).call(i)},i.pointerHover=function(e){if(void 0!==i.object&&!0!==i.dragging){i.raycaster.setFromCamera(e,i.camera);var t=i.intersectObjectWithRay(i.gizmo.picker[i.mode],i.raycaster);i.axis=t?t.object.name:null}},i.pointerDown=function(e){if(void 0!==i.object&&!0!==i.dragging&&0===e.button&&null!==i.axis){i.raycaster.setFromCamera(e,i.camera);var t=i.intersectObjectWithRay(i.plane,i.raycaster,!0);if(t){var n=i.space;if("scale"===i.mode?n="local":"E"!==i.axis&&"XYZE"!==i.axis&&"XYZ"!==i.axis||(n="world"),"local"===n&&"rotate"===i.mode){var r=i.rotationSnap;"X"===i.axis&&r&&(i.object.rotation.x=Math.round(i.object.rotation.x/r)*r),"Y"===i.axis&&r&&(i.object.rotation.y=Math.round(i.object.rotation.y/r)*r),"Z"===i.axis&&r&&(i.object.rotation.z=Math.round(i.object.rotation.z/r)*r)}i.object.updateMatrixWorld(),i.object.parent&&i.object.parent.updateMatrixWorld(),i.positionStart.copy(i.object.position),i.quaternionStart.copy(i.object.quaternion),i.scaleStart.copy(i.object.scale),i.object.matrixWorld.decompose(i.worldPositionStart,i.worldQuaternionStart,i.worldScaleStart),i.pointStart.copy(t.point).sub(i.worldPositionStart)}i.dragging=!0,i.mouseDownEvent.mode=i.mode,i.dispatchEvent(i.mouseDownEvent)}},i.pointerMove=function(e){var t=i.axis,n=i.mode,r=i.object,o=i.space;if("scale"===n?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==r&&null!==t&&!1!==i.dragging&&-1===e.button){i.raycaster.setFromCamera(e,i.camera);var a=i.intersectObjectWithRay(i.plane,i.raycaster,!0);if(a){if(i.pointEnd.copy(a.point).sub(i.worldPositionStart),"translate"===n)i.offset.copy(i.pointEnd).sub(i.pointStart),"local"===o&&"XYZ"!==t&&i.offset.applyQuaternion(i.worldQuaternionInv),-1===t.indexOf("X")&&(i.offset.x=0),-1===t.indexOf("Y")&&(i.offset.y=0),-1===t.indexOf("Z")&&(i.offset.z=0),"local"===o&&"XYZ"!==t?i.offset.applyQuaternion(i.quaternionStart).divide(i.parentScale):i.offset.applyQuaternion(i.parentQuaternionInv).divide(i.parentScale),r.position.copy(i.offset).add(i.positionStart),i.translationSnap&&("local"===o&&(r.position.applyQuaternion(i.tempQuaternion.copy(i.quaternionStart).invert()),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/i.translationSnap)*i.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/i.translationSnap)*i.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/i.translationSnap)*i.translationSnap),r.position.applyQuaternion(i.quaternionStart)),"world"===o&&(r.parent&&r.position.add(i.tempVector.setFromMatrixPosition(r.parent.matrixWorld)),-1!==t.search("X")&&(r.position.x=Math.round(r.position.x/i.translationSnap)*i.translationSnap),-1!==t.search("Y")&&(r.position.y=Math.round(r.position.y/i.translationSnap)*i.translationSnap),-1!==t.search("Z")&&(r.position.z=Math.round(r.position.z/i.translationSnap)*i.translationSnap),r.parent&&r.position.sub(i.tempVector.setFromMatrixPosition(r.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var l=i.pointEnd.length()/i.pointStart.length();i.pointEnd.dot(i.pointStart)<0&&(l*=-1),i.tempVector2.set(l,l,l)}else i.tempVector.copy(i.pointStart),i.tempVector2.copy(i.pointEnd),i.tempVector.applyQuaternion(i.worldQuaternionInv),i.tempVector2.applyQuaternion(i.worldQuaternionInv),i.tempVector2.divide(i.tempVector),-1===t.search("X")&&(i.tempVector2.x=1),-1===t.search("Y")&&(i.tempVector2.y=1),-1===t.search("Z")&&(i.tempVector2.z=1);r.scale.copy(i.scaleStart).multiply(i.tempVector2),i.scaleSnap&&i.object&&(-1!==t.search("X")&&(i.object.scale.x=Math.round(r.scale.x/i.scaleSnap)*i.scaleSnap||i.scaleSnap),-1!==t.search("Y")&&(r.scale.y=Math.round(r.scale.y/i.scaleSnap)*i.scaleSnap||i.scaleSnap),-1!==t.search("Z")&&(r.scale.z=Math.round(r.scale.z/i.scaleSnap)*i.scaleSnap||i.scaleSnap))}else if("rotate"===n){i.offset.copy(i.pointEnd).sub(i.pointStart);var s=20/i.worldPosition.distanceTo(i.tempVector.setFromMatrixPosition(i.camera.matrixWorld));"E"===t?(i.rotationAxis.copy(i.eye),i.rotationAngle=i.pointEnd.angleTo(i.pointStart),i.startNorm.copy(i.pointStart).normalize(),i.endNorm.copy(i.pointEnd).normalize(),i.rotationAngle*=i.endNorm.cross(i.startNorm).dot(i.eye)<0?1:-1):"XYZE"===t?(i.rotationAxis.copy(i.offset).cross(i.eye).normalize(),i.rotationAngle=i.offset.dot(i.tempVector.copy(i.rotationAxis).cross(i.eye))*s):"X"!==t&&"Y"!==t&&"Z"!==t||(i.rotationAxis.copy(i.unit[t]),i.tempVector.copy(i.unit[t]),"local"===o&&i.tempVector.applyQuaternion(i.worldQuaternion),i.rotationAngle=i.offset.dot(i.tempVector.cross(i.eye).normalize())*s),i.rotationSnap&&(i.rotationAngle=Math.round(i.rotationAngle/i.rotationSnap)*i.rotationSnap),"local"===o&&"E"!==t&&"XYZE"!==t?(r.quaternion.copy(i.quaternionStart),r.quaternion.multiply(i.tempQuaternion.setFromAxisAngle(i.rotationAxis,i.rotationAngle)).normalize()):(i.rotationAxis.applyQuaternion(i.parentQuaternionInv),r.quaternion.copy(i.tempQuaternion.setFromAxisAngle(i.rotationAxis,i.rotationAngle)),r.quaternion.multiply(i.quaternionStart).normalize())}i.dispatchEvent(i.changeEvent),i.dispatchEvent(i.objectChangeEvent)}}},i.pointerUp=function(e){0===e.button&&(i.dragging&&null!==i.axis&&(i.mouseUpEvent.mode=i.mode,i.dispatchEvent(i.mouseUpEvent)),i.dragging=!1,i.axis=null)},i.getPointer=function(e){var t;if(i.domElement&&(null===(t=i.domElement.ownerDocument)||void 0===t?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};var n,r=e.changedTouches?e.changedTouches[0]:e,o=null===(n=i.domElement)||void 0===n?void 0:n.getBoundingClientRect();return{x:(r.clientX-o.left)/o.width*2-1,y:-(r.clientY-o.top)/o.height*2+1,button:e.button}},i.onPointerHover=function(e){if(i.enabled)switch(e.pointerType){case"mouse":case"pen":i.pointerHover(i.getPointer(e))}},i.onPointerDown=function(e){i.enabled&&i.domElement&&(i.domElement.style.touchAction="none",i.domElement.ownerDocument.addEventListener("pointermove",i.onPointerMove),i.pointerHover(i.getPointer(e)),i.pointerDown(i.getPointer(e)))},i.onPointerMove=function(e){i.enabled&&i.pointerMove(i.getPointer(e))},i.onPointerUp=function(e){i.enabled&&i.domElement&&(i.domElement.style.touchAction="",i.domElement.ownerDocument.removeEventListener("pointermove",i.onPointerMove),i.pointerUp(i.getPointer(e)))},i.getMode=function(){return i.mode},i.setMode=function(e){i.mode=e},i.setTranslationSnap=function(e){i.translationSnap=e},i.setRotationSnap=function(e){i.rotationSnap=e},i.setScaleSnap=function(e){i.scaleSnap=e},i.setSize=function(e){i.size=e},i.setSpace=function(e){i.space=e},i.update=function(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")},i.connect=function(e){e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),i.domElement=e,i.domElement.addEventListener("pointerdown",i.onPointerDown),i.domElement.addEventListener("pointermove",i.onPointerHover),i.domElement.ownerDocument.addEventListener("pointerup",i.onPointerUp)},i.dispose=function(){var e,t,n,r,o,a;null===(e=i.domElement)||void 0===e||e.removeEventListener("pointerdown",i.onPointerDown),null===(t=i.domElement)||void 0===t||t.removeEventListener("pointermove",i.onPointerHover),null===(n=i.domElement)||void 0===n||null===(r=n.ownerDocument)||void 0===r||r.removeEventListener("pointermove",i.onPointerMove),null===(o=i.domElement)||void 0===o||null===(a=o.ownerDocument)||void 0===a||a.removeEventListener("pointerup",i.onPointerUp),i.traverse((function(e){var t=e;t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))},i.domElement=o,i.camera=r,i.gizmo=new de(e,a),i.add(i.gizmo),i.plane=new me,i.add(i.plane);var l=function(e,t){var n=t;Object.defineProperty(re(i),e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),i[e]=t,i.plane[e]=t,i.gizmo[e]=t};return l("camera",i.camera),l("object",i.object),l("enabled",i.enabled),l("axis",i.axis),l("mode",i.mode),l("translationSnap",i.translationSnap),l("rotationSnap",i.rotationSnap),l("scaleSnap",i.scaleSnap),l("space",i.space),l("size",i.size),l("dragging",i.dragging),l("showX",i.showX),l("showY",i.showY),l("showZ",i.showZ),l("worldPosition",i.worldPosition),l("worldPositionStart",i.worldPositionStart),l("worldQuaternion",i.worldQuaternion),l("worldQuaternionStart",i.worldQuaternionStart),l("cameraPosition",i.cameraPosition),l("cameraQuaternion",i.cameraQuaternion),l("pointStart",i.pointStart),l("pointEnd",i.pointEnd),l("rotationAxis",i.rotationAxis),l("rotationAngle",i.rotationAngle),l("eye",i.eye),void 0!==o&&i.connect(o),i}return n}(I.Object3D),de=function(e){le(n,e);var t=pe(n);function n(e,r){var o;oe(this,n),(o=t.call(this)).isTransformControlsGizmo=!0,o.type="TransformControlsGizmo",o.tempVector=new I.Vector3(0,0,0),o.tempEuler=new I.Euler,o.alignVector=new I.Vector3(0,1,0),o.zeroVector=new I.Vector3(0,0,0),o.lookAtMatrix=new I.Matrix4,o.tempQuaternion=new I.Quaternion,o.tempQuaternion2=new I.Quaternion,o.identityQuaternion=new I.Quaternion,o.unitX=new I.Vector3(1,0,0),o.unitY=new I.Vector3(0,1,0),o.unitZ=new I.Vector3(0,0,1),o.rotationAxis=new I.Vector3,o.cameraPosition=new I.Vector3,o.worldPositionStart=new I.Vector3,o.worldQuaternionStart=new I.Quaternion,o.worldPosition=new I.Vector3,o.worldQuaternion=new I.Quaternion,o.eye=new I.Vector3,o.camera=null,o.enabled=!0,o.axis=null,o.mode="translate",o.space="world",o.size=1,o.dragging=!1,o.showX=!0,o.showY=!0,o.showZ=!0,o.updateMatrixWorld=function(){var e=function(e){var t=i[e];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(o.worldPosition);var n=void 0;if(n=o.camera.isOrthographicCamera?(o.camera.top-o.camera.bottom)/o.camera.zoom:o.worldPosition.distanceTo(o.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*o.camera.fov/360)/o.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(n*o.size/7),"helper"===t.tag)return t.visible=!1,"AXIS"===t.name?(t.position.copy(o.worldPositionStart),t.visible=!!o.axis,"X"===o.axis&&(o.tempQuaternion.setFromEuler(o.tempEuler.set(0,0,0)),t.quaternion.copy(r).multiply(o.tempQuaternion),Math.abs(o.alignVector.copy(o.unitX).applyQuaternion(r).dot(o.eye))>.9&&(t.visible=!1)),"Y"===o.axis&&(o.tempQuaternion.setFromEuler(o.tempEuler.set(0,0,Math.PI/2)),t.quaternion.copy(r).multiply(o.tempQuaternion),Math.abs(o.alignVector.copy(o.unitY).applyQuaternion(r).dot(o.eye))>.9&&(t.visible=!1)),"Z"===o.axis&&(o.tempQuaternion.setFromEuler(o.tempEuler.set(0,Math.PI/2,0)),t.quaternion.copy(r).multiply(o.tempQuaternion),Math.abs(o.alignVector.copy(o.unitZ).applyQuaternion(r).dot(o.eye))>.9&&(t.visible=!1)),"XYZE"===o.axis&&(o.tempQuaternion.setFromEuler(o.tempEuler.set(0,Math.PI/2,0)),o.alignVector.copy(o.rotationAxis),t.quaternion.setFromRotationMatrix(o.lookAtMatrix.lookAt(o.zeroVector,o.alignVector,o.unitY)),t.quaternion.multiply(o.tempQuaternion),t.visible=o.dragging),"E"===o.axis&&(t.visible=!1)):"START"===t.name?(t.position.copy(o.worldPositionStart),t.visible=o.dragging):"END"===t.name?(t.position.copy(o.worldPosition),t.visible=o.dragging):"DELTA"===t.name?(t.position.copy(o.worldPositionStart),t.quaternion.copy(o.worldQuaternionStart),o.tempVector.set(1e-10,1e-10,1e-10).add(o.worldPositionStart).sub(o.worldPosition).multiplyScalar(-1),o.tempVector.applyQuaternion(o.worldQuaternionStart.clone().invert()),t.scale.copy(o.tempVector),t.visible=o.dragging):(t.quaternion.copy(r),o.dragging?t.position.copy(o.worldPositionStart):t.position.copy(o.worldPosition),o.axis&&(t.visible=-1!==o.axis.search(t.name))),"continue";if(t.quaternion.copy(r),"translate"===o.mode||"scale"===o.mode){var a=.99;"X"!==t.name&&"XYZX"!==t.name||Math.abs(o.alignVector.copy(o.unitX).applyQuaternion(r).dot(o.eye))>a&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"Y"!==t.name&&"XYZY"!==t.name||Math.abs(o.alignVector.copy(o.unitY).applyQuaternion(r).dot(o.eye))>a&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"Z"!==t.name&&"XYZZ"!==t.name||Math.abs(o.alignVector.copy(o.unitZ).applyQuaternion(r).dot(o.eye))>a&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"XY"===t.name&&Math.abs(o.alignVector.copy(o.unitZ).applyQuaternion(r).dot(o.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"YZ"===t.name&&Math.abs(o.alignVector.copy(o.unitX).applyQuaternion(r).dot(o.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),"XZ"===t.name&&Math.abs(o.alignVector.copy(o.unitY).applyQuaternion(r).dot(o.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),-1!==t.name.search("X")&&(o.alignVector.copy(o.unitX).applyQuaternion(r).dot(o.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.x*=-1:"bwd"===t.tag&&(t.visible=!1)),-1!==t.name.search("Y")&&(o.alignVector.copy(o.unitY).applyQuaternion(r).dot(o.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.y*=-1:"bwd"===t.tag&&(t.visible=!1)),-1!==t.name.search("Z")&&(o.alignVector.copy(o.unitZ).applyQuaternion(r).dot(o.eye)<0?"fwd"===t.tag?t.visible=!1:t.scale.z*=-1:"bwd"===t.tag&&(t.visible=!1))}else"rotate"===o.mode&&(o.tempQuaternion2.copy(r),o.alignVector.copy(o.eye).applyQuaternion(o.tempQuaternion.copy(r).invert()),-1!==t.name.search("E")&&t.quaternion.setFromRotationMatrix(o.lookAtMatrix.lookAt(o.eye,o.zeroVector,o.unitY)),"X"===t.name&&(o.tempQuaternion.setFromAxisAngle(o.unitX,Math.atan2(-o.alignVector.y,o.alignVector.z)),o.tempQuaternion.multiplyQuaternions(o.tempQuaternion2,o.tempQuaternion),t.quaternion.copy(o.tempQuaternion)),"Y"===t.name&&(o.tempQuaternion.setFromAxisAngle(o.unitY,Math.atan2(o.alignVector.x,o.alignVector.z)),o.tempQuaternion.multiplyQuaternions(o.tempQuaternion2,o.tempQuaternion),t.quaternion.copy(o.tempQuaternion)),"Z"===t.name&&(o.tempQuaternion.setFromAxisAngle(o.unitZ,Math.atan2(o.alignVector.y,o.alignVector.x)),o.tempQuaternion.multiplyQuaternions(o.tempQuaternion2,o.tempQuaternion),t.quaternion.copy(o.tempQuaternion)));t.visible=t.visible&&(-1===t.name.indexOf("X")||o.showX),t.visible=t.visible&&(-1===t.name.indexOf("Y")||o.showY),t.visible=t.visible&&(-1===t.name.indexOf("Z")||o.showZ),t.visible=t.visible&&(-1===t.name.indexOf("E")||o.showX&&o.showY&&o.showZ),t.material.tempOpacity=t.material.tempOpacity||t.material.opacity,t.material.tempColor=t.material.tempColor||t.material.color.clone(),t.material.color.copy(t.material.tempColor),t.material.opacity=t.material.tempOpacity,o.enabled?o.axis&&(t.name===o.axis||o.axis.split("").some((function(e){return t.name===e}))?(t.material.opacity=1,t.material.color.lerp(new I.Color(1,1,1),.5)):(t.material.opacity*=.25,t.material.color.lerp(new I.Color(1,1,1),.5))):(t.material.opacity*=.5,t.material.color.lerp(new I.Color(1,1,1),.5))},t=o.space;"scale"===o.mode&&(t="local");var r="local"===t?o.worldQuaternion:o.identityQuaternion;o.gizmo.translate.visible="translate"===o.mode,o.gizmo.rotate.visible="rotate"===o.mode,o.gizmo.scale.visible="scale"===o.mode,o.helper.translate.visible="translate"===o.mode,o.helper.rotate.visible="rotate"===o.mode,o.helper.scale.visible="scale"===o.mode;var i=[];i=(i=(i=i.concat(o.picker[o.mode].children)).concat(o.gizmo[o.mode].children)).concat(o.helper[o.mode].children);for(var a=0;a<i.length;a++)e(a);ie((re(o),ae(n.prototype)),"updateMatrixWorld",o).call(o)};var i=new I.MeshBasicMaterial({depthTest:r,depthWrite:r,transparent:!0,side:I.DoubleSide,fog:!1,toneMapped:!1}),a=new I.LineBasicMaterial({depthTest:r,depthWrite:r,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),l=i.clone();l.opacity=.15;var s=i.clone();s.opacity=.33;var c=i.clone();c.color.set(16711680);var u=i.clone();u.color.set(65280);var p=i.clone();p.color.set(255);var f=i.clone();f.opacity=.25;var d=f.clone();d.color.set(16776960);var m=f.clone();m.color.set(65535);var h=f.clone();h.color.set(16711935),i.clone().color.set(16776960);var y=a.clone();y.color.set(16711680);var v=a.clone();v.color.set(65280);var g=a.clone();g.color.set(255);var b=a.clone();b.color.set(65535);var x=a.clone();x.color.set(16711935);var w=a.clone();w.color.set(16776960);var j=a.clone();j.color.set(7895160);var S=w.clone();S.opacity=.25;var O=new I.CylinderGeometry(0,.05,.2,12,1,!1),M=new I.SphereGeometry(.035),P=new I.BoxGeometry(.125,.125,.125),N=new I.BufferGeometry;N.setAttribute("position",new I.Float32BufferAttribute([0,0,0,e,0,0],3));var A=function(e,t){for(var n=new I.BufferGeometry,r=[],o=0;o<=64*t;++o)r.push(0,Math.cos(o/32*Math.PI)*e,Math.sin(o/32*Math.PI)*e);return n.setAttribute("position",new I.Float32BufferAttribute(r,3)),n},E={X:[[new I.Mesh(O,c),[e,0,0],[0,0,-Math.PI/2],null,"fwd"],[new I.Mesh(O,c),[e,0,0],[0,0,Math.PI/2],null,"bwd"],[new I.Line(N,y)],[new I.Mesh(M,c)]],Y:[[new I.Mesh(O,u),[0,e,0],null,null,"fwd"],[new I.Mesh(O,u),[0,e,0],[Math.PI,0,0],null,"bwd"],[new I.Line(N,v),null,[0,0,Math.PI/2]],[new I.Mesh(M,u)]],Z:[[new I.Mesh(O,p),[0,0,e],[Math.PI/2,0,0],null,"fwd"],[new I.Mesh(O,p),[0,0,e],[-Math.PI/2,0,0],null,"bwd"],[new I.Line(N,g),null,[0,-Math.PI/2,0]],[new I.Mesh(M,p)]],XYZ:[[new I.Mesh(new I.OctahedronGeometry(.1,0),f.clone()),[0,0,0],[0,0,0]]],XY:[[new I.Mesh(new I.PlaneGeometry(.295,.295),d.clone()),[.15,.15,0]],[new I.Line(N,w),[.18,.3,0],null,[.125,1,1]],[new I.Line(N,w),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new I.Mesh(new I.PlaneGeometry(.295,.295),m.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new I.Line(N,b),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new I.Line(N,b),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new I.Mesh(new I.PlaneGeometry(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new I.Line(N,x),[.18,0,.3],null,[.125,1,1]],[new I.Line(N,x),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},k={X:[[new I.Mesh(new I.CylinderGeometry(.1,0,e,4,1,!1),l),[.6*e,0,0],[0,0,-Math.PI/2]]],Y:[[new I.Mesh(new I.CylinderGeometry(.1,0,e,4,1,!1),l),[0,.6*e,0]]],Z:[[new I.Mesh(new I.CylinderGeometry(.1,0,e,4,1,!1),l),[0,0,.6*e],[Math.PI/2,0,0]]],XYZ:[[new I.Mesh(new I.OctahedronGeometry(.2,0),l)]],XY:[[new I.Mesh(new I.PlaneGeometry(.4,.4),l),[.2,.2,0]]],YZ:[[new I.Mesh(new I.PlaneGeometry(.4,.4),l),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new I.Mesh(new I.PlaneGeometry(.4,.4),l),[.2,0,.2],[-Math.PI/2,0,0]]]},C={START:[[new I.Mesh(new I.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],END:[[new I.Mesh(new I.OctahedronGeometry(.01,2),s),null,null,null,"helper"]],DELTA:[[new I.Line(function(){var e=new I.BufferGeometry;return e.setAttribute("position",new I.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),s),null,null,null,"helper"]],X:[[new I.Line(N,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new I.Line(N,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new I.Line(N,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},V={X:[[new I.Line(A(1,.5),y)],[new I.Mesh(new I.OctahedronGeometry(.04,0),c),[0,0,.99],null,[1,3,1]]],Y:[[new I.Line(A(1,.5),v),null,[0,0,-Math.PI/2]],[new I.Mesh(new I.OctahedronGeometry(.04,0),u),[0,0,.99],null,[3,1,1]]],Z:[[new I.Line(A(1,.5),g),null,[0,Math.PI/2,0]],[new I.Mesh(new I.OctahedronGeometry(.04,0),p),[.99,0,0],null,[1,3,1]]],E:[[new I.Line(A(1.25,1),S),null,[0,Math.PI/2,0]],[new I.Mesh(new I.CylinderGeometry(.03,0,.15,4,1,!1),S),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new I.Mesh(new I.CylinderGeometry(.03,0,.15,4,1,!1),S),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new I.Mesh(new I.CylinderGeometry(.03,0,.15,4,1,!1),S),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new I.Mesh(new I.CylinderGeometry(.03,0,.15,4,1,!1),S),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new I.Line(A(1,1),j),null,[0,Math.PI/2,0]]]},D={AXIS:[[new I.Line(N,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},z={X:[[new I.Mesh(new I.TorusGeometry(1,.1,4,24),l),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new I.Mesh(new I.TorusGeometry(1,.1,4,24),l),[0,0,0],[Math.PI/2,0,0]]],Z:[[new I.Mesh(new I.TorusGeometry(1,.1,4,24),l),[0,0,0],[0,0,-Math.PI/2]]],E:[[new I.Mesh(new I.TorusGeometry(1.25,.1,2,24),l)]],XYZE:[[new I.Mesh(new I.SphereGeometry(.7,10,8),l)]]},T={X:[[new I.Mesh(P,c),[.8,0,0],[0,0,-Math.PI/2]],[new I.Line(N,y),null,null,[.8,1,1]]],Y:[[new I.Mesh(P,u),[0,.8,0]],[new I.Line(N,v),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new I.Mesh(P,p),[0,0,.8],[Math.PI/2,0,0]],[new I.Line(N,g),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new I.Mesh(P,d),[.85,.85,0],null,[2,2,.2]],[new I.Line(N,w),[.855,.98,0],null,[.125,1,1]],[new I.Line(N,w),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new I.Mesh(P,m),[0,.85,.85],null,[.2,2,2]],[new I.Line(N,b),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new I.Line(N,b),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new I.Mesh(P,h),[.85,0,.85],null,[2,.2,2]],[new I.Line(N,x),[.855,0,.98],null,[.125,1,1]],[new I.Line(N,x),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new I.Mesh(new I.BoxGeometry(.125,.125,.125),f.clone()),[1.1,0,0]]],XYZY:[[new I.Mesh(new I.BoxGeometry(.125,.125,.125),f.clone()),[0,1.1,0]]],XYZZ:[[new I.Mesh(new I.BoxGeometry(.125,.125,.125),f.clone()),[0,0,1.1]]]},L={X:[[new I.Mesh(new I.CylinderGeometry(.2,0,.8,4,1,!1),l),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new I.Mesh(new I.CylinderGeometry(.2,0,.8,4,1,!1),l),[0,.5,0]]],Z:[[new I.Mesh(new I.CylinderGeometry(.2,0,.8,4,1,!1),l),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new I.Mesh(P,l),[.85,.85,0],null,[3,3,.2]]],YZ:[[new I.Mesh(P,l),[0,.85,.85],null,[.2,3,3]]],XZ:[[new I.Mesh(P,l),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new I.Mesh(new I.BoxGeometry(.2,.2,.2),l),[1.1,0,0]]],XYZY:[[new I.Mesh(new I.BoxGeometry(.2,.2,.2),l),[0,1.1,0]]],XYZZ:[[new I.Mesh(new I.BoxGeometry(.2,.2,.2),l),[0,0,1.1]]]},B={X:[[new I.Line(N,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new I.Line(N,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new I.Line(N,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},q=function(e){var t=new I.Object3D;for(var n in e)for(var r=e[n].length;r--;){var o=e[n][r][0].clone(),i=e[n][r][1],a=e[n][r][2],l=e[n][r][3],s=e[n][r][4];o.name=n,o.tag=s,i&&o.position.set(i[0],i[1],i[2]),a&&o.rotation.set(a[0],a[1],a[2]),l&&o.scale.set(l[0],l[1],l[2]),o.updateMatrix();var c=o.geometry.clone();c.applyMatrix4(o.matrix),o.geometry=c,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),t.add(o)}return t};return o.gizmo={},o.picker={},o.helper={},o.add(o.gizmo.translate=q(E)),o.add(o.gizmo.rotate=q(V)),o.add(o.gizmo.scale=q(T)),o.add(o.picker.translate=q(k)),o.add(o.picker.rotate=q(z)),o.add(o.picker.scale=q(L)),o.add(o.helper.translate=q(C)),o.add(o.helper.rotate=q(D)),o.add(o.helper.scale=q(B)),o.picker.translate.visible=!1,o.picker.rotate.visible=!1,o.picker.scale.visible=!1,o}return n}(I.Object3D),me=function(e){le(n,e);var t=pe(n);function n(){var e;return oe(this,n),(e=t.call(this,new I.PlaneGeometry(1e5,1e5,2,2),new I.MeshBasicMaterial({visible:!1,wireframe:!0,side:I.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1}))).isTransformControlsPlane=!0,e.type="TransformControlsPlane",e.unitX=new I.Vector3(1,0,0),e.unitY=new I.Vector3(0,1,0),e.unitZ=new I.Vector3(0,0,1),e.tempVector=new I.Vector3,e.dirVector=new I.Vector3,e.alignVector=new I.Vector3,e.tempMatrix=new I.Matrix4,e.identityQuaternion=new I.Quaternion,e.cameraQuaternion=new I.Quaternion,e.worldPosition=new I.Vector3,e.worldQuaternion=new I.Quaternion,e.eye=new I.Vector3,e.axis=null,e.mode="translate",e.space="world",e.updateMatrixWorld=function(){var t=e.space;switch(e.position.copy(e.worldPosition),"scale"===e.mode&&(t="local"),e.unitX.set(1,0,0).applyQuaternion("local"===t?e.worldQuaternion:e.identityQuaternion),e.unitY.set(0,1,0).applyQuaternion("local"===t?e.worldQuaternion:e.identityQuaternion),e.unitZ.set(0,0,1).applyQuaternion("local"===t?e.worldQuaternion:e.identityQuaternion),e.alignVector.copy(e.unitY),e.mode){case"translate":case"scale":switch(e.axis){case"X":e.alignVector.copy(e.eye).cross(e.unitX),e.dirVector.copy(e.unitX).cross(e.alignVector);break;case"Y":e.alignVector.copy(e.eye).cross(e.unitY),e.dirVector.copy(e.unitY).cross(e.alignVector);break;case"Z":e.alignVector.copy(e.eye).cross(e.unitZ),e.dirVector.copy(e.unitZ).cross(e.alignVector);break;case"XY":e.dirVector.copy(e.unitZ);break;case"YZ":e.dirVector.copy(e.unitX);break;case"XZ":e.alignVector.copy(e.unitZ),e.dirVector.copy(e.unitY);break;case"XYZ":case"E":e.dirVector.set(0,0,0)}break;default:e.dirVector.set(0,0,0)}0===e.dirVector.length()?e.quaternion.copy(e.cameraQuaternion):(e.tempMatrix.lookAt(e.tempVector.set(0,0,0),e.dirVector,e.alignVector),e.quaternion.setFromRotationMatrix(e.tempMatrix)),ie((re(e),ae(n.prototype)),"updateMatrixWorld",e).call(e)},e}return n}(I.Mesh);function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ye(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ve(e,t,n){return ve=ye()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&ge(o,n.prototype),o},ve.apply(null,arguments)}function ge(e,t){return ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ge(e,t)}function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||we(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||we(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function we(e,t){if(e){if("string"===typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?he(e,t):void 0}}function je(e){var t=e.mode,n=e.set,r=e.value,o=e.matrix,a=e.axis,l=e.child,s=e.length,c=e.depth,u=(0,N.w)((function(e){return[e.camera,e.gl.domElement]})),p=(0,f.useState)(null),d=p[0],m=p[1],h=be(a,3),y=h[0],v=h[1],b=h[2],x=(0,f.useMemo)((function(){return ve(fe,[null!==s&&void 0!==s?s:1].concat(xe(u),[c]))}),[c,s].concat(xe(u)));(0,f.useEffect)((function(){if(null!=d)return x.attach(d),function(){x.detach()}}),[d,x]),(0,f.useEffect)((function(){if(null!=x&&null!=d){var e=function(){g.D1.getState().setControlling(!0)},r=function(e){setTimeout((function(){return g.D1.getState().setControlling(!1)}));var r=d[Se[t]],o=r.x,i=r.y,a=r.z;n(o,i,a)};return x.addEventListener("mouseDown",e),x.addEventListener("mouseUp",r),function(){g.D1.getState().setControlling(!1),x.removeEventListener("mouseUp",e),x.removeEventListener("mouseDown",r)}}}),[n,t,d]),null!=d&&d[Se[t]].fromArray(r);var w=(0,N.w)((function(e){return e.scene}));return(0,i.jsxs)("group",{matrixAutoUpdate:!1,matrix:o,children:[null!=d&&(0,N.g)((0,i.jsx)("primitive",{showX:y,showY:v,showZ:b,mode:t,space:"local",object:x}),w),(0,i.jsx)("group",{ref:m,children:null!=l&&(0,i.jsx)("primitive",{object:l})})]})}var Se={rotate:"rotation",scale:"scale",translate:"position"},Oe=[!0,!0,!0],Me=[!0,!1,!0];function Pe(e){var t=e.substepValue,n=e.getSubstep,r=e.valueRef,o=e.matrix,a=(0,m.EB)(),l="raw"===t.children[0].type?t.children[0].value:0,s="raw"===t.children[1].type?t.children[1].value:0,c="raw"===t.children[2].type?t.children[2].value:0;return(0,i.jsx)(je,{value:[l,s,c],axis:Oe,matrix:o,mode:"translate",set:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return a.getState().replace((function(e){(null==n?e:n(e)).children=t.map((function(e){return{type:"raw",value:e}}))}),r.current)}})}function Ne(e){var t=e.substepValue,n=e.getSubstep,r=e.valueRef,o=e.matrix,a=(0,m.EB)(),l="raw"===t.children[0].type?t.children[0].value:0,s="raw"===t.children[1].type?t.children[1].value:0;return(0,i.jsx)(je,{value:[l,0,s],axis:Me,matrix:o,mode:"translate",set:function(e,t,o){return a.getState().replace((function(t){(null==n?t:n(t)).children=[e,o].map((function(e){return{type:"raw",value:e}}))}),r.current)}})}function Ae(e){var t=e.value,n=e.valueRef,r=e.matrix;return(0,i.jsx)(i.Fragment,{children:t.children.map((function(e,t){return"operation"===e.type&&(0,i.jsx)(Ee,{matrix:r,valueRef:n,child:e,index:t},t)}))})}function Ee(e){var t=e.index,n=e.child,r=e.valueRef,o=e.matrix,a=(0,f.useCallback)((function(e){return(0,q.by)("operation",e.children[t])}),[t]);return"point3"===n.identifier?(0,i.jsx)(Pe,{matrix:o,valueRef:r,getSubstep:a,substepValue:n}):(0,i.jsx)(Ne,{matrix:o,valueRef:r,getSubstep:a,substepValue:n})}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ce(e){return function(e){if(Array.isArray(e))return ke(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ke(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ve=[!1,!0,!1],De=[!0,!0,!0];function ze(e){var t=e.description,n=(0,m.EB)()((function(e){return"gui"===e.type&&null==e.requested?e.selectionsList.filter((function(e){return(0,q.Lr)(t,(0,q.Il)(e.steps)[0])})):void 0}),q.wU);return null==n?null:(0,i.jsx)(i.Fragment,{children:n.map((function(e){return(0,i.jsx)(Le,{values:e.values,step:e.steps},(0,q.zq)(e.steps))}))})}function Te(e){return e}function Le(e){var t=e.step,n=e.values;if("string"==typeof t||"operation"!=t.type)return null;var r=n.map((function(e){return e.before.raw})).filter((function(e,t,n){return n.indexOf(e)===t})).filter(Be),o=(0,f.useMemo)((function(){return{current:t}}),[]);switch(o.current=t,t.identifier){case"point3":return(0,i.jsx)(i.Fragment,{children:r.map((function(e,n){return(0,i.jsx)(Pe,{matrix:e.matrix,valueRef:o,getSubstep:Te,substepValue:t},n)}))});case"point2":return(0,i.jsx)(i.Fragment,{children:r.map((function(e,n){return(0,i.jsx)(Ne,{matrix:e.matrix,valueRef:o,getSubstep:Te,substepValue:t},n)}))});case"face":case"line":return(0,i.jsx)(i.Fragment,{children:r.map((function(e,n){return(0,i.jsx)(Ae,{matrix:e.matrix,valueRef:o,value:t},n)}))});case"translate":return(0,i.jsx)(i.Fragment,{children:r.map((function(e,n){return(0,i.jsx)(We,{value:e,step:t},n)}))});case"split":return(0,i.jsx)(i.Fragment,{children:r.map((function(e,n){return(0,i.jsx)(Ge,{value:e,step:t},n)}))});case"extrude":return(0,i.jsx)(i.Fragment,{children:r.map((function(e,n){return(0,i.jsx)($e,{value:e,step:t},n)}))});default:return null}}function Be(e){return t=e,null!=(n=p.WV)&&"undefined"!==typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):t instanceof n;var t,n}var Ie=new I.Box3,qe=new I.Vector3;function Ge(e){for(var t=e.value,n=e.step,r=(0,m.EB)(),o="raw"===n.children[0].type?n.children[0].value:"x",a=Qe[o],l=Ze[o],s=n.children.length-2,c=new Array(s),u=new Array(s),d=(0,f.useMemo)((function(){return t.getBoundingBox(Ie),Ie.getCenter(qe),qe[o]=Ie.min[o],qe.toArray()}),[t]),h=d[0],y=d[1],v=d[2],g=(0,f.useMemo)((function(){var e=t.getOutline().clone();e.matrix.copy((0,p.Nh)(-h,-y,-v));var n=[1,1,1];return n[a]=0,e.matrix.multiply(p.gN.apply(void 0,Ce(n))),e}),[t,a,h,y,v]),b=0,x=0;x<n.children.length-2;x++){var w=n.children[x+2],j="raw"===w.type?w.value:0;c[x]=j,u[x]=b,b+=j}var S=(0,f.useRef)([]);return(0,f.useEffect)((function(){for(;S.current.length<s;)S.current.push(g.clone());S.current.splice(s,Number.MAX_SAFE_INTEGER)}),[g,s]),(0,i.jsx)(i.Fragment,{children:c.map((function(e,o){return(0,i.jsx)(Re,{index:o,axisEnabled:l,axisIndex:a,matrix:t.matrix,offset:u[o],outline:g,size:e,step:n,store:r,x:h,y:y,z:v},o)}))})}function Re(e){var t=e.size,n=e.offset,r=e.x,o=e.y,a=e.z,l=e.axisEnabled,s=e.axisIndex,c=e.matrix,u=e.outline,p=e.store,d=e.step,m=e.index,h=(0,f.useMemo)((function(){return u.clone()}),[u]);return(0,f.useMemo)((function(){var e=[r,o,a];return e[s]+=t+n,(0,i.jsx)(je,{length:.3,value:e,axis:l,matrix:c,depth:!0,child:h,mode:"translate",set:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return p.getState().replace((function(e){e.children[m+2]={type:"raw",value:Math.max(0,t[s]-n)}}),d)}})}),[m,t,n,r,o,a,l,s,c,h,p,d])}var Qe={x:0,y:1,z:2},Ze={x:[!0,!1,!1],y:[!1,!0,!1],z:[!1,!1,!0]};function $e(e){var t=e.value,n=e.step,r=(0,m.EB)(),o="raw"===n.children[0].type?n.children[0].value:0,a=(0,f.useMemo)((function(){return t.getBoundingBox(Ie),Ie.getCenter(qe),qe.toArray()}),[t]),l=a[0],s=a[1],c=a[2],u=(0,f.useMemo)((function(){var e=t.getOutline().clone();return e.matrix.copy((0,p.Nh)(-l,-s,-c)),e}),[t,l,s,c]);return(0,i.jsx)(je,{value:[l,o+s,c],axis:Ve,matrix:t.matrix,mode:"translate",child:u,set:function(e,t,o){return r.getState().replace((function(e){e.children=[{type:"raw",value:t-s}]}),n)}})}function We(e){var t=e.value,n=e.step,r=(0,m.EB)(),o="raw"===n.children[0].type?n.children[0].value:0,a="raw"===n.children[1].type?n.children[1].value:0,l="raw"===n.children[2].type?n.children[2].value:0,s=(0,f.useMemo)((function(){return t.getBoundingBox(Ie),Ie.getCenter(qe),qe.toArray()}),[t]),c=s[0],u=s[1],d=s[2],h=(0,f.useMemo)((function(){var e=t.getOutline().clone();return e.matrix.copy((0,p.Nh)(-c,-u,-d)),e}),[t,c,u,d]);return(0,i.jsx)(je,{value:[c+o,u+a,d+l],axis:De,matrix:t.matrix,mode:"translate",child:h,set:function(e,t,o){return r.getState().replace((function(n){n.children=[{type:"raw",value:e-c},{type:"raw",value:t-u},{type:"raw",value:o-d}]}),n)}})}function Fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ye(e,t){return null!=t&&"undefined"!==typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function Ue(e){return function(e){if(Array.isArray(e))return Fe(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return Fe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fe(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var He=new p.vk(new I.Matrix4,(0,p.i7)(new I.Color(16711680)));function Xe(e){var t=qt(e.x,e.y),n=(0,m.g4)((function(e){return e.descriptions.filter((function(n){return n.name.endsWith(t)&&n.domain===e.domain}))}),q.wU);return(0,i.jsx)(i.Fragment,{children:n.map((function(e){var t=e.seed,n=e.name;return(0,i.jsx)(_e,{seed:t,name:n},n)}))})}function _e(e){var t=e.seed,n=e.name,r=(0,m.EB)(),o=r((function(e){return e.selectedDescriptions.includes(n)})),a=r((function(e){var t;return null===(t=e.grammar.find((function(e){var t=e.name;return(0,q.Lr)(n,t)})))||void 0===t?void 0:t.name}));return null==a?null:o?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ze,{description:n}),(0,i.jsx)(nt,{rootNode:a}),(0,i.jsx)(rt,{seed:t,name:n}),(0,i.jsx)(Je,{description:n})]}):(0,i.jsx)(tt,{seed:t,name:n})}function Je(e){var t=e.description,n=(0,m.EB)()((function(e){if("gui"===e.type)return Array.from(new Set((null!=e.hovered?e.selectionsList.concat(e.hovered):e.selectionsList).filter((function(e){var n=e.steps;return(0,q.Lr)(t,(0,q.Il)(n)[0])})).reduce((function(e,t){return e.concat(t.values.filter((function(e){return null!=e.object})).map((function(e){return e.object})))}),[])))}),q.wU);return null==n?null:(0,i.jsx)(i.Fragment,{children:n.map((function(e){return(0,i.jsx)(Ke,{object:e,colorAdd:.25},e.uuid)}))})}function Ke(e){var t=e.object,n=e.colorAdd;return(0,f.useEffect)((function(){return t.traverse((function(e){"material"in e&&e.material.color.addScalar(n)})),function(){t.traverse((function(e){"material"in e&&e.material.color.addScalar(-n)}))}}),[t]),null}function et(e,t){return e((function(e){return"gui"===e.type?(0,q.Bc)(e.grammar,e.dependencyMap,t):void 0}),q.wU)}function tt(e){var t=e.name,n=e.seed,r=(0,f.useRef)(null),o=(0,m.EB)();return function(e,t,n){var r=(0,m.EB)();(0,f.useEffect)((function(){if(null!=n.current&&null!=e){var o=(0,p.QM)((0,G.of)(He).pipe((0,q.Tn)(),(0,q.Ii)(e,p.Jy,{delay:r.getState().interpretationDelay,seed:t})),n.current,(function(e){return g.D1.getState().setError(void 0),e.raw.getObject()}),(function(e){console.error(e),g.D1.getState().setError(e.message)}));return function(){var e,t;null===(t=n.current)||void 0===t||(e=t).remove.apply(e,Ue(n.current.children)),o.unsubscribe()}}}),[r,e,t])}(et(o,t),n,r),(0,i.jsx)("group",{onClick:function(e){var n;null==e.intersections[0].object.userData.steps&&(e.stopPropagation(),o.getState().selectDescription(t,null!==(n=o.getState().shift)&&void 0!==n&&n))},ref:r})}function nt(e){var t=e.rootNode,n=(0,m.EB)()((function(e){var n;if("gui"===e.type)return null===(n=e.valueMap[t])||void 0===n?void 0:n.filter((function(e){return Ye(e.after.raw,p.WV)})).map((function(e){return e.after.raw.getOutline()}))}),q.wU);return null==n?null:(0,i.jsx)(i.Fragment,{children:n.map((function(e){return(0,i.jsx)("primitive",{object:e},e.uuid)}))})}function rt(e){var t=e.name,n=e.seed,r=(0,m.EB)(),o=et(r,t),a=(0,f.useRef)(null);return function(e,t,n,r){var o=(0,m.EB)();(0,f.useEffect)((function(){if(null!=r.current&&null!=e){var i,a=new Map,l=new Map,s=new R.x,c=s.pipe((0,q.br)(300)).subscribe((function(e){return o.getState().editIndices(e,!0)}));try{i=(0,p.QM)((0,G.of)(He).pipe((0,q.Tn)(),(0,q.Ii)(e,p.Jy,{delay:o.getState().interpretationDelay,seed:n,listeners:{onAfterStep:function(e,t){var n=a.get(e),r=null===n||void 0===n?void 0:n.find((function(e){var n=(0,q.Up)(t.index,e.index);return n===q.J.Predecessor||n===q.J.Equal}));null!=r&&s.next({steps:e,value:{after:t,before:r,object:Ye(t.raw,p.WV)?t.raw.getObject():void 0}});var o=t.index.join(","),i=l.get(o);null!=i&&(i.path[0]!==e.path[0]||function(e,t){if(e===t)return!0;if(e.length<t.length)return!1;for(var n=0;n<t.length;n++)if(e[n]!=t[n])return!1;return!0}(i.path,e.path)&&(0,T.I)(ne,e))||l.set(o,e)},onBeforeStep:function(e,t){var n=a.get(e);if(null==n&&(n=[],a.set(e,n)),n.push(t),"symbol"===e.type){var r=t.index.join(",");l.delete(r)}}}})),r.current,(function(e){var t=l.get(e.index.join(",")),n=e.raw.getObject();if(null!=t){var r=a.get(t),o=null===r||void 0===r?void 0:r.find((function(t){var n=(0,q.Up)(e.index,t.index);return n===q.J.Predecessor||n===q.J.Equal}));if(null!=o&&null!=t){var i={after:e,before:o,object:n};n.traverse((function(e){e.userData.steps=t,e.userData.value=i}))}}return n}),(function(e){console.error(e),g.D1.getState().setError(e.message)}))}catch(u){g.D1.getState().setError(u.message)}return function(){var e,n;o.getState().clearValueMap(t),null===(n=r.current)||void 0===n||(e=n).remove.apply(e,Ue(r.current.children)),null===i||void 0===i||i.unsubscribe(),null===c||void 0===c||c.unsubscribe()}}}),[o,e,n])}(o,t,n,a),null==o?null:(0,i.jsx)("object3D",{onPointerMove:function(e){if(0!==e.intersections.length){var t=e.intersections[0].object,n=t.userData.steps,o=t.userData.value;null!=n&&null!=o&&(e.stopPropagation(),r.getState().onStartHover(n,[o]))}},onPointerOut:function(e){var t=e.object,n=t.userData.steps,o=t.userData.value;null!=n&&null!=o&&(e.stopPropagation(),r.getState().onEndHover(n))},onClick:function(e){var t=e.intersections[0].object,n=t.userData.steps,o=t.userData.value;if(null!=n&&null!=o){e.stopPropagation();var i=r.getState();"gui"==i.type&&null==i.requested&&r.getState().selectResult(n,o)}},ref:a})}function ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function it(e){return function(e){if(Array.isArray(e))return ot(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return ot(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ot(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var at=it(st(77188,98509,77198,98516,18)).concat(it(st(137374,88769,137385,88778,18))),lt=new Set(at.map((function(e){var t=e.x,n=e.y,r=e.zoom;return"".concat(r,"/").concat(t,"/").concat(n)})));function st(e,t,n,r,o){var i=r+1-t;return new Array((n+1-e)*i).fill(void 0).map((function(n,r){return{x:e+Math.floor(r/i),y:t+r%i,zoom:o}}))}function ct(e,t,n,r){if(function(e,t,n){return lt.has("".concat(e,"/").concat(t,"/").concat(n))}(e,t,n))return"/cgv/tiles/_".concat(e,"-").concat(t,"-").concat(n,".").concat(r)}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ut(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ft(e){var t=e.tile,n=(0,N.w)().size,r=pt((0,g.D1)((function(e){var t=pt((0,g.bt)(e),3),r=t[0],o=t[1],i=t[2];if("satelite"!==e.viewType){var a=(0,p.FP)(0,18),l=Math.floor(a*r),s=Math.floor(a*i);return[l,s,l-1,s-1,l+1,s+1,18]}return function(e,t,n,r,o){var i=(0,p.FP)(0,18),a=Math.tan(r/180*Math.PI/2)*t,l=a*o,s=Math.floor(i*e),c=Math.floor(i*n),u=(0,g.oq)(e-l,0,1),f=(0,g.oq)(e+l,0,1),d=(0,g.oq)(n-a,0,1),m=(0,g.oq)(n+a,0,1);return[s,c,Math.floor(i*u),Math.floor(i*d),Math.floor(i*f),Math.floor(i*m),18]}(r,o,i,g.xg,n.width/n.height)}),q.wU),7),o=r[0],a=r[1],l=r[2],s=r[3],c=r[4],u=r[5],f=r[6],d=c+1-l,m=u+1-s;return(0,i.jsx)(i.Fragment,{children:new Array(d*m).fill(null).map((function(e,n){var r=l+Math.floor(n/m),c=s+n%m;return(0,i.jsx)(t,{highlighted:r===o&&c===a,x:r,y:c,zoom:f},"".concat(r,"/").concat(c))}))})}function dt(e,t,n){return(0,f.useMemo)((function(){var r=(0,p.FP)(0,n);return{position:[e/r,0,t/r],scale:1/((0,p.jo)(t,n)*r)}}),[e,t,n])}function mt(e){var t=e.x,n=e.y,r=e.zoom,o=dt(t,n,r),a=o.position,l=o.scale;return 18!=r?null:(0,f.useMemo)((function(){return(0,i.jsx)("group",{scale:l,position:a,children:(0,i.jsx)(Xe,{x:t,y:n})})}),[t,n,l,a])}function ht(e){var t=e.x,n=e.y,r=e.zoom,o=e.highlighted,a=(0,g.D1)((function(e){return"panorama"!==e.viewType?e.visualType:0})),l=(0,g.eG)(a),s=dt(t,n,r),c=s.position,u=s.scale,p=ct(r,t,n,"png");return 0===l||null==p?null:(0,i.jsx)("group",{scale:u,position:c,children:(0,i.jsx)(f.Suspense,{fallback:null,children:(0,i.jsx)(vt,{highlighted:o,url:p,y:n,zoom:r})})})}var yt=new I.PlaneBufferGeometry(1,1);function vt(e){var t=e.url,n=e.y,r=e.zoom,o=e.highlighted,a=(0,N.z)(I.TextureLoader,t),l=(0,p.jo)(n,r);return(0,i.jsx)("mesh",{scale:[l,1,l],geometry:yt,position:[0,0,0],children:(0,i.jsx)("meshBasicMaterial",{color:o?16777215:12303291,side:I.DoubleSide,depthWrite:!1,depthTest:!1,map:a})})}yt.translate(.5,-.5,0),yt.rotateX(-Math.PI/2);var gt=n(85769),bt=new I.SphereBufferGeometry(500,60,40);function xt(){var e=(0,g.D1)((function(e){var t=e.viewType,n=e.panoramaIndex;return"panorama"===t?n:void 0})),t=(0,g.D1)((function(e){return"panorama"===e.viewType?e.visualType:0})),n=(0,g.eG)(t),r=null!=e?h.t[e]:void 0;return null==r||0===n?null:(0,i.jsx)(f.Suspense,{fallback:null,children:(0,i.jsx)(wt,{url:r.url,rotationOffset:r.rotationOffset/180*Math.PI})})}function wt(e){var t=e.url,n=e.rotationOffset,r=(0,gt.m)(t);return(0,i.jsx)("mesh",{scale:[1,1,-1],geometry:bt,"rotation-y":n,children:(0,i.jsx)("meshBasicMaterial",{depthWrite:!1,depthTest:!1,map:r,side:I.DoubleSide})})}function jt(){return(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-download",viewBox:"0 0 16 16",children:[(0,i.jsx)("path",{d:"M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"}),(0,i.jsx)("path",{d:"M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"})]})}function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ot(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function Mt(){var e=new I.BufferGeometry,t=new Float32Array([-1,-1,1,3,-1,1,-1,3,1]),n=new Float32Array([0,0,2,0,0,2]);return e.setAttribute("position",new I.BufferAttribute(t,3)),e.setAttribute("uv",new I.BufferAttribute(n,2)),e}function Pt(e){var t=e.children,n=Ot(e,["children"]),r=(0,f.useMemo)(Mt,[]);return(0,i.jsx)("mesh",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){St(e,t,n[t])}))}return e}({geometry:r,frustumCulled:!1},n,{children:t}))}function Nt(){return(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-image",viewBox:"0 0 16 16",children:[(0,i.jsx)("path",{d:"M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"}),(0,i.jsx)("path",{d:"M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"})]})}function At(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Et(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function kt(e){var t=e.className,n=Et(e,["className"]),r=(0,f.useState)(!1),o=r[0],a=r[1],l=(0,f.useState)(!1),s=l[0],c=l[1],u=(0,g.D1)((function(e){return e.visualType}));return(0,i.jsxs)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){At(e,t,n[t])}))}return e}({},n,{className:"".concat(t," d-flex flex-column align-items-center"),children:[o&&(0,i.jsxs)("div",{style:{bottom:45},className:"rounded bg-light text-dark flex-row align-items-center px-2 border d-flex rounded position-absolute text-light",children:["+",(0,i.jsx)("input",{style:{minWidth:50},type:"range",value:u,className:"mb-0 mx-2 form-range",onChange:function(e){return g.D1.getState().setVisualType(e.target.valueAsNumber)},min:0,step:.01,max:1}),"-"]}),(0,i.jsx)(Z.Z,{placement:"top",onVisibleChange:c,visible:s&&!o,overlay:"Background",children:(0,i.jsx)("div",{onClick:function(){return a((function(e){return!e}))},className:"btn btn-sm ".concat(o?"btn-primary":"btn-secondary"," d-flex align-items-center"),children:(0,i.jsx)(Nt,{})})})]}))}function Ct(){return(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-camera-reels",viewBox:"0 0 16 16",children:[(0,i.jsx)("path",{d:"M6 3a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM1 3a2 2 0 1 0 4 0 2 2 0 0 0-4 0z"}),(0,i.jsx)("path",{d:"M9 6h.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 7.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 16H2a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h7zm6 8.73V7.27l-3.5 1.555v4.35l3.5 1.556zM1 8v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1z"}),(0,i.jsx)("path",{d:"M9 6a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM7 3a2 2 0 1 1 4 0 2 2 0 0 1-4 0z"})]})}function Vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Dt(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,o)}function zt(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Dt(i,r,o,a,l,"next",e)}function l(e){Dt(i,r,o,a,l,"throw",e)}a(void 0)}))}}function Tt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Tt(e,t,n[t])}))}return e}function Bt(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function It(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Vt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qt(e,t){return"_".concat(e,"_").concat(t)}function Gt(e,t){var n;t.stopPropagation(),t.preventDefault(),1===(null===(n=t.dataTransfer)||void 0===n?void 0:n.files.length)&&t.dataTransfer.files[0].text().then((function(t){return e.getState().import(t)}))}function Rt(e){var t=e.className,r=e.children,o=Bt(e,["className","children"]),s=(0,a.j)(m.op),c=(0,m.EB)(),p=(0,f.useState)(),d=p[0],h=p[1];return(0,i.jsxs)("div",Lt({onDragOver:function(e){return e.preventDefault()},onDrop:Gt.bind(null,c)},o,{className:"".concat(t," position-relative"),children:[(0,i.jsx)(u.Xz,{style:{touchAction:"none",userSelect:"none",WebkitUserSelect:"none"},events:function(e){return Lt({},(0,u.U3)(e),{priority:1,filter:function(e){return g.D1.getState().controlling?[]:e.sort((function(e,t){return e.distance-t.distance}))}})},dpr:null==n.g.window?1:window.devicePixelRatio,children:(0,i.jsxs)(s,{children:[(0,i.jsxs)(l.T,Lt({ref:h,attach:"map"},{},{children:[(0,i.jsx)(M,{}),(0,i.jsx)(xt,{}),(0,i.jsx)(Zt,{}),(0,i.jsx)(ft,{tile:ht})]})),(0,i.jsx)(k,{}),(0,i.jsx)("ambientLight",{intensity:.5}),(0,i.jsx)("directionalLight",{position:[10,10,10],intensity:.5}),(0,i.jsx)(Kt,{}),(0,i.jsx)(ft,{tile:mt}),(0,i.jsxs)(M,{children:[null!=d&&(0,i.jsx)(Ft,{texture:d}),null!=d&&(0,i.jsx)(Yt,{texture:d})]})]})}),(0,i.jsxs)("div",{className:"d-flex flex-row justify-content-between position-absolute",style:{pointerEvents:"none",inset:0,left:0,right:0,top:0,bottom:0},children:[(0,i.jsxs)("div",{className:"d-flex flex-column my-3 ms-3",style:{maxWidth:200},children:[(0,i.jsx)(B.n,{style:{pointerEvents:"all"},className:"mb-3"}),(0,i.jsx)(z.o,{createDescriptionRequestData:function(){var e=It((0,g.bt)(g.D1.getState()),3),t=e[0],n=(e[1],e[2]);return{suffix:qt(Math.floor(t*Ht),Math.floor(n*Ht))}},style:{pointerEvents:"all"},className:"mb-3",children:(0,i.jsxs)("div",{className:"p-2 border-top border-1",children:[(0,i.jsx)("div",{className:"w-100 btn-sm btn btn-outline-secondary",onClick:function(){return function(e){return Xt.apply(this,arguments)}(c)},children:"Generate Lots"}),(0,i.jsx)("div",{className:"w-100 btn-sm btn mt-2 btn-outline-secondary",onClick:function(){return function(e){return _t.apply(this,arguments)}(c)},children:"Generate Roads"}),(0,i.jsx)(Qt,{})]})}),(0,i.jsx)("div",{className:"flex-grow-1"}),(0,i.jsxs)("div",{style:{pointerEvents:"all"},className:"d-flex flex-row",children:[(0,i.jsx)(nn,{className:"me-2"}),(0,i.jsx)(kt,{className:"me-2"}),(0,i.jsx)(rn,{className:"me-2"}),(0,i.jsx)(en,{className:"me-2"}),(0,i.jsx)(tn,{className:"me-2"}),(0,i.jsx)(Jt,{})]})]}),(0,i.jsxs)("div",{className:"d-flex flex-column align-items-end m-3",children:[(0,i.jsx)(T.XS,{className:"bg-light border rounded shadow w-100 mb-3 overflow-hidden",style:{maxWidth:"16rem",pointerEvents:"all"}}),(0,i.jsx)("div",{className:"flex-grow-1"}),(0,i.jsx)("div",{className:"d-flex flex-row",style:{pointerEvents:"all"},children:(0,i.jsx)(L.c,{className:"me-2"})})]})]}),r]}))}function Qt(){var e=(0,m.EB)(),t=e((function(e){return e.selectedDescriptions.length>1}));return(0,i.jsx)("div",{className:"w-100 btn-sm btn mt-2 btn-outline-secondary ".concat(t?"":"disabled"),onClick:function(){return e.getState().request("summarize",void 0,e.getState().selectedDescriptions)},children:"Summarize"})}function Zt(){return(0,g.D1)((function(e){return"fly"===e.viewType}))?(0,i.jsx)(s.q,{turbidity:10,rayleigh:.4,mieCoefficient:.001,mieDirectionalG:.74,inclination:.62,azimuth:.13}):null}var $t="\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUv;\n\nvec4 fromLinear(vec4 linearRGB)\n{\n    bvec4 cutoff = lessThan(linearRGB, vec4(0.0031308));\n    vec4 higher = vec4(1.055)*pow(linearRGB, vec4(1.0/2.4)) - vec4(0.055);\n    vec4 lower = linearRGB * vec4(12.92);\n\n    return mix(higher, lower, cutoff);\n}\n\nvoid main() {\n    vec4 textureColor = texture2D( map, vUv );\n    gl_FragColor = fromLinear(textureColor);\n    gl_FragColor.a *= opacity;\n}",Wt="\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = vec4(position, 1.0);\n}\n";function Ft(e){var t=e.texture,n=(0,g.D1)((function(e){return e.visualType})),r=(0,g.eG)(n),o=(0,f.useMemo)((function(){return{map:{value:t},opacity:{value:0}}}),[t]);return o.opacity.value=r,(0,i.jsx)(Pt,{children:(0,i.jsx)("shaderMaterial",{uniforms:o,vertexShader:Wt,fragmentShader:$t,toneMapped:!0,attach:"material",depthTest:!0,depthWrite:!1,transparent:!0})})}function Yt(e){var t=e.texture,n=(0,g.D1)((function(e){return e.visualType})),r=(0,g.Yc)(n),o=(0,f.useMemo)((function(){return{map:{value:t},opacity:{value:0}}}),[t]);return o.opacity.value=r,(0,i.jsx)(Pt,{renderOrder:2e3,children:(0,i.jsx)("shaderMaterial",{uniforms:o,vertexShader:Wt,fragmentShader:$t,toneMapped:!0,attach:"material",depthTest:!1,opacity:r,depthWrite:!1,transparent:!0})})}var Ut=18,Ht=(0,p.FP)(0,Ut);function Xt(){return(Xt=zt(o().mark((function e(t){var n,r,i,a,l,s,c,u,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=It((0,g.bt)(g.D1.getState()),3),r=n[0],i=n[2],a=Math.floor(r*Ht),l=Math.floor(i*Ht),null!=(s=ct(Ut,a,l,"mvt"))){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,(0,p.XA)(s,l,Ut);case 8:c=e.sent,u=(0,p.jo)(l,Ut),f=(0,p.PP)(c,qt(a,l),"exclude",u),t.getState().addDescriptions(f);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _t(){return(_t=zt(o().mark((function e(t){var n,r,i,a,l,s,c,u,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=It((0,g.bt)(g.D1.getState()),3),r=n[0],i=n[2],a=Math.floor(r*Ht),l=Math.floor(i*Ht),null!=(s=ct(Ut,a,l,"mvt"))){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,(0,p.XA)(s,l,Ut);case 8:c=e.sent,u=(0,p.jo)(l,Ut),f=(0,p.Zj)(c,qt(a,l),"clip",u),t.getState().addDescriptions(f);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jt(){var e=(0,g.D1)((function(e){return e.error}));return null==e?null:(0,i.jsx)(d.B,{message:e,align:"left"})}function Kt(){return(0,i.jsx)(i.Fragment,{children:h.t.map((function(e,t){var n=e.position;return(0,i.jsx)(c.aL,{position:n,onClick:function(e){e.stopPropagation(),g.D1.getState().changePanoramaView(t)},scale:3e-8,children:(0,i.jsx)("meshBasicMaterial",{color:255})},t)}))})}function en(e){var t=e.className,n=Bt(e,["className"]),r=(0,m.EB)();return(0,i.jsx)(Z.Z,{placement:"top",overlay:"Download",children:(0,i.jsx)("div",Lt({},n,{onClick:function(){return r.getState().download()},className:"".concat(t," d-flex align-items-center justify-content-center btn btn-primary btn-sm "),children:(0,i.jsx)(jt,{})}))})}function tn(e){var t=e.className,n=Bt(e,["className"]),r=(0,g.D1)((function(e){return"fly"===e.viewType}));return(0,i.jsx)(Z.Z,{placement:"top",overlay:"Fly Camera",children:(0,i.jsx)("div",Lt({},n,{onClick:function(){return r?g.D1.getState().backToSateliteView():g.D1.getState().enterFlyCamera()},className:"".concat(t," d-flex align-items-center justify-content-center btn ").concat(r?"btn-secondary":"btn-primary"," btn-sm "),children:(0,i.jsx)(Ct,{})}))})}function nn(e){var t=e.className,n=Bt(e,["className"]),r=(0,m.EB)(),o=r((function(e){return"gui"===e.type&&e.shift}));return(0,i.jsx)(Z.Z,{placement:"topLeft",overlay:"Hold for multiselect",children:(0,i.jsx)("div",Lt({},n,{onPointerDown:function(){return r.getState().setShift(!0)},onPointerUp:function(){return r.getState().setShift(!1)},className:"".concat(t," d-flex align-items-center justify-content-center btn ").concat(o?"btn-primary":"btn-secondary"," btn-sm "),children:(0,i.jsx)(D,{})}))})}function rn(e){var t=e.className,n=Bt(e,["className"]);return"panorama"!=(0,g.D1)((function(e){return e.viewType}))?null:(0,i.jsx)(Z.Z,{placement:"top",overlay:"Exit Street View",children:(0,i.jsx)("div",Lt({},n,{className:"".concat(t," d-flex align-items-center justify-content-center btn btn-sm btn-primary"),onClick:function(){return g.D1.getState().backToSateliteView()},children:(0,i.jsx)(V,{})}))})}},73506:function(e,t,n){"use strict";n.d(t,{xg:function(){return d},Yc:function(){return S},eG:function(){return O},oq:function(){return M},D1:function(){return E},bt:function(){return k},H5:function(){return C},bv:function(){return V}});var r=n(26173),o=n(14671),i=n(38597),a=n(3921),l=n(55050),s=n(70122);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}var d=60;var m,h=new r.Euler(0,0,0,"YXZ"),y=[0,0,0],v=[(m=new r.Euler(-Math.PI/2,0,0)).x,m.y,m.z],g=(0,l.jo)(0,0),b=.1/g,x=1/g,w=10/g,j=40/g;function S(e){return Math.min(2*e-1,1)}function O(e){return Math.max(2*e,0)}function M(e,t,n){return Math.min(Math.max(e,t),n)}var P=new r.Vector3,N=new r.Euler(void 0,void 0,void 0,"YXZ");function A(e,t,n){var r,o,i=u(e,3),a=i[0],l=i[1],s=i[2];return(r=P).set.apply(r,p(t)),(o=N).set.apply(o,p(n)),P.applyEuler(N),P.x+=a,P.y+=l,P.z+=s,P.y=M(P.y,b,j),P.toArray()}var E=(0,o.Z)((0,i.XR)((0,i.$e)({viewType:"satelite",position:[(0,l.dc)(s.K[0].lon,0),w,(0,l.Oz)(s.K[0].lat,0)],error:void 0,visualType:0,controlling:!1},(function(e,t){return{setControlling:function(t){return e({controlling:t})},setLatLon:function(t,n){e({viewType:"satelite",position:[(0,l.dc)(n,0),w,(0,l.Oz)(t,0)]})},drag:function(n,r){var o=t(),i=V(o)/180*Math.PI;if(o.viewType,"satelite"==o.viewType){var a=u(o.position,3),l=a[0],s=a[1],c=a[2],f=2*Math.tan(i/2)*o.position[1];e({position:[M(l-n*f,0,1),s,M(c-r*f,0,1)]})}else{var d;(d=h).set.apply(d,p(o.rotation)),h.x=M(h.x+r*i,-Math.PI/2,Math.PI/2),h.y+=n*i,e({rotation:[h.x,h.y,h.z]})}},moveFlyCamera:function(n){var r=t();"fly"===r.viewType&&e({position:A(r.position,n,r.rotation)})},pinch:function(n){var r=t();switch(r.viewType){case"satelite":var o=u(r.position,3),i=o[0],a=o[1],l=o[2];e({position:[i,M(a/n,x,j),l]});break;case"panorama":var s=M(r.fov/((2+n)/3),5,120);e({fov:s});break;case"fly":e({position:A(r.position,[0,0,1e-6*(1-n)],r.rotation)})}},changeView:function(t){return e(t)},enterFlyCamera:function(){var n=t();if("fly"!==n.viewType){var r=k(n),o=C(n);e({viewType:"fly",position:r,rotation:o})}},backToSateliteView:function(){var n=t();if("satelite"!==n.viewType){var r=u(k(n),3),o=r[0],i=r[1],a=r[2];e({viewType:"satelite",position:[o,M(i,x,j),a]})}},changePanoramaView:function(n){var r=t(),o="satelite"===r.viewType?y:r.rotation,i="panorama"===r.viewType?r.fov:d;e({viewType:"panorama",panoramaIndex:n,rotation:o,fov:i})},setError:function(t){e({error:t})},setVisualType:function(t){e({visualType:t})}}}))));function k(e){return"panorama"!==e.viewType?e.position:a.t[e.panoramaIndex].position}function C(e){return"satelite"===e.viewType?v:e.rotation}function V(e){return"panorama"===e.viewType?e.fov:d}},17518:function(e,t,n){"use strict";n.d(t,{M:function(){return Pe}});var r=n(85893),o=n(67294),i=n(82513),a=n(21010);function l(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-pencil",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"})})}var s=n(29426);function c(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-diagram-3-fill",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5v-1zm-6 8A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5v-1zm6 0A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5v-1zm6 0a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1z"})})}var u=n(47741);function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){f(e,t,n[t])}))}return e}function m(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(){var e=(0,a.EB)(),t=e((function(e){return e.selectedDescriptions})),n=e((function(e){return"gui"!==e.type||e.graphVisualization||1!==e.selectedDescriptions.length?void 0:(0,i.Bc)(e.grammar,e.dependencyMap,e.selectedDescriptions[0])}),i.wU);return 1!=t.length?(0,r.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-grow-1",children:(0,r.jsx)("span",{children:0===t.length?"Nothing Selected":"Multiple Descriptions Selected"})}):null==n?null:(0,r.jsx)("div",{className:"position-relative flex-grow-1",children:(0,r.jsxs)("div",{style:{whiteSpace:"pre-wrap",tabSize:2},className:"m-3",children:[(0,i.qC)(n,b(t[0]))(0),(0,r.jsxs)("div",{style:{position:"fixed",right:"1rem",bottom:"1rem"},className:"d-flex flex-row align-items-center",children:[(0,r.jsx)(u.Z,{placement:"top",overlay:"Toggle Graph",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-secondary me-2",onClick:function(){return e.getState().setGraphVisualization(!0)},children:(0,r.jsx)(c,{})})}),(0,r.jsx)(u.Z,{placement:"topRight",overlay:"Edit Text",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-secondary",onClick:function(){return e.getState().setType("tui")},children:(0,r.jsx)(l,{})})})]})]})})}function y(e){var t=e.value,n=e.description,l=e.indentation,c=(0,a.EB)(),u=(0,o.useMemo)((function(){var e=c.getState(),n=e.onEndHover,r=e.onStartHover,o=e.select;return{onMouseLeave:n.bind(null,t,void 0),onMouseEnter:r.bind(null,t,void 0),onClick:o.bind(null,t,void 0,void 0)}}),[c,t]),p=(0,a.HY)().operationGuiMap,f=c(x.bind(null,t)),m=g(t,n);return m&&(u=void 0,f=(null!==f&&void 0!==f?f:"")+" text-muted"),"string"===typeof t?(0,r.jsx)("span",d({},u,{className:f,children:(0,i.nH)(t,n)})):"symbol"===t.type?(0,r.jsx)("span",d({},u,{className:f,children:(0,i.nH)(t.identifier,n)})):!(0,s.I)(p,t)||m?(0,r.jsx)("span",d({},u,{className:f,children:(0,r.jsx)(v,{indentation:l,description:n,value:t})})):(0,r.jsx)("span",{className:f,children:(0,i.g3)(t,b(n),l)(0,u)})}function v(e){var t=e.value,n=e.description,o=e.indentation;return(0,r.jsx)(r.Fragment,{children:(0,i.Wv)(t,o,i.Ej.bind(null,n),i.lv)})}function g(e,t){return(0,i.BZ)((0,i.Il)(e)[0])!==t}function b(e){return(0,i.Qx)((function(t,n){return function(r,i){var a=g(n,e);return(0,o.createElement)("span",d({className:a?"text-muted":void 0},a?{}:i,{key:r}),t)}}),(function(t,n){return function(o){return(0,r.jsx)(y,{indentation:t,description:e,value:n},o)}}),(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n){return(0,r.jsx)(o.Fragment,{children:t.map((function(e,t){return e(t,n)}))},e)}}),(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(t,r){return(0,o.createElement)("span",d({},r,{key:t}),i.lv.apply(void 0,[e].concat(m(n))))}}))}function x(e,t){if("gui"==t.type)return-1!=t.selectionsList.findIndex((function(t){return t.steps==e}))?"selected":null!=t.hovered&&t.hovered.steps===e?"hovered":void 0}var w=n(1655);function j(){var e=(0,a.EB)(),t=e((function(e){return"tui"===e.type?e.text:void 0})),n=e((function(e){return"tui"!==e.type||e.correct?void 0:e.error}));return null==t&&null==n?null:(0,r.jsxs)("div",{className:"d-flex position-relative flex-grow-1",children:[(0,r.jsx)("textarea",{autoFocus:!0,style:{resize:"none",outline:0,tabSize:2},value:t,onKeyDown:function(t){return function(e,t){if("Tab"===e.code){e.preventDefault();var n=e.currentTarget.value,r=e.currentTarget.selectionStart,o=e.currentTarget.selectionEnd;return t(n.substring(0,r)+"\t"+n.substring(o)),!1}}(t,e.getState().setText)},spellCheck:!1,onChange:function(t){return e.getState().setText(t.target.value)},className:"bg-transparent p-3 border-0 flex-basis-0 flex-grow-1 text-light"}),null==n?(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-primary",style:{position:"absolute",right:"1rem",bottom:"1rem"},onClick:function(){return e.getState().setType("gui")},children:(0,r.jsx)(l,{})}):(0,r.jsx)(w.B,{style:{position:"fixed",bottom:"1rem",right:"1rem"},align:"right",message:n})]})}var S=n(61152);function O(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})})}function M(e){var t=e.fulfill,n=e.data,i=(0,a.EB)(),l=(0,o.useState)(""),s=l[0],c=l[1],u=(0,o.useMemo)((function(){if(0===s.length)return!1;var e=i.getState();return"gui"!=e.type||Object.keys(e.grammar).includes(s)}),[s]),p=(0,o.useCallback)((function(e){var r;null!=t&&t("".concat(e).concat(null!==(r=null===n||void 0===n?void 0:n.suffix)&&void 0!==r?r:""))}),[t,null===n||void 0===n?void 0:n.suffix]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&p(s)},autoFocus:!0,type:"text",className:"form-control form-control-sm mb-3",onChange:function(e){return c(e.target.value)},value:s,placeholder:"Description name"}),(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center justify-content-end",children:[(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:i.getState().cancelRequest,children:(0,r.jsx)(O,{})}),(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return p(s)},disabled:u,children:(0,r.jsx)(S.n,{})})]})]})}var P=n(34051),N=n.n(P),A=n(65201),E=n(83545);function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function C(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,o)}function V(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e){var t=e.fulfill,n=(0,a.EB)(),l=(0,a.HY)().operations,s=(0,o.useState)(""),c=s[0],u=s[1],p=(0,o.useMemo)((function(){return function(e,t){return(0,i.Eo)(e).filter((function(e){var t=e.type;return"parallel"!=t&&"sequential"!=t})).map((function(e){return{label:"operation"===e.type?e.identifier:e.type,onSelect:t.bind(null,e)}}))}(l,(function(e){return t({step:function(){return(0,i.o9)(e,l)}})}))}),[t,l]),f=(0,o.useCallback)(function(){var e,n=(e=N().mark((function e(n){var r;return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.clipboard.readText();case 2:r=e.sent;try{t({randomize:n,step:function(e){return i.IX.apply(void 0,[JSON.parse(r).step,(0,i.BZ)(e[0])].concat(V(e)))},dependencies:function(e){var t=JSON.parse(r);if(null!=t.dependencies)return(0,i.l3)((0,i.z_)((0,A.vV)(t.dependencies),e))}})}catch(o){}case 4:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){C(i,r,o,a,l,"next",e)}function l(e){C(i,r,o,a,l,"throw",e)}a(void 0)}))});return function(e){return n.apply(this,arguments)}}(),[n]),d=(0,o.useMemo)((function(){return p.filter((function(e){return e.label.toLocaleLowerCase().includes(c.toLocaleLowerCase())}))}),[c,p]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row mb-2",children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&1===d.length&&d[0].onSelect()},autoFocus:!0,type:"text",className:"form-control form-control-sm",onChange:function(e){return u(e.target.value)},value:c,placeholder:"Search"}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:n.getState().cancelRequest,children:(0,r.jsx)(O,{})})]}),(0,r.jsxs)("div",{className:"d-flex flex-row",children:[(0,r.jsx)(E.l9,{className:"mb-2 btn-btn-sm button-secondary btn-outline-secondary flex-grow-1",onPaste:f.bind(null,!1),children:"Paste Unrandomized"}),(0,r.jsx)(E.l9,{className:"mb-2 btn-btn-sm button-secondary btn-outline-secondary ms-2 flex-grow-1",onPaste:f.bind(null,!0),children:"Paste Randomized"})]}),(0,r.jsx)("div",{className:"d-flex flex-column",style:{overflowY:"auto"},children:d.map((function(e){var t=e.label,n=e.onSelect;return(0,r.jsx)("div",{className:"rounded pointer p-3 border-bottom",onClick:n,children:t},t)}))})]})}function z(e){var t=e.data,n=t.patterns,o=t.title,i=e.fulfill,l=(0,a.EB)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center",children:[(0,r.jsx)("h5",{children:o}),(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:l.getState().cancelRequest,children:(0,r.jsx)(O,{})})]}),(0,r.jsx)("div",{className:"d-flex flex-column",style:{overflowY:"auto"},children:n.map((function(e,t){return(0,r.jsx)("button",{onClick:i.bind(null,e),className:"mt-3 btn btn-outline-primary w-100",children:e.description},t)}))})]})}function T(e){var t=e.fulfill,n=(0,a.EB)(),i=(0,o.useState)(""),l=i[0],s=i[1],c=(0,o.useMemo)((function(){if(0===l.length)return!1;var e=n.getState();return"gui"!=e.type||Object.keys(e.grammar).includes(l)}),[l]),u=(0,o.useCallback)((function(e){null!=t&&t(e)}),[t]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&u(l)},autoFocus:!0,type:"text",className:"form-control form-control-sm mb-3",onChange:function(e){return s(e.target.value)},value:l,placeholder:"Noun name"}),(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center justify-content-end",children:[(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:n.getState().cancelRequest,children:(0,r.jsx)(O,{})}),(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return u(l)},disabled:c,children:(0,r.jsx)(S.n,{})})]})]})}var L=n(11864);function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){return function(e){if(Array.isArray(e))return B(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(e){var t=e.data,n=(0,o.useState)(void 0),i=n[0],a=n[1];return null==i?(0,r.jsx)(R,{descriptions:t,onSummary:a}):(0,r.jsx)(G,{summary:i})}function G(e){var t=e.summary,n=(0,a.EB)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row mb-3",children:[(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:n.getState().cancelRequest,children:(0,r.jsx)(O,{})})]}),(0,r.jsx)("span",{style:{overflowY:"auto",whiteSpace:"pre-wrap"},className:"p-3 rounded mb-3 text-light bg-dark text-editor p-1",children:(0,i.y0)(t,void 0,i.lv)}),(0,r.jsx)(E.qi,{className:"btn btn-sm btn-outline-primary",onCopy:function(){return JSON.stringify({step:{type:"symbol",identifier:t[0].name},dependencies:t})},children:"Copy"})]})}function R(e){var t=e.descriptions,n=e.onSummary,l=(0,a.EB)(),s=(0,o.useState)(""),c=s[0],u=s[1],p=l((function(e){return e.grammar.map((function(e){return e.name}))}),i.wU),f=(0,o.useState)([]),d=f[0],m=f[1],h=(0,o.useMemo)((function(){return p.filter((function(e){return t.includes((0,i.BZ)(e))&&e.toLocaleLowerCase().includes(c.toLocaleLowerCase())}))}),[c,p]),y=(0,o.useCallback)((function(){return m((function(e){var t=I(e),n=!0,r=!1,o=void 0;try{for(var i,a=h[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var l=i.value;t.includes(l)||t.push(l)}}catch(s){r=!0,o=s}finally{try{n||null==a.return||a.return()}finally{if(r)throw o}}return t}))}),[h]),v=(0,o.useCallback)((function(){return m((function(e){return e.filter((function(e){return!h.includes(e)}))}))}),[h]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"d-flex flex-row mb-3",children:[(0,r.jsx)("input",{onKeyDown:function(e){return"Enter"===e.key&&d.length>=1&&null},autoFocus:!0,type:"text",className:"form-control form-control-sm",onChange:function(e){return u(e.target.value)},value:c,placeholder:"Search"}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return n(function(e,t){var n=e.getState();if("gui"!==n.type)return;var r=n.dependencyMap,o=t.map((function(e){return(0,i.hs)((0,i.AJ)(e,n.grammar,r),void 0)}));return i.Iz.apply(void 0,I(o))}(l,d))},children:(0,r.jsx)(S.n,{})}),(0,r.jsx)("button",{className:"d-flex h-100 align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:l.getState().cancelRequest,children:(0,r.jsx)(O,{})})]}),(0,r.jsxs)("div",{className:"d-flex flex-column",style:{overflowY:"auto"},children:[(0,r.jsxs)("div",{className:"btn-group w-100 mb-2",children:[(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:y,children:"Select All"}),(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:v,children:"Unselect All"})]}),h.map((function(e){var t=d.includes(e);return(0,r.jsx)("div",{className:"m-2",children:(0,r.jsx)(L.v,{value:e,children:(0,r.jsx)("input",{onChange:function(){return m(t?d.filter((function(t){return t!=e})):d.concat(e))},type:"checkbox",checked:t})})},e)}))]})]})}function Q(){var e=(0,a.g4)((function(e){return"gui"===e.type?e.requested:void 0}));return null==e?null:(0,r.jsx)("div",{className:"position-absolute d-flex flex-column align-items-center overflow-hidden",style:{top:0,right:0,bottom:0,left:0,zIndex:2,background:"rgba(0,0,0,0.3)"},children:(0,r.jsx)("div",{style:{maxWidth:"40rem",margin:"0 auto"},className:"rounded overflow-hidden shadow d-flex flex-column m-3 p-3 w-100 bg-light",children:Z(e.data,e.type,e.fulfill)})})}function Z(e,t,n){switch(t){case"summarize":return(0,r.jsx)(q,{data:e});case"create-step":return(0,r.jsx)(D,{fulfill:n});case"create-description":return(0,r.jsx)(M,{data:e,fulfill:n});case"set-name":return(0,r.jsx)(T,{fulfill:n});case"select-condition":return(0,r.jsx)(z,{data:e,fulfill:n})}}var $=n(69647),W=n(70681);function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){F(e,t,n[t])}))}return e}function U(e,t,n,r,o,a,l){if("sequential"!==r.type)if("parallel"!==r.type){var s=J(r,a,l);if(H(r,"step",{content:(0,i.gK)(r,o),hasParameters:null!=s.find((function(e){return!e.isMain}))},e,n),X(s,t,n),null!=r.children)for(var c=function(e){return"random"===e.type||"if"===e.type||"switch"===e.type}(r),u=0;u<r.children.length;u++)_(r,u,a)&&U(e,t,n,r.children[u],o,a,c?l:void 0)}else{var p=!0,f=!1,d=void 0;try{for(var m,h=r.children[Symbol.iterator]();!(p=(m=h.next()).done);p=!0){U(e,t,n,m.value,o,a,l)}}catch(g){f=!0,d=g}finally{try{p||null==h.return||h.return()}finally{if(f)throw d}}}else for(var y=0;y<r.children.length;y++){var v;U(e,t,n,r.children[y],o,a,null!==(v=r.children[y+1])&&void 0!==v?v:l)}}function H(e,t,n,r,o){var i=te(e);r.push({data:Y({},n,{value:e}),type:t,id:i,position:{x:0,y:0},connectable:!1,selectable:!1,draggable:!1}),o.setNode(i,{width:130,height:70})}function X(e,t,n){var r=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var s=a.value,c=s.isMain,u=s.label,p=s.source,f=s.target,d=te(p),m=te(f);n.setEdge(d,m,{}),t.push({id:ee(d,m),sourceHandle:c?"main":"parameter",source:d,target:m,label:u,animated:!0,style:c?{stroke:"#88f",strokeWidth:4}:{stroke:"#999",strokeWidth:2}})}}catch(h){o=!0,i=h}finally{try{r||null==l.return||l.return()}finally{if(o)throw i}}}function _(e,t,n){switch(e.type){case"switch":case"if":return t>0;case"operation":return(0,s.I)(n,e);default:return!0}}function J(e,t,n){if("name"in e)return K(e.step).map((function(t){return{isMain:!0,label:void 0,source:e.name,target:t}}));var r=null==n?[]:K(n).map((function(t){return{isMain:!0,label:void 0,source:e,target:t}}));switch(e.type){case"random":return e.children.reduce((function(t,n,r){return t.concat(K(n).map((function(t){return{source:e,label:"".concat((100*e.probabilities[r]).toFixed(),"%"),isMain:!0,target:t}})))}),[]);case"if":return K(e.children[1]).map((function(t){return{source:e,label:"then",isMain:!0,target:t}})).concat(K(e.children[2]).map((function(t){return{source:e,label:"else",isMain:!0,target:t}})));case"switch":return e.children.slice(1).reduce((function(t,n,r){return t.concat(K(n).map((function(t){return{source:e,label:"case ".concat(e.cases[r]),isMain:!0,target:t}})))}),[]);default:var o="operation"!==e.type||(0,s.I)(t,e)?e.children:void 0;return null!=o?r.concat(o.reduce((function(t,n){return t.concat(K(n).map((function(t){return{isMain:!1,label:void 0,source:e,target:t}})))}),[])):r}}function K(e){return"parallel"===e.type?e.children.reduce((function(e,t){return e.concat(K(t))}),[]):"sequential"===e.type?K(e.children[0]):[e]}function ee(e,t){return"".concat(e,"-").concat(t)}function te(e){return"string"===typeof e?"noun-".concat(e):"step-".concat(e.path.join(","))}var ne={step:function(e){var t=e.data,n=t.value,o=t.content,i=t.hasParameters,l=(0,a.g4)((function(e){return re(n,e)}));return(0,r.jsxs)("div",{style:{width:100,height:40,overflow:"hidden"},className:"".concat(l," align-items-center justify-content-center p-2 text-light position-relative border rounded d-flex flex-row align-items-center"),children:[(0,r.jsx)($.HH,{type:"target",position:$.Ly.Left}),(0,r.jsx)("span",{children:o}),(0,r.jsx)($.HH,{type:"source",id:"main",position:$.Ly.Right}),i&&(0,r.jsx)($.HH,{type:"source",id:"parameter",position:$.Ly.Bottom})]})},noun:function(e){var t=e.data,n=t.content,o=t.value,i=(0,a.g4)((function(e){return re(o,e)}));return(0,r.jsxs)("div",{style:{padding:8,width:100,height:40,overflow:"hidden"},className:"".concat(i," align-items-center justify-content-center text-light position-relative border rounded scroll d-flex flex-row align-items-center"),children:[(0,r.jsx)("span",{style:{fontSize:16},children:n}),(0,r.jsx)($.HH,{type:"source",position:$.Ly.Right})]})}};function re(e,t){if("gui"==t.type)return-1!=t.selectionsList.findIndex((function(t){return t.steps==e}))?"bg-selected":null!=t.hovered&&t.hovered.steps===e?"bg-hovered":void 0}function oe(){var e=(0,a.EB)(),t=e((function(e){return e.selectedDescriptions})),n=e((function(e){return"gui"===e.type&&e.graphVisualization&&1===e.selectedDescriptions.length?(0,i.Bc)(e.grammar,e.dependencyMap,e.selectedDescriptions[0]):void 0}),i.wU),s=(0,a.HY)().operationGuiMap,p=(0,o.useMemo)((function(){if(null==n||1!=t.length)return[];var e=[],r=[];return function(e,t,n,r,o){var a=new W.graphlib.Graph;a.setGraph({rankdir:"LR"});var l=!0,s=!1,c=void 0;try{for(var u,p=n[Symbol.iterator]();!(l=(u=p.next()).done);l=!0){var f=u.value,d=(0,i.Ik)(f.name,r);H(f.name,"noun",{content:d},e,a),X(J(f,o,void 0),t,a),U(e,t,a,f.step,r,o,void 0)}}catch(M){s=!0,c=M}finally{try{l||null==p.return||p.return()}finally{if(s)throw c}}(0,W.layout)(a);var m=!0,h=!1,y=void 0;try{for(var v,g=e[Symbol.iterator]();!(m=(v=g.next()).done);m=!0){var b=v.value,x=a.node(b.id),w=x.x,j=x.y,S=x.width,O=x.height;b.targetPosition=$.Ly.Left,b.sourcePosition=$.Ly.Right,b.position.x=w-S/2,b.position.y=j-O/2}}catch(M){h=!0,y=M}finally{try{m||null==g.return||g.return()}finally{if(h)throw y}}}(e,r,n,t[0],s),[e,r]}),[n,t,s]),f=p[0],d=p[1];return 1!=t.length?(0,r.jsx)("div",{className:"d-flex align-items-center justify-content-center flex-grow-1",children:(0,r.jsx)("span",{children:0===t.length?"Nothing Selected":"Multiple Descriptions Selected"})}):null==n?null:(0,r.jsxs)("div",{className:"position-relative flex-grow-1",children:[(0,r.jsx)($.ZP,{nodeTypes:ne,style:{zIndex:0},nodes:f,edges:d,onNodeClick:function(t,n){return e.getState().select(n.data.value,void 0,e.getState().shift?"add":"replace")},onNodeMouseEnter:function(t,n){return e.getState().onStartHover(n.data.value,void 0)},onNodeMouseLeave:function(t,n){return e.getState().onEndHover(n.data.value)},connectionLineType:$.t8.SmoothStep}),(0,r.jsxs)("div",{style:{position:"fixed",right:"1rem",bottom:"1rem"},className:"d-flex flex-row align-items-center",children:[(0,r.jsx)(u.Z,{placement:"top",overlay:"Toggle Graph",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-primary me-2",onClick:function(){return e.getState().setGraphVisualization(!1)},children:(0,r.jsx)(c,{})})}),(0,r.jsx)(u.Z,{placement:"topRight",overlay:"Edit Text",children:(0,r.jsx)("button",{className:"d-flex align-items-center btn btn-sm btn-secondary",onClick:function(){return e.getState().setType("tui")},children:(0,r.jsx)(l,{})})})]})]})}var ie=n(10811),ae=n(16082),le=n(20554),se=n(82409);function ce(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-skip-forward",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M15.5 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V8.752l-6.267 3.636c-.52.302-1.233-.043-1.233-.696v-2.94l-6.267 3.636C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696L7.5 7.248v-2.94c0-.653.713-.998 1.233-.696L15 7.248V4a.5.5 0 0 1 .5-.5zM1 4.633v6.734L6.804 8 1 4.633zm7.5 0v6.734L14.304 8 8.5 4.633z"})})}function ue(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-skip-backward",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M.5 3.5A.5.5 0 0 1 1 4v3.248l6.267-3.636c.52-.302 1.233.043 1.233.696v2.94l6.267-3.636c.52-.302 1.233.043 1.233.696v7.384c0 .653-.713.998-1.233.696L8.5 8.752v2.94c0 .653-.713.998-1.233.696L1 8.752V12a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm7 1.133L1.696 8 7.5 11.367V4.633zm7.5 0L9.196 8 15 11.367V4.633z"})})}var pe=n(60374);function fe(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-caret-down-fill",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"})})}function de(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-caret-up-fill",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"m7.247 4.86-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"})})}var me=n(73133);function he(e){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:e.width?e.width:16,height:e.width?e.height:16,fill:"currentColor",className:"bi bi-person-circle",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"}),(0,r.jsx)("path",{fillRule:"evenodd",d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"})]})}function ye(e){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:e.width?e.width:16,height:e.width?e.height:16,fill:"currentColor",className:"bi bi-bicycle",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M4 4.5a.5.5 0 0 1 .5-.5H6a.5.5 0 0 1 0 1v.5h4.14l.386-1.158A.5.5 0 0 1 11 4h1a.5.5 0 0 1 0 1h-.64l-.311.935.807 1.29a3 3 0 1 1-.848.53l-.508-.812-2.076 3.322A.5.5 0 0 1 8 10.5H5.959a3 3 0 1 1-1.815-3.274L5 5.856V5h-.5a.5.5 0 0 1-.5-.5zm1.5 2.443-.508.814c.5.444.85 1.054.967 1.743h1.139L5.5 6.943zM8 9.057 9.598 6.5H6.402L8 9.057zM4.937 9.5a1.997 1.997 0 0 0-.487-.877l-.548.877h1.035zM3.603 8.092A2 2 0 1 0 4.937 10.5H3a.5.5 0 0 1-.424-.765l1.027-1.643zm7.947.53a2 2 0 1 0 .848-.53l1.026 1.643a.5.5 0 1 1-.848.53L11.55 8.623z"})})}function ve(e){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:e.width?e.width:16,height:e.width?e.height:16,fill:"currentColor",className:"bi bi-truck",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5v-7zm1.294 7.456A1.999 1.999 0 0 1 4.732 11h5.536a2.01 2.01 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456zM12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12v4zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"})})}function ge(e){var t=e.data,n=(0,a.EB)(),i=ae.L.getState().time,l=e.open,s=e.name?e.name:"",c=(0,o.useState)(e.time*ie.HG<=i&&i<(e.time+1)*ie.HG),u=c[0],p=c[1];ae.L.subscribe((function(e){return d(e.time)}));var f=(0,le.D)((function(e){return e.columnWidth})),d=function(t){e.time*ie.HG<=t&&t<(e.time+1)*ie.HG?u||p(!0):u&&p(!1)};return(0,r.jsx)("div",{style:{backgroundColor:u?"#bf5f4e":"#001c3d",color:"white",display:"table-cell",borderLeft:"2px inset #202024",borderBottom:"2px inset #202024"},onClick:function(){!function(){var r;ae.L.getState().setTime(e.time*ie.HG),t&&(null===t||void 0===t?void 0:t.operation)&&(n.getState().selectDescription(t.path[0].replace("Start@",""),null!==(r=n.getState().shift)&&void 0!==r&&r),n.getState().select({path:t.path,type:"operation",identifier:t.operation.name,children:t.operation.parameter},void 0,"replace"))}(),ae.L.getState().setPlayActive(!1),ae.L.getState().setTime(e.time*ie.HG)},children:(0,r.jsx)("div",{style:{width:400*f,height:l?"80px":"20px",position:"relative"},children:t&&l?(0,r.jsxs)(r.Fragment,{children:[t.operation&&f>.4&&e.showArrow?(0,r.jsx)("div",{style:{marginTop:"25px",marginLeft:f>.8?"48%":f>.7?"45%":f>.6?"42%":f>.5?"38%":f>.4?"50%":"40%",position:"absolute"},children:(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("div",{className:"container",children:(0,r.jsx)("button",{onClick:function(){var e,n;t&&(null===t||void 0===t?void 0:t.operation)&&(le.D.getState().setModalOpen(!0),le.D.getState().setModalData({type:t.type,position:null!==(e=t.position)&&void 0!==e?e:[0,0,0],direction:null!==(n=t.direction)&&void 0!==n?n:[0,0,0],name:s}))},className:"d-flex align-items-center justify-content-center btn btn-secondary btn-lg",children:t.type===ie.LP.Cyclist?(0,r.jsx)(ye,{}):t.type===ie.LP.Pedestrian?(0,r.jsx)(he,{}):(0,r.jsx)(ve,{})})})})}):(0,r.jsx)("div",{}),t.operation&&f>.2&&e.showArrow?(0,r.jsx)("div",{style:{position:"absolute",zIndex:20,marginLeft:f>.5?-80:-40,marginTop:25,width:200*f,fontSize:f>.5?"16px":"12px",fontWeight:f>.5?"400":"600"},className:"box",children:"moveRotate"==t.operation.name?(0,r.jsxs)("span",{className:"row",children:[t.operation.name,"("+t.operation.parameter.map((function(e){return"raw"===e.type?e.value:function(e){if(!e)return"";return e.map((function(e){return"raw"===e.type?e.value:""})).toString()}(e.children)})).toString()+")"]}):(0,r.jsx)("span",{className:"row",children:t.operation.name})}):(0,r.jsx)("div",{})]}):(0,r.jsx)("div",{className:"d-flex justify-content-center",style:{marginTop:"50px",position:"absolute"}})})})}function be(e){var t=(0,le.D)((function(e){return e.setColumnNumber})),n=(0,a.EB)(),i=(0,o.useState)(!0),l=i[0],s=i[1];le.D.subscribe((function(e){return e.allRowsClosedToggle}),(function(e){return s(e)}),{equalityFn:pe.Z});var c=(0,o.useState)(""),u=c[0],p=c[1];(0,o.useEffect)((function(){p(e.data?"moveData"===e.data[0].type?e.data[e.data.length-1].data.name.replace("Start@",""):e.data[0].key.replace("Start@",""):"")}),[e.data]);var f,d,m=null,h=0,y=0;e.data&&("moveData"===e.data[0].type&&(m=e.data.map((function(e){return e.data})),h=m&&null!==(f=m[0].time)&&void 0!==f?f:0,y=m?null!==(d=m[m.length-1].time)&&void 0!==d?d:1:0));y>le.D.getState().columnNumber&&t(y+1);var v=(0,le.D)((function(e){return e.columnNumber})),g=function(e,t){var r;(ae.L.getState().setTime(0),t&&t.grammarSteps.length>0)?"operation"===t.grammarSteps[0].type&&n.getState().select({path:t.grammarSteps[0].path,type:"operation",identifier:t.grammarSteps[0].identifier,children:t.grammarSteps[0].children},void 0,"replace"):n.getState().selectDescription(e,null!==(r=n.getState().shift)&&void 0!==r&&r)},b=function(){n.getState().request("create-description",(function(e){return n.getState().addDescriptions([{name:e}])}),(function(){return{}}))},x=function(){var t,n;(null===e||void 0===e?void 0:e.data)&&"other"==e.data[0].type&&((null===(t=e.data[0].primitive)||void 0===t?void 0:t.startPosition)&&(le.D.getState().setModalOpen(!0),le.D.getState().setModalData({type:"primitive",position:null===(n=e.data[0].primitive)||void 0===n?void 0:n.startPosition.toArray(),direction:void 0,name:u})))},w=function(){if(e.data){if("moveData"===e.data[0].type){var t=u,o=t.split("_")[0];return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{onClick:function(){return g(o)},className:"text-truncate",children:t}),(0,r.jsx)("div",{className:"mt-0",children:(0,r.jsx)("button",{onClick:function(e){e.stopPropagation(),n.getState().deleteDescription(o)},style:{backgroundColor:"white"},className:"btn text-danger btn-sm",children:(0,r.jsx)(me.p,{})})})]})}if("other"===e.data[0].type){var i,a=e.data,l=u.split("_")[0];return(null===(i=a[0].primitive)||void 0===i?void 0:i.startPosition)?(0,r.jsxs)("div",{onClick:function(){return g(l,a[0].primitive)},children:[(0,r.jsx)("div",{className:"text-truncate",children:u}),(0,r.jsxs)("div",{className:"row mt-2",children:[(0,r.jsx)("div",{className:"col-3",children:(0,r.jsx)("button",{onClick:x,className:"d-flex align-items-center justify-content-center btn btn-secondary",children:(0,r.jsx)(he,{})})}),(0,r.jsx)("div",{className:"col-3",children:(0,r.jsx)("button",{style:{backgroundColor:"white"},onClick:function(e){e.stopPropagation(),n.getState().deleteDescription(l)},className:"btn text-danger btn-sm",children:(0,r.jsx)(me.p,{})})})]})]}):(0,r.jsx)("span",{children:a[0].key})}return(0,r.jsx)("button",{type:"button",style:{width:"70px",height:"40px",marginTop:"10px"},onClick:b,className:"btn btn-secondary",children:"Add Description"})}return(0,r.jsxs)("button",{type:"button",onClick:b,className:"btn btn-secondary",children:[(0,r.jsx)("div",{children:"Add"}),(0,r.jsx)("div",{children:"Description"})]})};return(0,r.jsxs)("div",{children:[l?(0,r.jsx)("div",{style:{backgroundColor:"grey",display:"table-cell",borderLeft:"2px inset #202024",borderBottom:"2px inset #202024"},children:(0,r.jsxs)("div",{style:{position:"relative",height:"80px",width:"200px"},children:[(0,r.jsx)("div",{style:{position:"absolute",paddingTop:10,paddingLeft:20,width:"100%"},children:(0,r.jsx)(w,{})}),(0,r.jsx)("button",{style:{position:"absolute",height:"20px",width:"20px",marginLeft:"85%",marginTop:55,backgroundColor:"grey",border:"none"},onClick:function(){return s((function(e){return!e}))},children:(0,r.jsx)(de,{})})]})}):(0,r.jsx)("div",{style:{backgroundColor:"grey",display:"table-cell",borderLeft:"2px inset #202024",borderBottom:"2px inset #202024"},children:(0,r.jsx)("div",{style:{position:"relative",height:"20px",width:"200px"},onClick:function(){return s((function(e){return!e}))},children:(0,r.jsx)("div",{style:{position:"absolute",height:"20px",marginLeft:10},children:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{style:{position:"absolute",width:150},className:"text-truncate",children:u}),(0,r.jsx)("span",{style:{marginLeft:164},children:(0,r.jsx)(fe,{})})]})})})})}),m?(0,r.jsxs)(r.Fragment,{children:[Array.from(Array(h).keys()).map((function(e){return(0,r.jsx)(ge,{time:e,showArrow:!1,open:l},e)})),m.map((function(e,t){var n,o,i,a;return(0,r.jsx)(ge,{time:t+h,data:e,showArrow:0!=t||!!(null===(n=e.operation)||void 0===n?void 0:n.name.includes("create"))||!!(null===(o=e.operation)||void 0===o?void 0:o.name.includes("cyclist"))||!!(null===(i=e.operation)||void 0===i?void 0:i.name.includes("pedestrian"))||!!(null===(a=e.operation)||void 0===a?void 0:a.name.includes("car")),open:l,name:u},t+h)})),Array.from(Array(v-y).keys()).map((function(e){return(0,r.jsx)(ge,{time:e+y+1,showArrow:!1,open:l},e+y+1)}))]}):Array.from(Array(v+1).keys()).map((function(e){return(0,r.jsx)(ge,{time:e,showArrow:!1,open:l},e)}))]})}var xe=function(e){var t=(0,le.D)((function(e){return e.columnWidth})),n=(0,o.useState)(!1),i=n[0],a=n[1];ae.L.subscribe((function(e){return l(e.time)}));var l=function(t){e.time*ie.HG<=t&&t<(e.time+1)*ie.HG?i||a(!0):i&&a(!1)};return(0,r.jsx)("div",{onClick:function(){ae.L.getState().setPlayActive(!1),ae.L.getState().setTime(e.time*ie.HG)},style:{backgroundColor:i?"#bf5f4e":"grey",display:"table-cell",borderLeft:"2px inset #202024",borderBottom:"2px inset #202024"},className:"text-center",children:(0,r.jsxs)("div",{style:{width:400*t},children:["Step: ",e.time]})})},we=function(){var e=(0,le.D)((function(e){return e.columnNumber})),t=Array.from(Array(e+1).keys());return(0,r.jsxs)("div",{style:{height:"30px",display:"table-row"},children:[(0,r.jsx)("div",{style:{backgroundColor:"grey",display:"table-cell",borderLeft:"2px inset #202024",borderBottom:"2px inset #202024"},children:(0,r.jsx)("div",{style:{width:"200px"},children:"Descriptions"})}),t.map((function(e){return(0,r.jsx)(xe,{time:e},e)}))]})};function je(){var e=(0,ae.L)((function(e){return e.rowData})),t=(0,le.D)((function(e){return e.setRowNumber}));e.length>le.D.getState().rowNumber&&t(e.length);var n=(0,le.D)((function(e){return e.rowNumber}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{height:"13%"},children:(0,r.jsx)(Se,{})}),(0,r.jsx)("div",{style:{height:"87%"},children:(0,r.jsxs)("div",{style:{overflowX:"auto",overflowY:"auto",whiteSpace:"nowrap",padding:"4 4 4 4",height:"100%"},children:[(0,r.jsx)(we,{}),e?e.map((function(e,t){return(0,r.jsx)(be,{data:e.length>0?e:void 0},t)})):null,n>e.length?Array.from(Array(n-e.length).keys()).map((function(t){return(0,r.jsx)(be,{},t+e.length)})):null]})})]})}var Se=function(){var e=(0,le.D)((function(e){return e.addRowNumber})),t=(0,le.D)((function(e){return e.setAllRowsClosedToggle})),n=(0,le.D)((function(e){return e.columnWidth}));return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"row w-100",style:{position:"absolute",backgroundColor:"#202024",marginTop:2,marginLeft:2,zIndex:1},children:[(0,r.jsx)("button",{type:"button",style:{width:"100px",height:"30px"},onClick:function(){return e(1)},className:"btn btn-warning",children:"addRow"}),(0,r.jsxs)("span",{style:{width:"200px",color:"red",paddingTop:"5px"},children:["Set Column Size: ",100*n,"%"]}),(0,r.jsx)(se.ZP,{step:.1,min:.2,max:1,value:n,onChangeCommitted:function(e,t){le.D.getState().setColumnWidth(t)},marks:!0,sx:{width:100,color:"#7f0000"}}),(0,r.jsx)("span",{style:{width:"60px"}}),(0,r.jsx)("button",{type:"button",className:"ml-5",style:{width:"100px",height:"30px",backgroundColor:"white",borderColor:"#202024"},onClick:function(){ae.L.getState().setPlayActive(!1);var e=ae.L.getState().time;ae.L.getState().setTime(e-ie.HG>0?e%ie.HG==0?e-ie.HG:e-e%ie.HG:0)},children:(0,r.jsx)(ue,{})}),(0,r.jsx)("button",{type:"button",style:{width:"100px",height:"30px",backgroundColor:"white",borderColor:"#202024"},onClick:function(){ae.L.getState().setPlayActive(!1);var e=ae.L.getState().time,t=e+ie.HG-e%ie.HG,n=ae.L.getState().maxTime;ae.L.getState().setTime(t>n?n:t)},children:(0,r.jsx)(ce,{})}),(0,r.jsx)("span",{style:{width:"60px"}}),(0,r.jsx)("button",{type:"button",style:{width:"150px",height:"30px"},onClick:t,className:"ml-5 btn btn-warning btn-sm",children:"open/close rows"})]})})},Oe=n(94184),Me=n.n(Oe);function Pe(){var e=(0,a.EB)();(0,o.useEffect)((function(){var t=function(t){switch(t.key){case"Shift":case"Control":e.getState().setShift(!1)}},n=function(t){switch(t.key){case"Escape":e.getState().escape();break;case"Delete":t.target==document.body&&e.getState().removeStep();break;case"Shift":case"Control":e.getState().setShift(!0)}};return window.addEventListener("keydown",n),window.addEventListener("keyup",t),function(){window.removeEventListener("keydown",n),window.removeEventListener("keyup",t)}}),[e]);var t=(0,a.HY)().Viewer,n=(0,a.g4)((function(e){return e.showTe}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:Me()({"overflow-hidden":!0,"position-absolute":!0,noselect:!0,"d-flex":!0,"responsive-flex-direction":!0}),style:n?{top:0,right:0,left:0,bottom:0,width:"100%",height:"60%"}:{top:0,right:0,left:0,bottom:0},children:[(0,r.jsx)(Q,{}),(0,r.jsx)(Ae,{}),(0,r.jsx)(t,{style:{whiteSpace:"pre-line",top:0,left:0,right:0,bottom:0},className:"flex-basis-0 flex-grow-1 bg-white"}),(0,r.jsx)(Ne,{})]}),n?(0,r.jsx)("div",{className:"overflow-hidden position-absolute noselect",style:{height:"40%",bottom:"0px",width:"100%",backgroundColor:"#202024"},children:(0,r.jsx)(je,{})}):null]})}function Ne(){var e=(0,a.g4)((function(e){return e.showTui?"tui"===e.type?j:e.graphVisualization?oe:h:void 0}));(0,a.g4)((function(e){return e.showTe}));return null==e?null:(0,r.jsx)("div",{className:"max-responsive-size-35 scroll text-editor text-light flex-basis-0 flex-grow-1 bg-dark d-flex",children:(0,r.jsx)(e,{})})}function Ae(){var e,t=(0,le.D)((function(e){return e.modalOpen})),n=(0,le.D)((function(e){return e.modalData}));return(0,r.jsx)(r.Fragment,{children:t?(0,r.jsx)("div",{className:"position-absolute d-flex flex-column align-items-center overflow-hidden",style:{top:0,right:0,bottom:0,left:0,zIndex:2,background:"rgba(0,0,0,0.3)"},children:(0,r.jsxs)("div",{style:{maxWidth:"40rem",margin:"0 auto"},className:"rounded overflow-hidden shadow d-flex flex-column m-3 p-3 w-100 bg-light",children:[n?Ee(n.type,n.position,null!==(e=n.direction)&&void 0!==e?e:[0,0,0],n.name):null,(0,r.jsx)("div",{className:"d-flex flex-row align-items-center justify-content-end",children:(0,r.jsx)("button",{className:"d-flex align-items-center ms-3 btn btn-sm btn-outline-secondary",onClick:function(){return le.D.getState().setModalOpen(!1)},children:(0,r.jsx)(O,{})})})]})}):null})}function Ee(e,t,n,o){var i=t.map((function(e){return Math.round(e)})),a=n.map((function(e){return Math.round(e)}));switch(e){case"primitive":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("p",{className:"text-center",children:(0,r.jsx)("h5",{children:o})})}),(0,r.jsx)("div",{className:"row mt-3",children:(0,r.jsx)("div",{className:"col-8",children:"Primitive"})}),(0,r.jsx)("div",{className:"row",children:(0,r.jsxs)("div",{className:"col-8",children:["Position: ",i.toString()]})})]});case ie.LP.Cyclist:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("p",{className:"text-center",children:(0,r.jsx)("h5",{children:o})})}),(0,r.jsx)("div",{className:"row mt-3",children:(0,r.jsx)("div",{className:"col-8",children:"Cyclist"})}),(0,r.jsx)("div",{className:"row mt-1",children:(0,r.jsxs)("div",{className:"col-8",children:["Position: ",i.toString()]})}),(0,r.jsx)("div",{className:"row mt-1",children:(0,r.jsxs)("div",{className:"col-8",children:["Direction: ",a.toString()]})}),(0,r.jsx)("div",{className:"row justify-content-center mt-4",children:(0,r.jsx)("div",{className:"col-8 d-flex justify-content-center",children:(0,r.jsx)(ye,{width:100,height:100})})})]});case ie.LP.Pedestrian:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("p",{className:"text-center",children:(0,r.jsx)("h5",{children:o})})}),(0,r.jsx)("div",{className:"row mt-3",children:(0,r.jsx)("div",{className:"col-8",children:"Pedestrian"})}),(0,r.jsx)("div",{className:"row mt-1",children:(0,r.jsxs)("div",{className:"col-8",children:["Position: ",i.toString()]})}),(0,r.jsx)("div",{className:"row mt-1",children:(0,r.jsxs)("div",{className:"col-8",children:["Direction: ",a.toString()]})}),(0,r.jsx)("div",{className:"row justify-content-center mt-4",children:(0,r.jsx)("div",{className:"col-8 d-flex justify-content-center",children:(0,r.jsx)(he,{width:100,height:100})})})]});case ie.LP.Car:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("p",{className:"text-center",children:(0,r.jsx)("h5",{children:o})})}),(0,r.jsx)("div",{className:"row mt-3",children:(0,r.jsx)("div",{className:"col-8",children:"Car"})}),(0,r.jsx)("div",{className:"row mt-1",children:(0,r.jsxs)("div",{className:"col-8",children:["Position: ",i.toString()]})}),(0,r.jsx)("div",{className:"row mt-1",children:(0,r.jsxs)("div",{className:"col-8",children:["Direction: ",a.toString()]})}),(0,r.jsx)("div",{className:"row justify-content-center mt-4",children:(0,r.jsx)("div",{className:"col-8 d-flex justify-content-center",children:(0,r.jsx)(ve,{width:100,height:100})})})]});default:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"row",children:(0,r.jsx)("p",{className:"text-center",children:(0,r.jsx)("h5",{children:o})})}),(0,r.jsx)("div",{className:"row mt-3",children:(0,r.jsx)("div",{className:"col-8",children:"Pedestrian"})}),(0,r.jsx)("div",{className:"row mt-1",children:(0,r.jsxs)("div",{className:"col-8",children:["Position: ",i.toString()]})}),(0,r.jsx)("div",{className:"row mt-1",children:(0,r.jsxs)("div",{className:"col-8",children:["Direction: ",a.toString()]})}),(0,r.jsx)("div",{className:"row justify-content-center mt-4",children:(0,r.jsx)("div",{className:"col-8 d-flex justify-content-center",children:(0,r.jsx)(he,{width:100,height:100})})})]})}}},1655:function(e,t,n){"use strict";n.d(t,{B:function(){return s}});var r=n(85893),o=n(67294);function i(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-exclamation-octagon",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353L4.54.146zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1H5.1z"}),(0,r.jsx)("path",{d:"M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"})]})}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function s(e){var t=e.align,n=e.message,s=e.className,c=l(e,["align","message","className"]),u=(0,o.useState)(!1),p=u[0],f=u[1];return(0,r.jsxs)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},c,{className:"".concat(s," d-flex flex-column ").concat("left"===t?"align-items-start":"align-items-end"),children:[p&&(0,r.jsx)("div",{style:{overflowY:"auto",fontSize:"0.8rem",overflowX:"hidden",maxWidth:"20rem",maxHeight:"8rem",whiteSpace:"pre-line",bottom:24},className:"rounded position-absolute mb-2 p-2 bg-danger text-light",children:n}),(0,r.jsx)("div",{onClick:function(){return f((function(e){return!e}))},className:"btn btn-sm btn-danger d-flex align-items-center",children:(0,r.jsx)(i,{})})]}))}},21010:function(e,t,n){"use strict";n.d(t,{op:function(){return a},HY:function(){return l},EB:function(){return s},g4:function(){return c},gb:function(){return u}});var r=n(85893),o=n(67294);function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var a=(0,o.createContext)(null),l=function(){return(0,o.useContext)(a)};function s(){return(0,o.useContext)(a).store}function c(e,t){return s()(e,t)}function u(e){var t=e.children,n=i(e,["children"]);return(0,r.jsx)(a.Provider,{value:n,children:t})}},98667:function(e,t,n){"use strict";n.d(t,{A:function(){return l}});var r=n(85893),o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function l(e){var t=e.value,n=e.onBlur,l=a(e,["value","onBlur"]),s=(0,o.useState)(t),c=s[0],u=s[1];return(0,o.useEffect)((function(){return u(t)}),[t]),(0,r.jsx)("input",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}({},l,{value:c,onChange:function(e){return u(e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&e.currentTarget.blur()},onBlur:function(e){null!=n&&e.target.value!=t&&n(e)}}))}},1530:function(e,t,n){"use strict";n.d(t,{o:function(){return f}});var r=n(85893),o=n(47741),i=n(21010),a=n(73133);function l(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-file-earmark-check",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z"}),(0,r.jsx)("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"})]})}function s(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-plus",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})})}function c(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-shuffle",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{fillRule:"evenodd",d:"M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"}),(0,r.jsx)("path",{d:"M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"})]})}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function f(e){var t,n=e.createDescriptionRequestData,f=e.style,d=e.className,m=e.children,h=p(e,["createDescriptionRequestData","style","className","children"]),y=(0,i.EB)(),v=y((function(e){return e.descriptions.filter((function(t){return t.domain===e.domain}))})),g=y((function(e){return e.selectedDescriptions}));return(0,r.jsxs)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}({},h,{style:f,className:"".concat(d," bg-light rounded shadow w-100 overflow-hidden border d-flex flex-column"),children:[(0,r.jsxs)("ul",{className:"nav nav-tabs m-2 mb-3",style:{fontSize:15},children:[(0,r.jsx)("button",{className:"movement"===y.getState().domain?"nav-link active":"nav-link",onClick:function(){return y.getState().toggleDomain()},children:"Movement"}),(0,r.jsx)("button",{className:"static"===y.getState().domain?"nav-link active":"nav-link",onClick:function(){return y.getState().toggleDomain()},children:"Static"})]}),(0,r.jsxs)("div",{className:"px-3 py-2 border-bottom d-flex flex-row align-items-center",children:[(0,r.jsxs)("span",{children:["movement"===y.getState().domain?"Movement":"Static"," Descriptions"]}),(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)(o.Z,{align:{offset:[0,8]},placement:"top",overlay:"Add Description",children:(0,r.jsx)("button",{onClick:function(){return y.getState().request("create-description",(function(e){return y.getState().addDescriptions([{name:e}])}),null==n?void 0:n())},className:"btn text-primary btn-sm",children:(0,r.jsx)(s,{})})})]}),(0,r.jsx)("div",{className:"d-flex flex-column scroll",style:{overflow:"auto"},children:v.map((function(e,n){var i=e.name,s=e.seed;return(0,r.jsxs)("div",{onClick:function(e){return y.getState().selectDescription(i,null!==(t=y.getState().shift)&&void 0!==t&&t)},className:"pointer py-2 ps-3 pe-2 d-flex flex-row align-items-center border-top border-1 ".concat(g.includes(i)?"border-primary border-3 border":""),children:[(0,r.jsx)("span",{className:"overflow-hidden",style:{textOverflow:"ellipsis"},children:i}),(0,r.jsx)("div",{className:"flex-grow-1"}),(0,r.jsx)(o.Z,{align:{offset:[0,5]},placement:"top",overlay:"Concretize",children:(0,r.jsx)("button",{onClick:function(e){e.stopPropagation(),y.getState().concretizeDescription(i,s)},className:"btn btn-sm",children:(0,r.jsx)(l,{})})}),(0,r.jsx)(o.Z,{placement:"top",align:{offset:[0,5]},overlay:"Randomize",children:(0,r.jsx)("button",{onClick:function(e){e.stopPropagation(),y.getState().setSeed(i,s+1)},className:"btn btn-sm",children:(0,r.jsx)(c,{})})}),(0,r.jsx)(o.Z,{placement:"top",align:{offset:[0,5]},overlay:"Delete Description",children:(0,r.jsx)("button",{onClick:function(e){e.stopPropagation(),y.getState().deleteDescription(i)},className:"btn text-danger btn-sm",children:(0,r.jsx)(a.p,{})})})]},i)}))}),m]}))}},29426:function(e,t,n){"use strict";n.d(t,{XS:function(){return V},I:function(){return A},t_:function(){return E},q6:function(){return k}});var r=n(85893),o=n(82513),i=n(67294),a=n(21010),l=n(61152),s=n(73133),c=n(47741);function u(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-arrow-left-right",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"})})}var p=n(11864);function f(e){var t=e.step,n=e.values,i=(0,a.EB)();return(0,r.jsxs)("div",{className:"d-flex flex-column mb-3 mx-3",children:[(0,r.jsx)(p.w,{onClick:function(e){return i.getState().selectChildren(t,n,t.children[0])},value:"Condition",className:"pointer mb-3",children:(0,r.jsx)("div",{className:"flex-grow-1 text-end px-2",children:(0,o.Wv)(t.children[0])})}),(0,r.jsxs)(p.w,{onClick:function(e){return i.getState().selectChildren(t,n,t.children[1])},value:"Then",className:"pointer mb-3",children:[(0,r.jsx)("div",{className:"flex-grow-1 text-end px-2",children:(0,o.Wv)(t.children[1])}),(0,r.jsx)(c.Z,{placement:"left",overlay:"Replace with this",children:(0,r.jsx)("button",{onClick:function(){return i.getState().replace((function(){return t.children[1]}),t)},className:"btn btn-sm btn-outline-primary",children:(0,r.jsx)(u,{})})})]}),(0,r.jsxs)(p.w,{onClick:function(e){return i.getState().selectChildren(t,n,t.children[2])},value:"Else",className:"pointer mb-3",children:[(0,r.jsx)("div",{className:"flex-grow-1 text-end px-2",children:(0,o.Wv)(t.children[2])}),(0,r.jsx)(c.Z,{placement:"left",overlay:"Replace with this",children:(0,r.jsx)("button",{onClick:function(){return i.getState().replace((function(){return t.children[2]}),t)},className:"btn btn-sm btn-outline-primary",children:(0,r.jsx)(u,{})})})]})]})}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(s){l=!0,o=s}finally{try{a||null==n.return||n.return()}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e){var t,n,o=e.label,a=e.className,l=e.values,s=e.onChange,c=e.selectAll,u=e.unselectAll,f=(0,i.useState)(!1),d=f[0],h=f[1],y=(0,i.useState)(),v=y[0],g=y[1],b=null===v||void 0===v?void 0:v.getBoundingClientRect();return(0,r.jsxs)("div",{className:"".concat(a," d-flex"),children:[(0,r.jsx)("button",{ref:g,onClick:function(){return h((function(e){return!e}))},className:"btn-sm btn-outline-secondary btn flex-grow-1 dropdown-toggle",type:"button",children:o}),l.length>0&&(0,r.jsx)("div",{style:{width:null===b||void 0===b?void 0:b.width,top:(null!==(t=null===b||void 0===b?void 0:b.top)&&void 0!==t?t:0)+(null!==(n=null===b||void 0===b?void 0:b.height)&&void 0!==n?n:0),bottom:"4rem"},className:"d-flex flex-column overflow-hidden position-absolute ".concat(d?"":"visually-hidden"),children:(0,r.jsxs)("div",{className:"overflow-hidden d-flex flex-column w-100 pt-2 bg-light rounded border",children:[(0,r.jsxs)("div",{className:"btn-group w-100 px-2 mb-2",children:[(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:c,children:"Select All"}),(0,r.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:u,children:"Unselect All"})]}),(0,r.jsx)("div",{className:"d-flex flex-column scroll",style:{overflow:"auto"},children:l.map((function(e,t){var n=m(e,3),o=n[0],i=n[1],a=n[2];return(0,r.jsx)("div",{className:"mx-3 mb-2 scroll",children:(0,r.jsx)(p.v,{value:o,children:(0,r.jsx)("input",{onChange:function(e){return s(a,e.target.checked,t)},type:"checkbox",checked:i})})},o)}))})]})})]})}var y=n(98667),v=n(83545);function g(e){var t=e.value,n=e.descriptionName,i=(0,a.EB)(),l=(0,o.BZ)(t);return(0,r.jsxs)("div",{className:"d-flex flex-column",children:[(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center mx-3 mb-2 w-auto",children:[(0,r.jsx)(y.A,{value:(0,o.nH)(t,l),className:"flex-grow-1 form-control form-control-sm",onBlur:function(e){return i.getState().renameNoun((0,o.BW)(e.target.value,l))}}),l!==n&&(0,r.jsxs)("span",{className:"ms-1",children:["@",n]})]}),(0,r.jsx)(v.qi,{className:"mb-3 mx-3 btn btn-sm btn-outline-secondary",onCopy:function(){return function(e,t){if("gui"!==e.getState().type)return"";return JSON.stringify({step:{type:"symbol",identifier:t}})}(i,t)},children:"Copy Reference"})]})}function b(e){var t,n=e.step,o=e.values,i=(0,a.HY)(),l=i.operationGuiMap,s=i.operations,c=l[n.identifier];return null!=c?(0,r.jsx)(c,{value:n}):void 0!=(null===(t=s[n.identifier])||void 0===t?void 0:t.defaultParameters)?(0,r.jsx)(x,{value:n,values:o}):null}function x(e){var t=e.value,n=e.values,i=(0,a.EB)();return(0,r.jsxs)("div",{className:"d-flex flex-column mx-3 mb-3",children:[t.children.map((function(e,a){return(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center border-bottom",children:[(0,r.jsx)("div",{className:"flex-grow-1 p-3 pointer",onClick:function(r){return i.getState().selectChildren(t,n,e)},children:(0,o.Wv)(e)}),(0,r.jsx)(c.Z,{placement:"left",overlay:"Delete",children:(0,r.jsx)("div",{onClick:function(){return i.getState().replace((function(e){e.children.splice(a,1)}),t)},className:"d-flex align-items-center ms-2 btn btn-sm btn-outline-danger",children:(0,r.jsx)(s.p,{})})})]},a)})),(0,r.jsx)("div",{className:"btn btn-outline-success",onClick:function(){return i.getState().replace((function(e){e.children.push({type:"this"})}),t)},children:"Add Parameter"})]})}function w(e){var t=e.step,n=e.values,i=(0,a.EB)();return(0,r.jsxs)("div",{className:"d-flex flex-column mx-3 mb-3",children:[t.children.map((function(e,a){return(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center border-bottom",children:[(0,r.jsx)(y.A,{className:"form-control form-control-sm",type:"text",value:100*t.probabilities[a],onBlur:function(e){return i.getState().replace((function(t){var n;t.probabilities[a]=(n=e.target.value,parseFloat(n)/100)}),t)}}),(0,r.jsx)("div",{className:"flex-grow-1 ms-2 p-3 pointer",onClick:function(r){return i.getState().selectChildren(t,n,e)},children:(0,o.Wv)(e)}),(0,r.jsx)(c.Z,{placement:"left",overlay:"Replace with this",children:(0,r.jsx)("button",{onClick:function(){return i.getState().replace((function(){return e}),t)},className:"btn ms-2 btn-sm btn-outline-primary",children:(0,r.jsx)(u,{})})}),(0,r.jsx)(c.Z,{placement:"left",overlay:"Delete",children:(0,r.jsx)("div",{onClick:function(){return i.getState().replace((function(e){e.children.splice(a,1),e.probabilities.splice(a,1)}),t)},className:"d-flex align-items-center ms-2 btn btn-sm btn-outline-danger",children:(0,r.jsx)(s.p,{})})})]},a)})),(0,r.jsx)("div",{onClick:function(){return i.getState().replace((function(e){e.children.push({type:"this"}),e.probabilities.push(0)}),t)},className:"btn btn-outline-success",children:"Add"})]})}function j(e){if("true"===e||"false"===e)return"true"===e;var t=parseInt(e);return isNaN(t)?e:t}function S(e){var t=e.step,n=(0,a.EB)();return(0,r.jsx)(y.A,{value:t.value,className:"mx-3 mb-3 w-auto form-control form-control-sm",onBlur:function(e){return n.getState().replace((function(t){t.value=j(e.target.value)}),t)}})}function O(e){var t=e.step,n=e.values,i=(0,a.EB)();return(0,r.jsxs)("div",{className:"d-flex flex-column mb-3 mx-3",children:[(0,r.jsx)(p.w,{onClick:function(e){return i.getState().selectChildren(t,n,t.children[0])},value:"Condition",className:"pointer mb-3",children:(0,r.jsx)("div",{className:"flex-grow-1 text-end px-2",children:(0,o.Wv)(t.children[0])})}),t.children.slice(1).map((function(e,a){return(0,r.jsxs)("div",{className:"d-flex flex-row align-items-center border-bottom mb-3",children:[(0,r.jsx)(y.A,{className:"form-control form-control-sm",type:"text",value:t.cases[a],onBlur:function(e){return i.getState().replace((function(t){t.cases[a]=[j(e.target.value)]}),t)}}),(0,r.jsx)("div",{className:"flex-grow-1 ms-2 p-3 pointer",onClick:function(r){return i.getState().selectChildren(t,n,e)},children:(0,o.Wv)(e)}),(0,r.jsx)(c.Z,{placement:"left",overlay:"Replace with this",children:(0,r.jsx)("button",{onClick:function(){return i.getState().replace((function(){return e}),t)},className:"btn btn-sm btn-outline-primary ms-2",children:(0,r.jsx)(u,{})})}),(0,r.jsx)(c.Z,{placement:"left",overlay:"Delete",children:(0,r.jsx)("div",{onClick:function(){i.getState().replace((function(e){e.children.splice(a,1),e.cases.splice(a,1)}),t)},className:"d-flex align-items-center ms-2 btn btn-sm btn-outline-danger",children:(0,r.jsx)(s.p,{})})})]},a)})),(0,r.jsx)("div",{onClick:function(){return i.getState().replace((function(e){e.children.push({type:"this"}),e.cases.push([0])}),t)},className:"btn btn-outline-success",children:"Add Case"})]})}function M(e){var t=e.step,n=e.description,i=(0,a.EB)(),l=i((function(e){return"gui"===e.type&&null!=e.selectedDescriptions?(0,o.nH)(t.identifier,n):void 0})),s=i((function(e){return"gui"===e.type&&null!=e.selectedDescriptions?e.grammar.map((function(e){return(0,o.nH)(e.name,n)})):void 0}));return null==s?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.w,{value:"Noun",className:"mb-3 mx-3",children:(0,r.jsx)("select",{value:l,onChange:function(e){return i.getState().replace((function(t){t.identifier=e.currentTarget.value}),t)},className:"flex-grow-1 form-select form-select-sm",children:s.map((function(e){return(0,r.jsx)("option",{value:e,children:e},e)}))})}),null!=l&&l.includes("@")&&(0,r.jsxs)("div",{className:"mb-3 mx-3 btn btn-outline-secondary",onClick:function(){return i.getState().pasteNoun(n,t,l)},children:["Paste to ",n]})]})}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function A(e,t){return"string"==typeof t||"operation"!==t.type||null==e[t.identifier]}function E(e,t){e.getState().request("create-step",(function(n){var r=n.step,o=n.dependencies,i=n.randomize;return e.getState().insert(t,r,o,i)}))}function k(e){e.getState().request("create-step",(function(t){var n=t.step,r=t.dependencies,o=t.randomize;return e.getState().replace((function(e,t){return n(t)}),void 0,r,o)}))}function C(e){e.getState().request("set-name",(function(t){return e.getState().setName(t)}))}function V(e){var t=e.className,n=N(e,["className"]),i=(0,a.EB)(),c=i((function(e){return e.selectedDescriptions})),u=i((function(e){return"gui"===e.type&&null==e.requested?e.selectionsList:void 0}));return null==u||0===u.length||null==c?null:(0,r.jsx)("div",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){P(e,t,n[t])}))}return e}({},n,{className:"".concat(t," d-flex flex-column px-0 pt-3"),children:(0,r.jsxs)("div",{className:"d-flex flex-column",style:{overflow:"auto"},children:[(0,r.jsxs)("div",{style:{whiteSpace:"pre"},className:"btn-group mx-3 mb-1 d-flex",children:[(0,r.jsx)("button",{onClick:E.bind(null,i,"before"),className:"btn btn-sm btn-outline-success flex-grow-1 flex-basis-0",children:"+ Before"}),(0,r.jsx)("button",{onClick:E.bind(null,i,"parallel"),className:"btn btn-sm btn-outline-success flex-grow-1 flex-basis-0",children:"+ Parallel"}),(0,r.jsx)("button",{onClick:E.bind(null,i,"after"),className:"btn btn-sm btn-outline-success flex-grow-1 flex-basis-0",children:"+ After"})]}),(0,r.jsxs)("div",{style:{whiteSpace:"pre"},className:"btn-group mx-3 mb-1 d-flex",children:[(0,r.jsx)("button",{onClick:k.bind(null,i),className:"btn btn-sm btn-outline-secondary flex-grow-1 flex-basis-0",children:"Replace"}),(0,r.jsx)(D,{})]}),(0,r.jsxs)("div",{style:{whiteSpace:"pre"},className:"btn-group mx-3 mb-3 d-flex",children:[(0,r.jsx)("button",{onClick:function(){i.getState().unselectAll()},className:"d-flex align-items-center justify-content-center btn btn-sm btn-outline-primary flex-grow-1 flex-basis-0",children:(0,r.jsx)(l.n,{})}),(0,r.jsx)("button",{onClick:i.getState().removeStep.bind(null,void 0),className:"d-flex align-items-center justify-content-center btn btn-sm btn-outline-danger flex-grow-1 flex-basis-0",children:(0,r.jsx)(s.p,{})})]}),(0,r.jsx)("div",{className:"scroll",children:c.map((function(e){var t=u.filter((function(t){return(0,o.Lr)(e,(0,o.Il)(t.steps)[0])}));return 0===t.length?null:(0,r.jsxs)("div",{className:"d-flex flex-column",children:[(0,r.jsx)("span",{style:{fontWeight:500},className:"text-bold mx-3 mb-2",children:e}),t.map((function(t){return(0,r.jsx)(z,{descriptionName:e,selections:t},(0,o.zq)(t.steps))}))]},e)}))})]})}))}function D(){var e=(0,a.EB)(),t=e((function(e){return 1===e.selectedDescriptions.length}));return(0,r.jsx)("button",{onClick:C.bind(null,e),className:"".concat(t?"":"disabled"," btn btn-sm btn-outline-secondary flex-grow-1 flex-basis-0"),children:"Set-Name"})}function z(e){var t=e.selections,n=e.descriptionName,l=(0,a.EB)(),s=(0,o.zq)(t.steps),c=l((function(e){return"gui"===e.type?e.valueMap:void 0})),u=(0,i.useMemo)((function(){return null!=c?c[s]:void 0}),[c]);return(0,r.jsxs)("div",{className:"d-flex flex-column",children:[(0,r.jsx)("label",{className:"mb-3 mx-3",children:(0,o.MG)(t.steps,n)}),(0,r.jsx)(L,{descriptionName:n,step:t.steps,values:t.values}),null!=u&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:function(){return l.getState().autoSelectPattern(t)},className:"btn mx-3 btn-outline-secondary btn-sm mb-2",children:"auto-select pattern"}),(0,r.jsx)(h,{selectAll:function(){return l.getState().select(t.steps,void 0,"add")},unselectAll:function(){return l.getState().select(t.steps,void 0,"remove")},className:"mb-3 mx-3",label:"".concat(t.values.length,"/").concat(u.length," selected"),onChange:function(e,n){l.getState().select(t.steps,e,n?"add":"remove")},values:T(t,u)})]})]})}function T(e,t){return t.map((function(t){return["".concat(t.before.index.join(",")," -> ").concat(t.after.index.join(",")),null!=e.values.find((function(e){return(0,o.Up)(e.after.index,t.after.index)===o.J.Equal})),t]}))}function L(e){var t=e.step,n=e.values,o=e.descriptionName;if("string"===typeof t)return(0,r.jsx)(g,{descriptionName:o,value:t});switch(t.type){case"raw":return(0,r.jsx)(S,{step:t});case"symbol":return(0,r.jsx)(M,{description:o,step:t});case"operation":return(0,r.jsx)(b,{step:t,values:n});case"random":return(0,r.jsx)(w,{step:t,values:n});case"switch":return(0,r.jsx)(O,{step:t,values:n});case"if":return(0,r.jsx)(f,{step:t,values:n});default:return null}}},11864:function(e,t,n){"use strict";n.d(t,{w:function(){return l},v:function(){return s}});var r=n(85893);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function l(e){var t=e.className,n=e.value,o=e.children,l=a(e,["className","value","children"]);return(0,r.jsxs)("div",i({className:"".concat(t," d-flex flex-row")},l,{children:[(0,r.jsx)("label",{style:{width:"4rem"},className:"mb-0 flex-shrink-0 form-label me-2",children:n}),o]}))}function s(e){var t=e.className,n=e.value,o=e.children,l=a(e,["className","value","children"]);return(0,r.jsxs)("div",i({className:"".concat(t," d-flex flex-row")},l,{children:[o,(0,r.jsx)("label",{className:"mb-0 flex-shrink-0 form-label ms-2",children:n})]}))}},83545:function(e,t,n){"use strict";n.d(t,{l9:function(){return m},qi:function(){return h}});var r=n(34051),o=n.n(r),i=n(85893),a=n(67294),l=n(61152);function s(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){s(i,r,o,a,l,"next",e)}function l(e){s(i,r,o,a,l,"throw",e)}a(void 0)}))}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}function f(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function d(e){var t=e.asyncFn,n=e.shortcutKey,r=e.className,s=e.children,u=f(e,["asyncFn","shortcutKey","className","children"]),d=(0,a.useState)(void 0),m=d[0],h=d[1],y=(0,a.useRef)();y.current=m;var v=(0,a.useCallback)(c(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:h(setTimeout((function(){return h(void 0)}),1e3));case 3:case"end":return e.stop()}}),e)}))),[t]);return(0,a.useEffect)((function(){var e=function(e){e.key===n&&e.ctrlKey&&(e.stopPropagation(),e.preventDefault(),v())};return window.addEventListener("keydown",e),function(){null!=y.current&&clearTimeout(y.current),window.removeEventListener("keydown",e)}}),[]),null!=m?(0,i.jsx)("div",p({},u,{className:"".concat(r," btn btn-success h1 btn-outline-success btn-sm text-light"),children:(0,i.jsx)(l.n,{})})):(0,i.jsx)("div",p({},u,{className:"".concat(r," btn btn-sm"),onClick:v,children:s}))}function m(e){var t=e.onPaste,n=f(e,["onPaste"]);return(0,i.jsx)(d,p({},n,{shortcutKey:"v",asyncFn:c(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.clipboard.readText();case 2:return n=e.sent,e.next=5,t(n);case 5:case"end":return e.stop()}}),e)})))}))}function h(e){var t=e.onCopy,n=f(e,["onCopy"]);return(0,i.jsx)(d,p({},n,{shortcutKey:"c",asyncFn:c(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t(),e.next=3,navigator.clipboard.writeText(n);case 3:case"end":return e.stop()}}),e)})))}))}},48827:function(e,t,n){"use strict";n.d(t,{c:function(){return u}});var r=n(85893),o=n(47741),i=n(21010);function a(){return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-card-text",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"}),(0,r.jsx)("path",{d:"M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"})]})}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){l(e,t,n[t])}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function u(e){var t=e.className,n=c(e,["className"]),l=(0,i.EB)(),u=l((function(e){return e.showTui}));return(0,r.jsx)(o.Z,{placement:"left",overlay:"Text Interface",children:(0,r.jsx)("div",s({},n,{onClick:function(){return l.getState().setShowTui(!u)},className:"".concat(t," d-flex align-items-center justify-content-center btn ").concat(u?"btn-primary":"btn-secondary"," btn-sm "),children:(0,r.jsx)(a,{})}))})}},61152:function(e,t,n){"use strict";n.d(t,{n:function(){return o}});var r=n(85893);function o(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-check",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"})})}},73133:function(e,t,n){"use strict";n.d(t,{p:function(){return o}});var r=n(85893);function o(){return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-trash3",viewBox:"0 0 16 16",children:(0,r.jsx)("path",{d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"})})}},73706:function(){}}]);